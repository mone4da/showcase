{"ast":null,"code":"import _classCallCheck from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _get from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/get.js\";\nimport _getPrototypeOf from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js\";\nimport _inherits from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport UniformNode from '../core/UniformNode.js';\nimport UVNode from './UVNode.js';\nvar TextureNode = /*#__PURE__*/function (_UniformNode) {\n  _inherits(TextureNode, _UniformNode);\n  var _super = _createSuper(TextureNode);\n  function TextureNode(value) {\n    var _this;\n    var uvNode = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new UVNode();\n    var biasNode = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n    _classCallCheck(this, TextureNode);\n    _this = _super.call(this, value, 'vec4');\n    _this.uvNode = uvNode;\n    _this.biasNode = biasNode;\n    return _this;\n  }\n  _createClass(TextureNode, [{\n    key: \"getUniformHash\",\n    value: function getUniformHash() {\n      return this.value.uuid;\n    }\n  }, {\n    key: \"getInputType\",\n    value: function getInputType() {\n      return 'texture';\n    }\n  }, {\n    key: \"generate\",\n    value: function generate(builder, output) {\n      var texture = this.value;\n      if (!texture || texture.isTexture !== true) {\n        throw new Error('TextureNode: Need a three.js texture.');\n      }\n      var textureProperty = _get(_getPrototypeOf(TextureNode.prototype), \"generate\", this).call(this, builder, 'texture');\n      if (output === 'sampler') {\n        return textureProperty + '_sampler';\n      } else if (builder.isReference(output)) {\n        return textureProperty;\n      } else {\n        var nodeData = builder.getDataFromNode(this);\n        var snippet = nodeData.snippet;\n        if (snippet === undefined) {\n          var uvSnippet = this.uvNode.build(builder, 'vec2');\n          var biasNode = this.biasNode;\n          if (biasNode !== null) {\n            var biasSnippet = biasNode.build(builder, 'float');\n            snippet = builder.getTextureBias(textureProperty, uvSnippet, biasSnippet);\n          } else {\n            snippet = builder.getTexture(textureProperty, uvSnippet);\n          }\n          nodeData.snippet = snippet;\n        }\n        return builder.format(snippet, 'vec4', output);\n      }\n    }\n  }, {\n    key: \"serialize\",\n    value: function serialize(data) {\n      _get(_getPrototypeOf(TextureNode.prototype), \"serialize\", this).call(this, data);\n      data.value = this.value.toJSON(data.meta).uuid;\n    }\n  }, {\n    key: \"deserialize\",\n    value: function deserialize(data) {\n      _get(_getPrototypeOf(TextureNode.prototype), \"deserialize\", this).call(this, data);\n      this.value = data.meta.textures[data.value];\n    }\n  }]);\n  return TextureNode;\n}(UniformNode);\nTextureNode.prototype.isTextureNode = true;\nexport default TextureNode;","map":{"version":3,"names":["UniformNode","UVNode","TextureNode","_UniformNode","_inherits","_super","_createSuper","value","_this","uvNode","arguments","length","undefined","biasNode","_classCallCheck","call","_createClass","key","getUniformHash","uuid","getInputType","generate","builder","output","texture","isTexture","Error","textureProperty","_get","_getPrototypeOf","prototype","isReference","nodeData","getDataFromNode","snippet","uvSnippet","build","biasSnippet","getTextureBias","getTexture","format","serialize","data","toJSON","meta","deserialize","textures","isTextureNode"],"sources":["/home/samuel/experiment/3d/farm/frontend/node_modules/three-stdlib/nodes/accessors/TextureNode.js"],"sourcesContent":["import UniformNode from '../core/UniformNode.js';\nimport UVNode from './UVNode.js';\n\nclass TextureNode extends UniformNode {\n  constructor(value, uvNode = new UVNode(), biasNode = null) {\n    super(value, 'vec4');\n    this.uvNode = uvNode;\n    this.biasNode = biasNode;\n  }\n\n  getUniformHash() {\n    return this.value.uuid;\n  }\n\n  getInputType() {\n    return 'texture';\n  }\n\n  generate(builder, output) {\n    const texture = this.value;\n\n    if (!texture || texture.isTexture !== true) {\n      throw new Error('TextureNode: Need a three.js texture.');\n    }\n\n    const textureProperty = super.generate(builder, 'texture');\n\n    if (output === 'sampler') {\n      return textureProperty + '_sampler';\n    } else if (builder.isReference(output)) {\n      return textureProperty;\n    } else {\n      const nodeData = builder.getDataFromNode(this);\n      let snippet = nodeData.snippet;\n\n      if (snippet === undefined) {\n        const uvSnippet = this.uvNode.build(builder, 'vec2');\n        const biasNode = this.biasNode;\n\n        if (biasNode !== null) {\n          const biasSnippet = biasNode.build(builder, 'float');\n          snippet = builder.getTextureBias(textureProperty, uvSnippet, biasSnippet);\n        } else {\n          snippet = builder.getTexture(textureProperty, uvSnippet);\n        }\n\n        nodeData.snippet = snippet;\n      }\n\n      return builder.format(snippet, 'vec4', output);\n    }\n  }\n\n  serialize(data) {\n    super.serialize(data);\n    data.value = this.value.toJSON(data.meta).uuid;\n  }\n\n  deserialize(data) {\n    super.deserialize(data);\n    this.value = data.meta.textures[data.value];\n  }\n\n}\n\nTextureNode.prototype.isTextureNode = true;\n\nexport default TextureNode;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}