{"ast":null,"code":"import _classCallCheck from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _get from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/get.js\";\nimport _getPrototypeOf from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js\";\nimport _inherits from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport TempNode from '../core/TempNode.js';\nvar OperatorNode = /*#__PURE__*/function (_TempNode) {\n  _inherits(OperatorNode, _TempNode);\n  var _super = _createSuper(OperatorNode);\n  function OperatorNode(op, aNode, bNode) {\n    var _this;\n    _classCallCheck(this, OperatorNode);\n    _this = _super.call(this);\n    _this.op = op;\n    if ((arguments.length <= 3 ? 0 : arguments.length - 3) > 0) {\n      var finalBNode = bNode;\n      for (var i = 0; i < (arguments.length <= 3 ? 0 : arguments.length - 3); i++) {\n        finalBNode = new OperatorNode(op, finalBNode, i + 3 < 3 || arguments.length <= i + 3 ? undefined : arguments[i + 3]);\n      }\n      bNode = finalBNode;\n    }\n    _this.aNode = aNode;\n    _this.bNode = bNode;\n    return _this;\n  }\n  _createClass(OperatorNode, [{\n    key: \"getNodeType\",\n    value: function getNodeType(builder, output) {\n      var op = this.op;\n      var aNode = this.aNode;\n      var bNode = this.bNode;\n      var typeA = aNode.getNodeType(builder);\n      var typeB = bNode.getNodeType(builder);\n      if (typeA === 'void' || typeB === 'void') {\n        return 'void';\n      } else if (op === '=' || op === '%') {\n        return typeA;\n      } else if (op === '&' || op === '|' || op === '^' || op === '>>' || op === '<<') {\n        return 'int';\n      } else if (op === '==' || op === '&&' || op === '||' || op === '^^') {\n        return 'bool';\n      } else if (op === '<' || op === '>' || op === '<=' || op === '>=') {\n        var typeLength = builder.getTypeLength(output);\n        return typeLength > 1 ? \"bvec\".concat(typeLength) : 'bool';\n      } else {\n        if (typeA === 'float' && builder.isMatrix(typeB)) {\n          return typeB;\n        } else if (builder.isMatrix(typeA) && builder.isVector(typeB)) {\n          // matrix x vector\n          return builder.getVectorFromMatrix(typeA);\n        } else if (builder.isVector(typeA) && builder.isMatrix(typeB)) {\n          // vector x matrix\n          return builder.getVectorFromMatrix(typeB);\n        } else if (builder.getTypeLength(typeB) > builder.getTypeLength(typeA)) {\n          // anytype x anytype: use the greater length vector\n          return typeB;\n        }\n        return typeA;\n      }\n    }\n  }, {\n    key: \"generate\",\n    value: function generate(builder, output) {\n      var op = this.op;\n      var aNode = this.aNode;\n      var bNode = this.bNode;\n      var type = this.getNodeType(builder, output);\n      var typeA = null;\n      var typeB = null;\n      if (type !== 'void') {\n        typeA = aNode.getNodeType(builder);\n        typeB = bNode.getNodeType(builder);\n        if (op === '=') {\n          typeB = typeA;\n        } else if (op === '<' || op === '>' || op === '<=' || op === '>=') {\n          if (builder.isVector(typeA)) {\n            typeB = typeA;\n          } else {\n            typeA = typeB = 'float';\n          }\n        } else if (builder.isMatrix(typeA) && builder.isVector(typeB)) {\n          // matrix x vector\n          typeB = builder.getVectorFromMatrix(typeA);\n        } else if (builder.isVector(typeA) && builder.isMatrix(typeB)) {\n          // vector x matrix\n          typeA = builder.getVectorFromMatrix(typeB);\n        } else {\n          // anytype x anytype\n          typeA = typeB = type;\n        }\n      } else {\n        typeA = typeB = type;\n      }\n      var a = aNode.build(builder, typeA);\n      var b = bNode.build(builder, typeB);\n      var outputLength = builder.getTypeLength(output);\n      if (output !== 'void') {\n        if (op === '=') {\n          builder.addFlowCode(\"\".concat(a, \" \").concat(this.op, \" \").concat(b));\n          return a;\n        } else if (op === '>' && outputLength > 1) {\n          return builder.format(\"\".concat(builder.getMethod('greaterThan'), \"( \").concat(a, \", \").concat(b, \" )\"), type, output);\n        } else if (op === '<=' && outputLength > 1) {\n          return builder.format(\"\".concat(builder.getMethod('lessThanEqual'), \"( \").concat(a, \", \").concat(b, \" )\"), type, output);\n        } else {\n          return builder.format(\"( \".concat(a, \" \").concat(this.op, \" \").concat(b, \" )\"), type, output);\n        }\n      } else if (typeA !== 'void') {\n        return builder.format(\"\".concat(a, \" \").concat(this.op, \" \").concat(b), type, output);\n      }\n    }\n  }, {\n    key: \"serialize\",\n    value: function serialize(data) {\n      _get(_getPrototypeOf(OperatorNode.prototype), \"serialize\", this).call(this, data);\n      data.op = this.op;\n    }\n  }, {\n    key: \"deserialize\",\n    value: function deserialize(data) {\n      _get(_getPrototypeOf(OperatorNode.prototype), \"deserialize\", this).call(this, data);\n      this.op = data.op;\n    }\n  }]);\n  return OperatorNode;\n}(TempNode);\nexport default OperatorNode;","map":{"version":3,"names":["TempNode","OperatorNode","_TempNode","_inherits","_super","_createSuper","op","aNode","bNode","_this","_classCallCheck","call","arguments","length","finalBNode","i","undefined","_createClass","key","value","getNodeType","builder","output","typeA","typeB","typeLength","getTypeLength","concat","isMatrix","isVector","getVectorFromMatrix","generate","type","a","build","b","outputLength","addFlowCode","format","getMethod","serialize","data","_get","_getPrototypeOf","prototype","deserialize"],"sources":["/home/samuel/experiment/3d/farm/frontend/node_modules/three-stdlib/nodes/math/OperatorNode.js"],"sourcesContent":["import TempNode from '../core/TempNode.js';\n\nclass OperatorNode extends TempNode {\n  constructor(op, aNode, bNode, ...params) {\n    super();\n    this.op = op;\n\n    if (params.length > 0) {\n      let finalBNode = bNode;\n\n      for (let i = 0; i < params.length; i++) {\n        finalBNode = new OperatorNode(op, finalBNode, params[i]);\n      }\n\n      bNode = finalBNode;\n    }\n\n    this.aNode = aNode;\n    this.bNode = bNode;\n  }\n\n  getNodeType(builder, output) {\n    const op = this.op;\n    const aNode = this.aNode;\n    const bNode = this.bNode;\n    const typeA = aNode.getNodeType(builder);\n    const typeB = bNode.getNodeType(builder);\n\n    if (typeA === 'void' || typeB === 'void') {\n      return 'void';\n    } else if (op === '=' || op === '%') {\n      return typeA;\n    } else if (op === '&' || op === '|' || op === '^' || op === '>>' || op === '<<') {\n      return 'int';\n    } else if (op === '==' || op === '&&' || op === '||' || op === '^^') {\n      return 'bool';\n    } else if (op === '<' || op === '>' || op === '<=' || op === '>=') {\n      const typeLength = builder.getTypeLength(output);\n      return typeLength > 1 ? `bvec${typeLength}` : 'bool';\n    } else {\n      if (typeA === 'float' && builder.isMatrix(typeB)) {\n        return typeB;\n      } else if (builder.isMatrix(typeA) && builder.isVector(typeB)) {\n        // matrix x vector\n        return builder.getVectorFromMatrix(typeA);\n      } else if (builder.isVector(typeA) && builder.isMatrix(typeB)) {\n        // vector x matrix\n        return builder.getVectorFromMatrix(typeB);\n      } else if (builder.getTypeLength(typeB) > builder.getTypeLength(typeA)) {\n        // anytype x anytype: use the greater length vector\n        return typeB;\n      }\n\n      return typeA;\n    }\n  }\n\n  generate(builder, output) {\n    const op = this.op;\n    const aNode = this.aNode;\n    const bNode = this.bNode;\n    const type = this.getNodeType(builder, output);\n    let typeA = null;\n    let typeB = null;\n\n    if (type !== 'void') {\n      typeA = aNode.getNodeType(builder);\n      typeB = bNode.getNodeType(builder);\n\n      if (op === '=') {\n        typeB = typeA;\n      } else if (op === '<' || op === '>' || op === '<=' || op === '>=') {\n        if (builder.isVector(typeA)) {\n          typeB = typeA;\n        } else {\n          typeA = typeB = 'float';\n        }\n      } else if (builder.isMatrix(typeA) && builder.isVector(typeB)) {\n        // matrix x vector\n        typeB = builder.getVectorFromMatrix(typeA);\n      } else if (builder.isVector(typeA) && builder.isMatrix(typeB)) {\n        // vector x matrix\n        typeA = builder.getVectorFromMatrix(typeB);\n      } else {\n        // anytype x anytype\n        typeA = typeB = type;\n      }\n    } else {\n      typeA = typeB = type;\n    }\n\n    const a = aNode.build(builder, typeA);\n    const b = bNode.build(builder, typeB);\n    const outputLength = builder.getTypeLength(output);\n\n    if (output !== 'void') {\n      if (op === '=') {\n        builder.addFlowCode(`${a} ${this.op} ${b}`);\n        return a;\n      } else if (op === '>' && outputLength > 1) {\n        return builder.format(`${builder.getMethod('greaterThan')}( ${a}, ${b} )`, type, output);\n      } else if (op === '<=' && outputLength > 1) {\n        return builder.format(`${builder.getMethod('lessThanEqual')}( ${a}, ${b} )`, type, output);\n      } else {\n        return builder.format(`( ${a} ${this.op} ${b} )`, type, output);\n      }\n    } else if (typeA !== 'void') {\n      return builder.format(`${a} ${this.op} ${b}`, type, output);\n    }\n  }\n\n  serialize(data) {\n    super.serialize(data);\n    data.op = this.op;\n  }\n\n  deserialize(data) {\n    super.deserialize(data);\n    this.op = data.op;\n  }\n\n}\n\nexport default OperatorNode;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}