{"ast":null,"code":"import _classCallCheck from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _inherits from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport { Loader, FileLoader, LoadingManager, Group } from 'three';\nimport { ColladaLoader } from './ColladaLoader.js';\nimport { unzipSync } from 'fflate';\nvar KMZLoader = /*#__PURE__*/function (_Loader) {\n  _inherits(KMZLoader, _Loader);\n  var _super = _createSuper(KMZLoader);\n  function KMZLoader(manager) {\n    _classCallCheck(this, KMZLoader);\n    return _super.call(this, manager);\n  }\n  _createClass(KMZLoader, [{\n    key: \"load\",\n    value: function load(url, onLoad, onProgress, onError) {\n      var scope = this;\n      var loader = new FileLoader(scope.manager);\n      loader.setPath(scope.path);\n      loader.setResponseType('arraybuffer');\n      loader.setRequestHeader(scope.requestHeader);\n      loader.setWithCredentials(scope.withCredentials);\n      loader.load(url, function (text) {\n        try {\n          onLoad(scope.parse(text));\n        } catch (e) {\n          if (onError) {\n            onError(e);\n          } else {\n            console.error(e);\n          }\n          scope.manager.itemError(url);\n        }\n      }, onProgress, onError);\n    }\n  }, {\n    key: \"parse\",\n    value: function parse(data) {\n      function findFile(url) {\n        for (var path in zip) {\n          if (path.substr(-url.length) === url) {\n            return zip[path];\n          }\n        }\n      }\n      var manager = new LoadingManager();\n      manager.setURLModifier(function (url) {\n        var image = findFile(url);\n        if (image) {\n          console.log('Loading', url);\n          var blob = new Blob([image.buffer], {\n            type: 'application/octet-stream'\n          });\n          return URL.createObjectURL(blob);\n        }\n        return url;\n      }); //\n\n      var zip = unzipSync(new Uint8Array(data)); // eslint-disable-line no-undef\n\n      if (zip['doc.kml']) {\n        var xml = new DOMParser().parseFromString(fflate.strFromU8(zip['doc.kml']), 'application/xml'); // eslint-disable-line no-undef\n\n        var model = xml.querySelector('Placemark Model Link href');\n        if (model) {\n          var loader = new ColladaLoader(manager);\n          return loader.parse(fflate.strFromU8(zip[model.textContent])); // eslint-disable-line no-undef\n        }\n      } else {\n        console.warn('KMZLoader: Missing doc.kml file.');\n        for (var path in zip) {\n          var extension = path.split('.').pop().toLowerCase();\n          if (extension === 'dae') {\n            var _loader = new ColladaLoader(manager);\n            return _loader.parse(fflate.strFromU8(zip[path])); // eslint-disable-line no-undef\n          }\n        }\n      }\n\n      console.error(\"KMZLoader: Couldn't find .dae file.\");\n      return {\n        scene: new Group()\n      };\n    }\n  }]);\n  return KMZLoader;\n}(Loader);\nexport { KMZLoader };","map":{"version":3,"names":["Loader","FileLoader","LoadingManager","Group","ColladaLoader","unzipSync","KMZLoader","_Loader","_inherits","_super","_createSuper","manager","_classCallCheck","call","_createClass","key","value","load","url","onLoad","onProgress","onError","scope","loader","setPath","path","setResponseType","setRequestHeader","requestHeader","setWithCredentials","withCredentials","text","parse","e","console","error","itemError","data","findFile","zip","substr","length","setURLModifier","image","log","blob","Blob","buffer","type","URL","createObjectURL","Uint8Array","xml","DOMParser","parseFromString","fflate","strFromU8","model","querySelector","textContent","warn","extension","split","pop","toLowerCase","scene"],"sources":["/home/samuel/experiment/3d/farm/frontend/node_modules/three-stdlib/loaders/KMZLoader.js"],"sourcesContent":["import { Loader, FileLoader, LoadingManager, Group } from 'three';\nimport { ColladaLoader } from './ColladaLoader.js';\nimport { unzipSync } from 'fflate';\n\nclass KMZLoader extends Loader {\n  constructor(manager) {\n    super(manager);\n  }\n\n  load(url, onLoad, onProgress, onError) {\n    const scope = this;\n    const loader = new FileLoader(scope.manager);\n    loader.setPath(scope.path);\n    loader.setResponseType('arraybuffer');\n    loader.setRequestHeader(scope.requestHeader);\n    loader.setWithCredentials(scope.withCredentials);\n    loader.load(url, function (text) {\n      try {\n        onLoad(scope.parse(text));\n      } catch (e) {\n        if (onError) {\n          onError(e);\n        } else {\n          console.error(e);\n        }\n\n        scope.manager.itemError(url);\n      }\n    }, onProgress, onError);\n  }\n\n  parse(data) {\n    function findFile(url) {\n      for (const path in zip) {\n        if (path.substr(-url.length) === url) {\n          return zip[path];\n        }\n      }\n    }\n\n    const manager = new LoadingManager();\n    manager.setURLModifier(function (url) {\n      const image = findFile(url);\n\n      if (image) {\n        console.log('Loading', url);\n        const blob = new Blob([image.buffer], {\n          type: 'application/octet-stream'\n        });\n        return URL.createObjectURL(blob);\n      }\n\n      return url;\n    }); //\n\n    const zip = unzipSync(new Uint8Array(data)); // eslint-disable-line no-undef\n\n    if (zip['doc.kml']) {\n      const xml = new DOMParser().parseFromString(fflate.strFromU8(zip['doc.kml']), 'application/xml'); // eslint-disable-line no-undef\n\n      const model = xml.querySelector('Placemark Model Link href');\n\n      if (model) {\n        const loader = new ColladaLoader(manager);\n        return loader.parse(fflate.strFromU8(zip[model.textContent])); // eslint-disable-line no-undef\n      }\n    } else {\n      console.warn('KMZLoader: Missing doc.kml file.');\n\n      for (const path in zip) {\n        const extension = path.split('.').pop().toLowerCase();\n\n        if (extension === 'dae') {\n          const loader = new ColladaLoader(manager);\n          return loader.parse(fflate.strFromU8(zip[path])); // eslint-disable-line no-undef\n        }\n      }\n    }\n\n    console.error(\"KMZLoader: Couldn't find .dae file.\");\n    return {\n      scene: new Group()\n    };\n  }\n\n}\n\nexport { KMZLoader };\n"],"mappings":";;;;AAAA,SAASA,MAAM,EAAEC,UAAU,EAAEC,cAAc,EAAEC,KAAK,QAAQ,OAAO;AACjE,SAASC,aAAa,QAAQ,oBAAoB;AAClD,SAASC,SAAS,QAAQ,QAAQ;AAAC,IAE7BC,SAAS,0BAAAC,OAAA;EAAAC,SAAA,CAAAF,SAAA,EAAAC,OAAA;EAAA,IAAAE,MAAA,GAAAC,YAAA,CAAAJ,SAAA;EACb,SAAAA,UAAYK,OAAO,EAAE;IAAAC,eAAA,OAAAN,SAAA;IAAA,OAAAG,MAAA,CAAAI,IAAA,OACbF,OAAO;EACf;EAACG,YAAA,CAAAR,SAAA;IAAAS,GAAA;IAAAC,KAAA,EAED,SAAAC,KAAKC,GAAG,EAAEC,MAAM,EAAEC,UAAU,EAAEC,OAAO,EAAE;MACrC,IAAMC,KAAK,GAAG,IAAI;MAClB,IAAMC,MAAM,GAAG,IAAItB,UAAU,CAACqB,KAAK,CAACX,OAAO,CAAC;MAC5CY,MAAM,CAACC,OAAO,CAACF,KAAK,CAACG,IAAI,CAAC;MAC1BF,MAAM,CAACG,eAAe,CAAC,aAAa,CAAC;MACrCH,MAAM,CAACI,gBAAgB,CAACL,KAAK,CAACM,aAAa,CAAC;MAC5CL,MAAM,CAACM,kBAAkB,CAACP,KAAK,CAACQ,eAAe,CAAC;MAChDP,MAAM,CAACN,IAAI,CAACC,GAAG,EAAE,UAAUa,IAAI,EAAE;QAC/B,IAAI;UACFZ,MAAM,CAACG,KAAK,CAACU,KAAK,CAACD,IAAI,CAAC,CAAC;QAC3B,CAAC,CAAC,OAAOE,CAAC,EAAE;UACV,IAAIZ,OAAO,EAAE;YACXA,OAAO,CAACY,CAAC,CAAC;UACZ,CAAC,MAAM;YACLC,OAAO,CAACC,KAAK,CAACF,CAAC,CAAC;UAClB;UAEAX,KAAK,CAACX,OAAO,CAACyB,SAAS,CAAClB,GAAG,CAAC;QAC9B;MACF,CAAC,EAAEE,UAAU,EAAEC,OAAO,CAAC;IACzB;EAAC;IAAAN,GAAA;IAAAC,KAAA,EAED,SAAAgB,MAAMK,IAAI,EAAE;MACV,SAASC,QAAQA,CAACpB,GAAG,EAAE;QACrB,KAAK,IAAMO,IAAI,IAAIc,GAAG,EAAE;UACtB,IAAId,IAAI,CAACe,MAAM,CAAC,CAACtB,GAAG,CAACuB,MAAM,CAAC,KAAKvB,GAAG,EAAE;YACpC,OAAOqB,GAAG,CAACd,IAAI,CAAC;UAClB;QACF;MACF;MAEA,IAAMd,OAAO,GAAG,IAAIT,cAAc,EAAE;MACpCS,OAAO,CAAC+B,cAAc,CAAC,UAAUxB,GAAG,EAAE;QACpC,IAAMyB,KAAK,GAAGL,QAAQ,CAACpB,GAAG,CAAC;QAE3B,IAAIyB,KAAK,EAAE;UACTT,OAAO,CAACU,GAAG,CAAC,SAAS,EAAE1B,GAAG,CAAC;UAC3B,IAAM2B,IAAI,GAAG,IAAIC,IAAI,CAAC,CAACH,KAAK,CAACI,MAAM,CAAC,EAAE;YACpCC,IAAI,EAAE;UACR,CAAC,CAAC;UACF,OAAOC,GAAG,CAACC,eAAe,CAACL,IAAI,CAAC;QAClC;QAEA,OAAO3B,GAAG;MACZ,CAAC,CAAC,CAAC,CAAC;;MAEJ,IAAMqB,GAAG,GAAGlC,SAAS,CAAC,IAAI8C,UAAU,CAACd,IAAI,CAAC,CAAC,CAAC,CAAC;;MAE7C,IAAIE,GAAG,CAAC,SAAS,CAAC,EAAE;QAClB,IAAMa,GAAG,GAAG,IAAIC,SAAS,EAAE,CAACC,eAAe,CAACC,MAAM,CAACC,SAAS,CAACjB,GAAG,CAAC,SAAS,CAAC,CAAC,EAAE,iBAAiB,CAAC,CAAC,CAAC;;QAElG,IAAMkB,KAAK,GAAGL,GAAG,CAACM,aAAa,CAAC,2BAA2B,CAAC;QAE5D,IAAID,KAAK,EAAE;UACT,IAAMlC,MAAM,GAAG,IAAInB,aAAa,CAACO,OAAO,CAAC;UACzC,OAAOY,MAAM,CAACS,KAAK,CAACuB,MAAM,CAACC,SAAS,CAACjB,GAAG,CAACkB,KAAK,CAACE,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC;QACjE;MACF,CAAC,MAAM;QACLzB,OAAO,CAAC0B,IAAI,CAAC,kCAAkC,CAAC;QAEhD,KAAK,IAAMnC,IAAI,IAAIc,GAAG,EAAE;UACtB,IAAMsB,SAAS,GAAGpC,IAAI,CAACqC,KAAK,CAAC,GAAG,CAAC,CAACC,GAAG,EAAE,CAACC,WAAW,EAAE;UAErD,IAAIH,SAAS,KAAK,KAAK,EAAE;YACvB,IAAMtC,OAAM,GAAG,IAAInB,aAAa,CAACO,OAAO,CAAC;YACzC,OAAOY,OAAM,CAACS,KAAK,CAACuB,MAAM,CAACC,SAAS,CAACjB,GAAG,CAACd,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;UACpD;QACF;MACF;;MAEAS,OAAO,CAACC,KAAK,CAAC,qCAAqC,CAAC;MACpD,OAAO;QACL8B,KAAK,EAAE,IAAI9D,KAAK;MAClB,CAAC;IACH;EAAC;EAAA,OAAAG,SAAA;AAAA,EA/EqBN,MAAM;AAmF9B,SAASM,SAAS"},"metadata":{},"sourceType":"module","externalDependencies":[]}