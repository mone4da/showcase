{"ast":null,"code":"import _regeneratorRuntime from\"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _classCallCheck from\"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import Rest from'./rest';var Session=/*#__PURE__*/function(){function Session(){_classCallCheck(this,Session);}_createClass(Session,[{key:\"yaala\",value:function yaala(from,data){this.rest.yaala({from:from,data:data});}},{key:\"yoole\",value:function yoole(from,to,data){this.rest.yoole({from:from,to:to,data:data});}},{key:\"connect\",value:function connect(path){var _this=this;var source=new EventSource(path);source.addEventListener('message',function(msg){return _this.onMessage(msg.data);});}},{key:\"onMessage\",value:function onMessage(data){try{var msg=JSON.parse(data);switch(msg.id){case'welcome':this.onWelcome(msg);break;case'yaala':this.onIn(msg);break;}}catch(e){console.log(e);}}},{key:\"onWelcome\",value:function onWelcome(msg){}},{key:\"onIn\",value:function onIn(msg){console.log('yaala',msg);}},{key:\"initialize\",value:function(){var _initialize=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(initialized){var config;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:this.rest=new Rest();_context.next=3;return this.loadConfig();case 3:config=_context.sent;this.state.ok=config.ok;if(this.state.ok){this.state.system.maze=config.data.maze;}this.connect('/goyaala');initialized(this);case 8:case\"end\":return _context.stop();}},_callee,this);}));function initialize(_x){return _initialize.apply(this,arguments);}return initialize;}()},{key:\"loadConfig\",value:function(){var _loadConfig=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.next=2;return this.rest.config();case 2:return _context2.abrupt(\"return\",_context2.sent);case 3:case\"end\":return _context2.stop();}},_callee2,this);}));function loadConfig(){return _loadConfig.apply(this,arguments);}return loadConfig;}()}]);return Session;}();export default Session;","map":{"version":3,"names":["Rest","Session","_classCallCheck","_createClass","key","value","yaala","from","data","rest","yoole","to","connect","path","_this","source","EventSource","addEventListener","msg","onMessage","JSON","parse","id","onWelcome","onIn","e","console","log","_initialize","_asyncToGenerator","_regeneratorRuntime","mark","_callee","initialized","config","wrap","_callee$","_context","prev","next","loadConfig","sent","state","ok","system","maze","stop","initialize","_x","apply","arguments","_loadConfig","_callee2","_callee2$","_context2","abrupt"],"sources":["/home/samuel/experiment/3d/farm/frontend/src/model/session.js"],"sourcesContent":["import Rest from './rest'\n\nclass Session{\n\tconstructor(){}\n\n\tyaala(from, data){\n\t\tthis.rest.yaala({from, data})\n\t}\n\n\tyoole(from, to, data){\n\t\tthis.rest.yoole({from, to, data})\n\t}\n\n\n\tconnect(path){\n\t\tlet source = new EventSource(path)\n\t\tsource.addEventListener('message', msg => this.onMessage(msg.data) )\n\t}\n\n\tonMessage(data){\n\t\ttry{\n\t\t\tlet msg = JSON.parse(data)\n\t\t\tswitch(msg.id){\n\t\t\t\tcase 'welcome' : this.onWelcome(msg); break;\n\t\t\t\tcase 'yaala' : this.onIn(msg); break;\n\t\t\t}\n\t\t}catch(e){\n\t\t\tconsole.log(e)\n\t\t}\n\t}\n\n\tonWelcome(msg){}\n\n\tonIn(msg){\n\t\tconsole.log('yaala', msg)\n\t}\n\n\tasync initialize(initialized ){\n\t\tthis.rest = new Rest()\n\t\tlet config = await this.loadConfig()\n\n\t\tthis.state.ok = config.ok\n\n\t\tif (this.state.ok){\n\t\t\tthis.state.system.maze = config.data.maze\n\t\t}\n\n\t\tthis.connect('/goyaala')\n\n\t\tinitialized( this )\n\t}\n\n\tasync loadConfig(){\n\t\treturn await this.rest.config()\n\t}\n\n}\n\nexport default Session\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}