{"ast":null,"code":"import _classCallCheck from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport { Matrix4, Vector3 } from 'three';\nvar inverseProjectionMatrix = new Matrix4();\nvar CSMFrustum = /*#__PURE__*/function () {\n  function CSMFrustum(data) {\n    _classCallCheck(this, CSMFrustum);\n    data = data || {};\n    this.vertices = {\n      near: [new Vector3(), new Vector3(), new Vector3(), new Vector3()],\n      far: [new Vector3(), new Vector3(), new Vector3(), new Vector3()]\n    };\n    if (data.projectionMatrix !== undefined) {\n      this.setFromProjectionMatrix(data.projectionMatrix, data.maxFar || 10000);\n    }\n  }\n  _createClass(CSMFrustum, [{\n    key: \"setFromProjectionMatrix\",\n    value: function setFromProjectionMatrix(projectionMatrix, maxFar) {\n      var isOrthographic = projectionMatrix.elements[2 * 4 + 3] === 0;\n      inverseProjectionMatrix.copy(projectionMatrix).invert(); // 3 --- 0  vertices.near/far order\n      // |     |\n      // 2 --- 1\n      // clip space spans from [-1, 1]\n\n      this.vertices.near[0].set(1, 1, -1);\n      this.vertices.near[1].set(1, -1, -1);\n      this.vertices.near[2].set(-1, -1, -1);\n      this.vertices.near[3].set(-1, 1, -1);\n      this.vertices.near.forEach(function (v) {\n        v.applyMatrix4(inverseProjectionMatrix);\n      });\n      this.vertices.far[0].set(1, 1, 1);\n      this.vertices.far[1].set(1, -1, 1);\n      this.vertices.far[2].set(-1, -1, 1);\n      this.vertices.far[3].set(-1, 1, 1);\n      this.vertices.far.forEach(function (v) {\n        v.applyMatrix4(inverseProjectionMatrix);\n        var absZ = Math.abs(v.z);\n        if (isOrthographic) {\n          v.z *= Math.min(maxFar / absZ, 1.0);\n        } else {\n          v.multiplyScalar(Math.min(maxFar / absZ, 1.0));\n        }\n      });\n      return this.vertices;\n    }\n  }, {\n    key: \"split\",\n    value: function split(breaks, target) {\n      while (breaks.length > target.length) {\n        target.push(new CSMFrustum());\n      }\n      target.length = breaks.length;\n      for (var i = 0; i < breaks.length; i++) {\n        var cascade = target[i];\n        if (i === 0) {\n          for (var j = 0; j < 4; j++) {\n            cascade.vertices.near[j].copy(this.vertices.near[j]);\n          }\n        } else {\n          for (var _j = 0; _j < 4; _j++) {\n            cascade.vertices.near[_j].lerpVectors(this.vertices.near[_j], this.vertices.far[_j], breaks[i - 1]);\n          }\n        }\n        if (i === breaks.length - 1) {\n          for (var _j2 = 0; _j2 < 4; _j2++) {\n            cascade.vertices.far[_j2].copy(this.vertices.far[_j2]);\n          }\n        } else {\n          for (var _j3 = 0; _j3 < 4; _j3++) {\n            cascade.vertices.far[_j3].lerpVectors(this.vertices.near[_j3], this.vertices.far[_j3], breaks[i]);\n          }\n        }\n      }\n    }\n  }, {\n    key: \"toSpace\",\n    value: function toSpace(cameraMatrix, target) {\n      for (var i = 0; i < 4; i++) {\n        target.vertices.near[i].copy(this.vertices.near[i]).applyMatrix4(cameraMatrix);\n        target.vertices.far[i].copy(this.vertices.far[i]).applyMatrix4(cameraMatrix);\n      }\n    }\n  }]);\n  return CSMFrustum;\n}();\nexport { CSMFrustum };","map":{"version":3,"names":["Matrix4","Vector3","inverseProjectionMatrix","CSMFrustum","data","_classCallCheck","vertices","near","far","projectionMatrix","undefined","setFromProjectionMatrix","maxFar","_createClass","key","value","isOrthographic","elements","copy","invert","set","forEach","v","applyMatrix4","absZ","Math","abs","z","min","multiplyScalar","split","breaks","target","length","push","i","cascade","j","lerpVectors","toSpace","cameraMatrix"],"sources":["/home/samuel/experiment/3d/farm/frontend/node_modules/three-stdlib/csm/CSMFrustum.js"],"sourcesContent":["import { Matrix4, Vector3 } from 'three';\n\nconst inverseProjectionMatrix = new Matrix4();\n\nclass CSMFrustum {\n  constructor(data) {\n    data = data || {};\n    this.vertices = {\n      near: [new Vector3(), new Vector3(), new Vector3(), new Vector3()],\n      far: [new Vector3(), new Vector3(), new Vector3(), new Vector3()]\n    };\n\n    if (data.projectionMatrix !== undefined) {\n      this.setFromProjectionMatrix(data.projectionMatrix, data.maxFar || 10000);\n    }\n  }\n\n  setFromProjectionMatrix(projectionMatrix, maxFar) {\n    const isOrthographic = projectionMatrix.elements[2 * 4 + 3] === 0;\n    inverseProjectionMatrix.copy(projectionMatrix).invert(); // 3 --- 0  vertices.near/far order\n    // |     |\n    // 2 --- 1\n    // clip space spans from [-1, 1]\n\n    this.vertices.near[0].set(1, 1, -1);\n    this.vertices.near[1].set(1, -1, -1);\n    this.vertices.near[2].set(-1, -1, -1);\n    this.vertices.near[3].set(-1, 1, -1);\n    this.vertices.near.forEach(function (v) {\n      v.applyMatrix4(inverseProjectionMatrix);\n    });\n    this.vertices.far[0].set(1, 1, 1);\n    this.vertices.far[1].set(1, -1, 1);\n    this.vertices.far[2].set(-1, -1, 1);\n    this.vertices.far[3].set(-1, 1, 1);\n    this.vertices.far.forEach(function (v) {\n      v.applyMatrix4(inverseProjectionMatrix);\n      const absZ = Math.abs(v.z);\n\n      if (isOrthographic) {\n        v.z *= Math.min(maxFar / absZ, 1.0);\n      } else {\n        v.multiplyScalar(Math.min(maxFar / absZ, 1.0));\n      }\n    });\n    return this.vertices;\n  }\n\n  split(breaks, target) {\n    while (breaks.length > target.length) {\n      target.push(new CSMFrustum());\n    }\n\n    target.length = breaks.length;\n\n    for (let i = 0; i < breaks.length; i++) {\n      const cascade = target[i];\n\n      if (i === 0) {\n        for (let j = 0; j < 4; j++) {\n          cascade.vertices.near[j].copy(this.vertices.near[j]);\n        }\n      } else {\n        for (let j = 0; j < 4; j++) {\n          cascade.vertices.near[j].lerpVectors(this.vertices.near[j], this.vertices.far[j], breaks[i - 1]);\n        }\n      }\n\n      if (i === breaks.length - 1) {\n        for (let j = 0; j < 4; j++) {\n          cascade.vertices.far[j].copy(this.vertices.far[j]);\n        }\n      } else {\n        for (let j = 0; j < 4; j++) {\n          cascade.vertices.far[j].lerpVectors(this.vertices.near[j], this.vertices.far[j], breaks[i]);\n        }\n      }\n    }\n  }\n\n  toSpace(cameraMatrix, target) {\n    for (let i = 0; i < 4; i++) {\n      target.vertices.near[i].copy(this.vertices.near[i]).applyMatrix4(cameraMatrix);\n      target.vertices.far[i].copy(this.vertices.far[i]).applyMatrix4(cameraMatrix);\n    }\n  }\n\n}\n\nexport { CSMFrustum };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}