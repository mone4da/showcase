{"ast":null,"code":"import _classCallCheck from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _inherits from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport Node from '../core/Node.js';\nimport Object3DNode from '../accessors/Object3DNode.js';\nimport PositionNode from '../accessors/PositionNode.js';\nimport UniformNode from '../core/UniformNode.js';\nimport OperatorNode from '../math/OperatorNode.js';\nimport MathNode from '../math/MathNode.js';\nimport { NodeUpdateType } from '../core/constants.js';\nimport { getDistanceAttenuation } from '../functions/BSDFs.js';\nimport { Color } from 'three';\nvar LightNode = /*#__PURE__*/function (_Node) {\n  _inherits(LightNode, _Node);\n  var _super = _createSuper(LightNode);\n  function LightNode() {\n    var _this;\n    var light = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n    _classCallCheck(this, LightNode);\n    _this = _super.call(this, 'vec3');\n    _this.updateType = NodeUpdateType.Object;\n    _this.light = light;\n    _this._colorNode = new UniformNode(new Color());\n    _this._lightCutoffDistanceNode = new UniformNode(0);\n    _this._lightDecayExponentNode = new UniformNode(0);\n    return _this;\n  }\n  _createClass(LightNode, [{\n    key: \"getHash\",\n    value: function getHash() {\n      return this.light.uuid;\n    }\n  }, {\n    key: \"update\",\n    value: function update() {\n      this._colorNode.value.copy(this.light.color).multiplyScalar(this.light.intensity);\n      this._lightCutoffDistanceNode.value = this.light.distance;\n      this._lightDecayExponentNode.value = this.light.decay;\n    }\n  }, {\n    key: \"generate\",\n    value: function generate(builder) {\n      var lightPositionView = new Object3DNode(Object3DNode.VIEW_POSITION);\n      var positionView = new PositionNode(PositionNode.VIEW);\n      var lVector = new OperatorNode('-', lightPositionView, positionView);\n      var lightDirection = new MathNode(MathNode.NORMALIZE, lVector);\n      var lightDistance = new MathNode(MathNode.LENGTH, lVector);\n      var lightAttenuation = getDistanceAttenuation({\n        lightDistance: lightDistance,\n        cutoffDistance: this._lightCutoffDistanceNode,\n        decayExponent: this._lightDecayExponentNode\n      });\n      var lightColor = new OperatorNode('*', this._colorNode, lightAttenuation);\n      lightPositionView.object3d = this.light;\n      var lightingModelFunction = builder.context.lightingModel;\n      if (lightingModelFunction !== undefined) {\n        var directDiffuse = builder.context.directDiffuse;\n        var directSpecular = builder.context.directSpecular;\n        lightingModelFunction({\n          lightDirection: lightDirection,\n          lightColor: lightColor,\n          directDiffuse: directDiffuse,\n          directSpecular: directSpecular\n        }, builder);\n      }\n    }\n  }]);\n  return LightNode;\n}(Node);\nexport default LightNode;","map":{"version":3,"names":["Node","Object3DNode","PositionNode","UniformNode","OperatorNode","MathNode","NodeUpdateType","getDistanceAttenuation","Color","LightNode","_Node","_inherits","_super","_createSuper","_this","light","arguments","length","undefined","_classCallCheck","call","updateType","Object","_colorNode","_lightCutoffDistanceNode","_lightDecayExponentNode","_createClass","key","value","getHash","uuid","update","copy","color","multiplyScalar","intensity","distance","decay","generate","builder","lightPositionView","VIEW_POSITION","positionView","VIEW","lVector","lightDirection","NORMALIZE","lightDistance","LENGTH","lightAttenuation","cutoffDistance","decayExponent","lightColor","object3d","lightingModelFunction","context","lightingModel","directDiffuse","directSpecular"],"sources":["/home/samuel/experiment/3d/farm/frontend/node_modules/three-stdlib/nodes/lights/LightNode.js"],"sourcesContent":["import Node from '../core/Node.js';\nimport Object3DNode from '../accessors/Object3DNode.js';\nimport PositionNode from '../accessors/PositionNode.js';\nimport UniformNode from '../core/UniformNode.js';\nimport OperatorNode from '../math/OperatorNode.js';\nimport MathNode from '../math/MathNode.js';\nimport { NodeUpdateType } from '../core/constants.js';\nimport { getDistanceAttenuation } from '../functions/BSDFs.js';\nimport { Color } from 'three';\n\nclass LightNode extends Node {\n  constructor(light = null) {\n    super('vec3');\n    this.updateType = NodeUpdateType.Object;\n    this.light = light;\n    this._colorNode = new UniformNode(new Color());\n    this._lightCutoffDistanceNode = new UniformNode(0);\n    this._lightDecayExponentNode = new UniformNode(0);\n  }\n\n  getHash() {\n    return this.light.uuid;\n  }\n\n  update() {\n    this._colorNode.value.copy(this.light.color).multiplyScalar(this.light.intensity);\n\n    this._lightCutoffDistanceNode.value = this.light.distance;\n    this._lightDecayExponentNode.value = this.light.decay;\n  }\n\n  generate(builder) {\n    const lightPositionView = new Object3DNode(Object3DNode.VIEW_POSITION);\n    const positionView = new PositionNode(PositionNode.VIEW);\n    const lVector = new OperatorNode('-', lightPositionView, positionView);\n    const lightDirection = new MathNode(MathNode.NORMALIZE, lVector);\n    const lightDistance = new MathNode(MathNode.LENGTH, lVector);\n    const lightAttenuation = getDistanceAttenuation({\n      lightDistance,\n      cutoffDistance: this._lightCutoffDistanceNode,\n      decayExponent: this._lightDecayExponentNode\n    });\n    const lightColor = new OperatorNode('*', this._colorNode, lightAttenuation);\n    lightPositionView.object3d = this.light;\n    const lightingModelFunction = builder.context.lightingModel;\n\n    if (lightingModelFunction !== undefined) {\n      const directDiffuse = builder.context.directDiffuse;\n      const directSpecular = builder.context.directSpecular;\n      lightingModelFunction({\n        lightDirection,\n        lightColor,\n        directDiffuse,\n        directSpecular\n      }, builder);\n    }\n  }\n\n}\n\nexport default LightNode;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}