{"ast":null,"code":"import _classCallCheck from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _assertThisInitialized from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";\nimport _inherits from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport _defineProperty from '@babel/runtime/helpers/esm/defineProperty';\nimport { Pass, FullScreenQuad } from './Pass.js';\nimport { WebGLRenderTarget, NearestFilter, MeshDepthMaterial, RGBADepthPacking, NoBlending, UniformsUtils, ShaderMaterial, Color } from 'three';\nimport { BokehShader } from '../shaders/BokehShader.js';\nvar BokehPass = /*#__PURE__*/function (_Pass) {\n  _inherits(BokehPass, _Pass);\n  var _super = _createSuper(BokehPass);\n  function BokehPass(scene, camera, params) {\n    var _this;\n    _classCallCheck(this, BokehPass);\n    _this = _super.call(this);\n    _defineProperty(_assertThisInitialized(_this), \"scene\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"camera\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"renderTargetDepth\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"materialDepth\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"materialBokeh\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"fsQuad\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_oldClearColor\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"uniforms\", void 0);\n    _this.scene = scene;\n    _this.camera = camera;\n    var focus = params.focus !== undefined ? params.focus : 1.0;\n    var aspect = params.aspect !== undefined ? params.aspect : camera.aspect;\n    var aperture = params.aperture !== undefined ? params.aperture : 0.025;\n    var maxblur = params.maxblur !== undefined ? params.maxblur : 1.0; // render targets\n\n    var width = params.width || window.innerWidth || 1;\n    var height = params.height || window.innerHeight || 1;\n    _this.renderTargetDepth = new WebGLRenderTarget(width, height, {\n      minFilter: NearestFilter,\n      magFilter: NearestFilter\n    });\n    _this.renderTargetDepth.texture.name = 'BokehPass.depth'; // depth material\n\n    _this.materialDepth = new MeshDepthMaterial();\n    _this.materialDepth.depthPacking = RGBADepthPacking;\n    _this.materialDepth.blending = NoBlending; // bokeh material\n\n    if (BokehShader === undefined) {\n      console.error('BokehPass relies on BokehShader');\n    }\n    var bokehShader = BokehShader;\n    var bokehUniforms = UniformsUtils.clone(bokehShader.uniforms);\n    bokehUniforms['tDepth'].value = _this.renderTargetDepth.texture;\n    bokehUniforms['focus'].value = focus;\n    bokehUniforms['aspect'].value = aspect;\n    bokehUniforms['aperture'].value = aperture;\n    bokehUniforms['maxblur'].value = maxblur;\n    bokehUniforms['nearClip'].value = camera.near;\n    bokehUniforms['farClip'].value = camera.far;\n    _this.materialBokeh = new ShaderMaterial({\n      defines: Object.assign({}, bokehShader.defines),\n      uniforms: bokehUniforms,\n      vertexShader: bokehShader.vertexShader,\n      fragmentShader: bokehShader.fragmentShader\n    });\n    _this.uniforms = bokehUniforms;\n    _this.needsSwap = false;\n    _this.fsQuad = new FullScreenQuad(_this.materialBokeh);\n    _this._oldClearColor = new Color();\n    return _this;\n  }\n  _createClass(BokehPass, [{\n    key: \"render\",\n    value: function render(renderer, writeBuffer, readBuffer\n    /*, deltaTime, maskActive */) {\n      // Render depth into texture\n      this.scene.overrideMaterial = this.materialDepth;\n      renderer.getClearColor(this._oldClearColor);\n      var oldClearAlpha = renderer.getClearAlpha();\n      var oldAutoClear = renderer.autoClear;\n      renderer.autoClear = false;\n      renderer.setClearColor(0xffffff);\n      renderer.setClearAlpha(1.0);\n      renderer.setRenderTarget(this.renderTargetDepth);\n      renderer.clear();\n      renderer.render(this.scene, this.camera); // Render bokeh composite\n\n      this.uniforms['tColor'].value = readBuffer.texture;\n      this.uniforms['nearClip'].value = this.camera.near;\n      this.uniforms['farClip'].value = this.camera.far;\n      if (this.renderToScreen) {\n        renderer.setRenderTarget(null);\n        this.fsQuad.render(renderer);\n      } else {\n        renderer.setRenderTarget(writeBuffer);\n        renderer.clear();\n        this.fsQuad.render(renderer);\n      }\n      this.scene.overrideMaterial = null;\n      renderer.setClearColor(this._oldClearColor);\n      renderer.setClearAlpha(oldClearAlpha);\n      renderer.autoClear = oldAutoClear;\n    }\n  }]);\n  return BokehPass;\n}(Pass);\nexport { BokehPass };","map":{"version":3,"names":["_defineProperty","Pass","FullScreenQuad","WebGLRenderTarget","NearestFilter","MeshDepthMaterial","RGBADepthPacking","NoBlending","UniformsUtils","ShaderMaterial","Color","BokehShader","BokehPass","_Pass","_inherits","_super","_createSuper","scene","camera","params","_this","_classCallCheck","call","_assertThisInitialized","focus","undefined","aspect","aperture","maxblur","width","window","innerWidth","height","innerHeight","renderTargetDepth","minFilter","magFilter","texture","name","materialDepth","depthPacking","blending","console","error","bokehShader","bokehUniforms","clone","uniforms","value","near","far","materialBokeh","defines","Object","assign","vertexShader","fragmentShader","needsSwap","fsQuad","_oldClearColor","_createClass","key","render","renderer","writeBuffer","readBuffer","overrideMaterial","getClearColor","oldClearAlpha","getClearAlpha","oldAutoClear","autoClear","setClearColor","setClearAlpha","setRenderTarget","clear","renderToScreen"],"sources":["/home/samuel/experiment/3d/farm/frontend/node_modules/three-stdlib/postprocessing/BokehPass.js"],"sourcesContent":["import _defineProperty from '@babel/runtime/helpers/esm/defineProperty';\nimport { Pass, FullScreenQuad } from './Pass.js';\nimport { WebGLRenderTarget, NearestFilter, MeshDepthMaterial, RGBADepthPacking, NoBlending, UniformsUtils, ShaderMaterial, Color } from 'three';\nimport { BokehShader } from '../shaders/BokehShader.js';\n\nclass BokehPass extends Pass {\n  constructor(scene, camera, params) {\n    super();\n\n    _defineProperty(this, \"scene\", void 0);\n\n    _defineProperty(this, \"camera\", void 0);\n\n    _defineProperty(this, \"renderTargetDepth\", void 0);\n\n    _defineProperty(this, \"materialDepth\", void 0);\n\n    _defineProperty(this, \"materialBokeh\", void 0);\n\n    _defineProperty(this, \"fsQuad\", void 0);\n\n    _defineProperty(this, \"_oldClearColor\", void 0);\n\n    _defineProperty(this, \"uniforms\", void 0);\n\n    this.scene = scene;\n    this.camera = camera;\n    const focus = params.focus !== undefined ? params.focus : 1.0;\n    const aspect = params.aspect !== undefined ? params.aspect : camera.aspect;\n    const aperture = params.aperture !== undefined ? params.aperture : 0.025;\n    const maxblur = params.maxblur !== undefined ? params.maxblur : 1.0; // render targets\n\n    const width = params.width || window.innerWidth || 1;\n    const height = params.height || window.innerHeight || 1;\n    this.renderTargetDepth = new WebGLRenderTarget(width, height, {\n      minFilter: NearestFilter,\n      magFilter: NearestFilter\n    });\n    this.renderTargetDepth.texture.name = 'BokehPass.depth'; // depth material\n\n    this.materialDepth = new MeshDepthMaterial();\n    this.materialDepth.depthPacking = RGBADepthPacking;\n    this.materialDepth.blending = NoBlending; // bokeh material\n\n    if (BokehShader === undefined) {\n      console.error('BokehPass relies on BokehShader');\n    }\n\n    const bokehShader = BokehShader;\n    const bokehUniforms = UniformsUtils.clone(bokehShader.uniforms);\n    bokehUniforms['tDepth'].value = this.renderTargetDepth.texture;\n    bokehUniforms['focus'].value = focus;\n    bokehUniforms['aspect'].value = aspect;\n    bokehUniforms['aperture'].value = aperture;\n    bokehUniforms['maxblur'].value = maxblur;\n    bokehUniforms['nearClip'].value = camera.near;\n    bokehUniforms['farClip'].value = camera.far;\n    this.materialBokeh = new ShaderMaterial({\n      defines: Object.assign({}, bokehShader.defines),\n      uniforms: bokehUniforms,\n      vertexShader: bokehShader.vertexShader,\n      fragmentShader: bokehShader.fragmentShader\n    });\n    this.uniforms = bokehUniforms;\n    this.needsSwap = false;\n    this.fsQuad = new FullScreenQuad(this.materialBokeh);\n    this._oldClearColor = new Color();\n  }\n\n  render(renderer, writeBuffer, readBuffer\n  /*, deltaTime, maskActive */\n  ) {\n    // Render depth into texture\n    this.scene.overrideMaterial = this.materialDepth;\n    renderer.getClearColor(this._oldClearColor);\n    const oldClearAlpha = renderer.getClearAlpha();\n    const oldAutoClear = renderer.autoClear;\n    renderer.autoClear = false;\n    renderer.setClearColor(0xffffff);\n    renderer.setClearAlpha(1.0);\n    renderer.setRenderTarget(this.renderTargetDepth);\n    renderer.clear();\n    renderer.render(this.scene, this.camera); // Render bokeh composite\n\n    this.uniforms['tColor'].value = readBuffer.texture;\n    this.uniforms['nearClip'].value = this.camera.near;\n    this.uniforms['farClip'].value = this.camera.far;\n\n    if (this.renderToScreen) {\n      renderer.setRenderTarget(null);\n      this.fsQuad.render(renderer);\n    } else {\n      renderer.setRenderTarget(writeBuffer);\n      renderer.clear();\n      this.fsQuad.render(renderer);\n    }\n\n    this.scene.overrideMaterial = null;\n    renderer.setClearColor(this._oldClearColor);\n    renderer.setClearAlpha(oldClearAlpha);\n    renderer.autoClear = oldAutoClear;\n  }\n\n}\n\nexport { BokehPass };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}