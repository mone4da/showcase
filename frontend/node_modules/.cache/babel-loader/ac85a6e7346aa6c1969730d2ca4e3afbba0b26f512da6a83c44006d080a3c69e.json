{"ast":null,"code":"import _createForOfIteratorHelper from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport _classCallCheck from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _assertThisInitialized from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";\nimport _inherits from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/home/samuel/experiment/3d/farm/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport _defineProperty from '@babel/runtime/helpers/esm/defineProperty';\nimport { Matrix4, EventDispatcher, EllipseCurve, BufferGeometry, MathUtils, Vector3, GridHelper, LineBasicMaterial, Line, Raycaster, Vector2, Quaternion, Group, Box3, Sphere } from 'three';\n\n//trackball state\nvar STATE = {\n  IDLE: Symbol(),\n  ROTATE: Symbol(),\n  PAN: Symbol(),\n  SCALE: Symbol(),\n  FOV: Symbol(),\n  FOCUS: Symbol(),\n  ZROTATE: Symbol(),\n  TOUCH_MULTI: Symbol(),\n  ANIMATION_FOCUS: Symbol(),\n  ANIMATION_ROTATE: Symbol()\n};\nvar INPUT = {\n  NONE: Symbol(),\n  ONE_FINGER: Symbol(),\n  ONE_FINGER_SWITCHED: Symbol(),\n  TWO_FINGER: Symbol(),\n  MULT_FINGER: Symbol(),\n  CURSOR: Symbol()\n}; //cursor center coordinates\n\nvar _center = {\n  x: 0,\n  y: 0\n}; //transformation matrices for gizmos and camera\n\nvar _transformation = {\n  camera: new Matrix4(),\n  gizmos: new Matrix4()\n}; //events\n\nvar _changeEvent = {\n  type: 'change'\n};\nvar _startEvent = {\n  type: 'start'\n};\nvar _endEvent = {\n  type: 'end'\n};\n/**\n *\n * @param {CamOrthographicCamera | PerspectiveCameraera} camera Virtual camera used in the scene\n * @param {HTMLElement=null} domElement Renderer's dom element\n * @param {Scene=null} scene The scene to be rendered\n */\nvar ArcballControls = /*#__PURE__*/function (_EventDispatcher) {\n  _inherits(ArcballControls, _EventDispatcher);\n  var _super = _createSuper(ArcballControls);\n  function ArcballControls(_camera) {\n    var _this;\n    var _domElement = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    var scene = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n    _classCallCheck(this, ArcballControls);\n    _this = _super.call(this);\n    _defineProperty(_assertThisInitialized(_this), \"camera\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"domElement\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"scene\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"mouseActions\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_mouseOp\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_v2_1\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_v3_1\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_v3_2\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_m4_1\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_m4_2\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_quat\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_translationMatrix\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_rotationMatrix\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_scaleMatrix\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_rotationAxis\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_cameraMatrixState\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_cameraProjectionState\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_fovState\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_upState\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_zoomState\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_nearPos\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_farPos\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_gizmoMatrixState\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_up0\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_zoom0\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_fov0\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_initialNear\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_nearPos0\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_initialFar\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_farPos0\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_cameraMatrixState0\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_gizmoMatrixState0\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_button\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_touchStart\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_touchCurrent\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_input\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_switchSensibility\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_startFingerDistance\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_currentFingerDistance\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_startFingerRotation\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_currentFingerRotation\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_devPxRatio\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_downValid\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_nclicks\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_downEvents\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_clickStart\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_maxDownTime\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_maxInterval\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_posThreshold\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_movementThreshold\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_currentCursorPosition\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_startCursorPosition\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_grid\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_gridPosition\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_gizmos\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_curvePts\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_timeStart\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_animationId\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"focusAnimationTime\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_timePrev\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_timeCurrent\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_anglePrev\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_angleCurrent\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_cursorPosPrev\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_cursorPosCurr\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_wPrev\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_wCurr\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"adjustNearFar\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"scaleFactor\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"dampingFactor\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"wMax\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"enableAnimations\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"enableGrid\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"cursorZoom\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"minFov\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"maxFov\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"enabled\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"enablePan\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"enableRotate\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"enableZoom\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"minDistance\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"maxDistance\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"minZoom\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"maxZoom\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"target\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_currentTarget\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_tbRadius\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_state\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"onWindowResize\", function () {\n      var scale = (_this._gizmos.scale.x + _this._gizmos.scale.y + _this._gizmos.scale.z) / 3;\n      if (_this.camera) {\n        var tbRadius = _this.calculateTbRadius(_this.camera);\n        if (tbRadius !== undefined) {\n          _this._tbRadius = tbRadius;\n        }\n      }\n      var newRadius = _this._tbRadius / scale; // @ts-expect-error\n\n      var curve = new EllipseCurve(0, 0, newRadius, newRadius);\n      var points = curve.getPoints(_this._curvePts);\n      var curveGeometry = new BufferGeometry().setFromPoints(points);\n      for (var gizmo in _this._gizmos.children) {\n        var child = _this._gizmos.children[gizmo];\n        child.geometry = curveGeometry;\n      }\n      _this.dispatchEvent(_changeEvent);\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onContextMenu\", function (event) {\n      if (!_this.enabled) {\n        return;\n      }\n      for (var i = 0; i < _this.mouseActions.length; i++) {\n        if (_this.mouseActions[i].mouse == 2) {\n          //prevent only if button 2 is actually used\n          event.preventDefault();\n          break;\n        }\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onPointerCancel\", function () {\n      _this._touchStart.splice(0, _this._touchStart.length);\n      _this._touchCurrent.splice(0, _this._touchCurrent.length);\n      _this._input = INPUT.NONE;\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onPointerDown\", function (event) {\n      if (event.button == 0 && event.isPrimary) {\n        _this._downValid = true;\n        _this._downEvents.push(event);\n      } else {\n        _this._downValid = false;\n      }\n      if (event.pointerType == 'touch' && _this._input != INPUT.CURSOR) {\n        _this._touchStart.push(event);\n        _this._touchCurrent.push(event);\n        switch (_this._input) {\n          case INPUT.NONE:\n            //singleStart\n            _this._input = INPUT.ONE_FINGER;\n            _this.onSinglePanStart(event, 'ROTATE');\n            window.addEventListener('pointermove', _this.onPointerMove);\n            window.addEventListener('pointerup', _this.onPointerUp);\n            break;\n          case INPUT.ONE_FINGER:\n          case INPUT.ONE_FINGER_SWITCHED:\n            //doubleStart\n            _this._input = INPUT.TWO_FINGER;\n            _this.onRotateStart();\n            _this.onPinchStart();\n            _this.onDoublePanStart();\n            break;\n          case INPUT.TWO_FINGER:\n            //multipleStart\n            _this._input = INPUT.MULT_FINGER;\n            _this.onTriplePanStart();\n            break;\n        }\n      } else if (event.pointerType != 'touch' && _this._input == INPUT.NONE) {\n        var modifier = null;\n        if (event.ctrlKey || event.metaKey) {\n          modifier = 'CTRL';\n        } else if (event.shiftKey) {\n          modifier = 'SHIFT';\n        }\n        _this._mouseOp = _this.getOpFromAction(event.button, modifier);\n        if (_this._mouseOp) {\n          window.addEventListener('pointermove', _this.onPointerMove);\n          window.addEventListener('pointerup', _this.onPointerUp); //singleStart\n\n          _this._input = INPUT.CURSOR;\n          _this._button = event.button;\n          _this.onSinglePanStart(event, _this._mouseOp);\n        }\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onPointerMove\", function (event) {\n      if (event.pointerType == 'touch' && _this._input != INPUT.CURSOR) {\n        switch (_this._input) {\n          case INPUT.ONE_FINGER:\n            //singleMove\n            _this.updateTouchEvent(event);\n            _this.onSinglePanMove(event, STATE.ROTATE);\n            break;\n          case INPUT.ONE_FINGER_SWITCHED:\n            var movement = _this.calculatePointersDistance(_this._touchCurrent[0], event) * _this._devPxRatio;\n            if (movement >= _this._switchSensibility) {\n              //singleMove\n              _this._input = INPUT.ONE_FINGER;\n              _this.updateTouchEvent(event);\n              _this.onSinglePanStart(event, 'ROTATE');\n              break;\n            }\n            break;\n          case INPUT.TWO_FINGER:\n            //rotate/pan/pinchMove\n            _this.updateTouchEvent(event);\n            _this.onRotateMove();\n            _this.onPinchMove();\n            _this.onDoublePanMove();\n            break;\n          case INPUT.MULT_FINGER:\n            //multMove\n            _this.updateTouchEvent(event);\n            _this.onTriplePanMove();\n            break;\n        }\n      } else if (event.pointerType != 'touch' && _this._input == INPUT.CURSOR) {\n        var modifier = null;\n        if (event.ctrlKey || event.metaKey) {\n          modifier = 'CTRL';\n        } else if (event.shiftKey) {\n          modifier = 'SHIFT';\n        }\n        var mouseOpState = _this.getOpStateFromAction(_this._button, modifier);\n        if (mouseOpState) {\n          _this.onSinglePanMove(event, mouseOpState);\n        }\n      } //checkDistance\n\n      if (_this._downValid) {\n        var _movement = _this.calculatePointersDistance(_this._downEvents[_this._downEvents.length - 1], event) * _this._devPxRatio;\n        if (_movement > _this._movementThreshold) {\n          _this._downValid = false;\n        }\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onPointerUp\", function (event) {\n      if (event.pointerType == 'touch' && _this._input != INPUT.CURSOR) {\n        var nTouch = _this._touchCurrent.length;\n        for (var i = 0; i < nTouch; i++) {\n          if (_this._touchCurrent[i].pointerId == event.pointerId) {\n            _this._touchCurrent.splice(i, 1);\n            _this._touchStart.splice(i, 1);\n            break;\n          }\n        }\n        switch (_this._input) {\n          case INPUT.ONE_FINGER:\n          case INPUT.ONE_FINGER_SWITCHED:\n            //singleEnd\n            window.removeEventListener('pointermove', _this.onPointerMove);\n            window.removeEventListener('pointerup', _this.onPointerUp);\n            _this._input = INPUT.NONE;\n            _this.onSinglePanEnd();\n            break;\n          case INPUT.TWO_FINGER:\n            //doubleEnd\n            _this.onDoublePanEnd();\n            _this.onPinchEnd();\n            _this.onRotateEnd(); //switching to singleStart\n\n            _this._input = INPUT.ONE_FINGER_SWITCHED;\n            break;\n          case INPUT.MULT_FINGER:\n            if (_this._touchCurrent.length == 0) {\n              window.removeEventListener('pointermove', _this.onPointerMove);\n              window.removeEventListener('pointerup', _this.onPointerUp); //multCancel\n\n              _this._input = INPUT.NONE;\n              _this.onTriplePanEnd();\n            }\n            break;\n        }\n      } else if (event.pointerType != 'touch' && _this._input == INPUT.CURSOR) {\n        window.removeEventListener('pointermove', _this.onPointerMove);\n        window.removeEventListener('pointerup', _this.onPointerUp);\n        _this._input = INPUT.NONE;\n        _this.onSinglePanEnd();\n        _this._button = -1;\n      }\n      if (event.isPrimary) {\n        if (_this._downValid) {\n          var downTime = event.timeStamp - _this._downEvents[_this._downEvents.length - 1].timeStamp;\n          if (downTime <= _this._maxDownTime) {\n            if (_this._nclicks == 0) {\n              //first valid click detected\n              _this._nclicks = 1;\n              _this._clickStart = performance.now();\n            } else {\n              var clickInterval = event.timeStamp - _this._clickStart;\n              var movement = _this.calculatePointersDistance(_this._downEvents[1], _this._downEvents[0]) * _this._devPxRatio;\n              if (clickInterval <= _this._maxInterval && movement <= _this._posThreshold) {\n                //second valid click detected\n                //fire double tap and reset values\n                _this._nclicks = 0;\n                _this._downEvents.splice(0, _this._downEvents.length);\n                _this.onDoubleTap(event);\n              } else {\n                //new 'first click'\n                _this._nclicks = 1;\n                _this._downEvents.shift();\n                _this._clickStart = performance.now();\n              }\n            }\n          } else {\n            _this._downValid = false;\n            _this._nclicks = 0;\n            _this._downEvents.splice(0, _this._downEvents.length);\n          }\n        } else {\n          _this._nclicks = 0;\n          _this._downEvents.splice(0, _this._downEvents.length);\n        }\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onWheel\", function (event) {\n      var _this$camera3;\n      if (_this.enabled && _this.enableZoom && _this.domElement) {\n        var modifier = null;\n        if (event.ctrlKey || event.metaKey) {\n          modifier = 'CTRL';\n        } else if (event.shiftKey) {\n          modifier = 'SHIFT';\n        }\n        var mouseOp = _this.getOpFromAction('WHEEL', modifier);\n        if (mouseOp) {\n          event.preventDefault();\n          _this.dispatchEvent(_startEvent);\n          var notchDeltaY = 125; //distance of one notch of mouse wheel\n\n          var sgn = event.deltaY / notchDeltaY;\n          var size = 1;\n          if (sgn > 0) {\n            size = 1 / _this.scaleFactor;\n          } else if (sgn < 0) {\n            size = _this.scaleFactor;\n          }\n          switch (mouseOp) {\n            case 'ZOOM':\n              _this.updateTbState(STATE.SCALE, true);\n              if (sgn > 0) {\n                size = 1 / Math.pow(_this.scaleFactor, sgn);\n              } else if (sgn < 0) {\n                size = Math.pow(_this.scaleFactor, -sgn);\n              }\n              if (_this.cursorZoom && _this.enablePan) {\n                var _this$camera, _this$camera2;\n                var scalePoint;\n                if (((_this$camera = _this.camera) === null || _this$camera === void 0 ? void 0 : _this$camera.type) === 'OrthographicCamera') {\n                  var _this$unprojectOnTbPl;\n                  scalePoint = (_this$unprojectOnTbPl = _this.unprojectOnTbPlane(_this.camera, event.clientX, event.clientY, _this.domElement)) === null || _this$unprojectOnTbPl === void 0 ? void 0 : _this$unprojectOnTbPl.applyQuaternion(_this.camera.quaternion).multiplyScalar(1 / _this.camera.zoom).add(_this._gizmos.position);\n                }\n                if (((_this$camera2 = _this.camera) === null || _this$camera2 === void 0 ? void 0 : _this$camera2.type) === 'PerspectiveCamera') {\n                  var _this$unprojectOnTbPl2;\n                  scalePoint = (_this$unprojectOnTbPl2 = _this.unprojectOnTbPlane(_this.camera, event.clientX, event.clientY, _this.domElement)) === null || _this$unprojectOnTbPl2 === void 0 ? void 0 : _this$unprojectOnTbPl2.applyQuaternion(_this.camera.quaternion).add(_this._gizmos.position);\n                }\n                if (scalePoint !== undefined) _this.applyTransformMatrix(_this.applyScale(size, scalePoint));\n              } else {\n                _this.applyTransformMatrix(_this.applyScale(size, _this._gizmos.position));\n              }\n              if (_this._grid) {\n                _this.disposeGrid();\n                _this.drawGrid();\n              }\n              _this.updateTbState(STATE.IDLE, false);\n              _this.dispatchEvent(_changeEvent);\n              _this.dispatchEvent(_endEvent);\n              break;\n            case 'FOV':\n              if (((_this$camera3 = _this.camera) === null || _this$camera3 === void 0 ? void 0 : _this$camera3.type) === 'PerspectiveCamera') {\n                _this.updateTbState(STATE.FOV, true); //Vertigo effect\n                //\t  fov / 2\n                //\t\t|\\\n                //\t\t| \\\n                //\t\t|  \\\n                //\tx\t|\t\\\n                //\t\t| \t \\\n                //\t\t| \t  \\\n                //\t\t| _ _ _\\\n                //\t\t\ty\n                //check for iOs shift shortcut\n\n                if (event.deltaX != 0) {\n                  sgn = event.deltaX / notchDeltaY;\n                  size = 1;\n                  if (sgn > 0) {\n                    size = 1 / Math.pow(_this.scaleFactor, sgn);\n                  } else if (sgn < 0) {\n                    size = Math.pow(_this.scaleFactor, -sgn);\n                  }\n                }\n                _this._v3_1.setFromMatrixPosition(_this._cameraMatrixState);\n                var x = _this._v3_1.distanceTo(_this._gizmos.position);\n                var xNew = x / size; //distance between camera and gizmos if scale(size, scalepoint) would be performed\n                //check min and max distance\n\n                xNew = MathUtils.clamp(xNew, _this.minDistance, _this.maxDistance);\n                var y = x * Math.tan(MathUtils.DEG2RAD * _this.camera.fov * 0.5); //calculate new fov\n\n                var newFov = MathUtils.RAD2DEG * (Math.atan(y / xNew) * 2); //check min and max fov\n\n                if (newFov > _this.maxFov) {\n                  newFov = _this.maxFov;\n                } else if (newFov < _this.minFov) {\n                  newFov = _this.minFov;\n                }\n                var newDistance = y / Math.tan(MathUtils.DEG2RAD * (newFov / 2));\n                size = x / newDistance;\n                _this.setFov(newFov);\n                _this.applyTransformMatrix(_this.applyScale(size, _this._gizmos.position, false));\n              }\n              if (_this._grid) {\n                _this.disposeGrid();\n                _this.drawGrid();\n              }\n              _this.updateTbState(STATE.IDLE, false);\n              _this.dispatchEvent(_changeEvent);\n              _this.dispatchEvent(_endEvent);\n              break;\n          }\n        }\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onSinglePanStart\", function (event, operation) {\n      var _this$camera4;\n      if (_this.enabled && _this.domElement) {\n        _this.dispatchEvent(_startEvent);\n        _this.setCenter(event.clientX, event.clientY);\n        switch (operation) {\n          case 'PAN':\n            if (!_this.enablePan) return;\n            if (_this._animationId != -1) {\n              cancelAnimationFrame(_this._animationId);\n              _this._animationId = -1;\n              _this._timeStart = -1;\n              _this.activateGizmos(false);\n              _this.dispatchEvent(_changeEvent);\n            }\n            if (_this.camera) {\n              _this.updateTbState(STATE.PAN, true);\n              var rayDir = _this.unprojectOnTbPlane(_this.camera, _center.x, _center.y, _this.domElement);\n              if (rayDir !== undefined) {\n                _this._startCursorPosition.copy(rayDir);\n              }\n              if (_this.enableGrid) {\n                _this.drawGrid();\n                _this.dispatchEvent(_changeEvent);\n              }\n            }\n            break;\n          case 'ROTATE':\n            if (!_this.enableRotate) return;\n            if (_this._animationId != -1) {\n              cancelAnimationFrame(_this._animationId);\n              _this._animationId = -1;\n              _this._timeStart = -1;\n            }\n            if (_this.camera) {\n              _this.updateTbState(STATE.ROTATE, true);\n              var _rayDir = _this.unprojectOnTbSurface(_this.camera, _center.x, _center.y, _this.domElement, _this._tbRadius);\n              if (_rayDir !== undefined) {\n                _this._startCursorPosition.copy(_rayDir);\n              }\n              _this.activateGizmos(true);\n              if (_this.enableAnimations) {\n                _this._timePrev = _this._timeCurrent = performance.now();\n                _this._angleCurrent = _this._anglePrev = 0;\n                _this._cursorPosPrev.copy(_this._startCursorPosition);\n                _this._cursorPosCurr.copy(_this._cursorPosPrev);\n                _this._wCurr = 0;\n                _this._wPrev = _this._wCurr;\n              }\n            }\n            _this.dispatchEvent(_changeEvent);\n            break;\n          case 'FOV':\n            if (!_this.enableZoom) return;\n            if (((_this$camera4 = _this.camera) === null || _this$camera4 === void 0 ? void 0 : _this$camera4.type) === 'PerspectiveCamera') {\n              if (_this._animationId != -1) {\n                cancelAnimationFrame(_this._animationId);\n                _this._animationId = -1;\n                _this._timeStart = -1;\n                _this.activateGizmos(false);\n                _this.dispatchEvent(_changeEvent);\n              }\n              _this.updateTbState(STATE.FOV, true);\n              _this._startCursorPosition.setY(_this.getCursorNDC(_center.x, _center.y, _this.domElement).y * 0.5);\n              _this._currentCursorPosition.copy(_this._startCursorPosition);\n            }\n            break;\n          case 'ZOOM':\n            if (!_this.enableZoom) return;\n            if (_this._animationId != -1) {\n              cancelAnimationFrame(_this._animationId);\n              _this._animationId = -1;\n              _this._timeStart = -1;\n              _this.activateGizmos(false);\n              _this.dispatchEvent(_changeEvent);\n            }\n            _this.updateTbState(STATE.SCALE, true);\n            _this._startCursorPosition.setY(_this.getCursorNDC(_center.x, _center.y, _this.domElement).y * 0.5);\n            _this._currentCursorPosition.copy(_this._startCursorPosition);\n            break;\n        }\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onSinglePanMove\", function (event, opState) {\n      var _this$camera5;\n      if (_this.enabled && _this.domElement) {\n        var restart = opState != _this._state;\n        _this.setCenter(event.clientX, event.clientY);\n        switch (opState) {\n          case STATE.PAN:\n            if (_this.enablePan && _this.camera) {\n              if (restart) {\n                //switch to pan operation\n                _this.dispatchEvent(_endEvent);\n                _this.dispatchEvent(_startEvent);\n                _this.updateTbState(opState, true);\n                var rayDir = _this.unprojectOnTbPlane(_this.camera, _center.x, _center.y, _this.domElement);\n                if (rayDir !== undefined) {\n                  _this._startCursorPosition.copy(rayDir);\n                }\n                if (_this.enableGrid) {\n                  _this.drawGrid();\n                }\n                _this.activateGizmos(false);\n              } else {\n                //continue with pan operation\n                var _rayDir2 = _this.unprojectOnTbPlane(_this.camera, _center.x, _center.y, _this.domElement);\n                if (_rayDir2 !== undefined) {\n                  _this._currentCursorPosition.copy(_rayDir2);\n                }\n                _this.applyTransformMatrix(_this.pan(_this._startCursorPosition, _this._currentCursorPosition));\n              }\n            }\n            break;\n          case STATE.ROTATE:\n            if (_this.enableRotate && _this.camera) {\n              if (restart) {\n                //switch to rotate operation\n                _this.dispatchEvent(_endEvent);\n                _this.dispatchEvent(_startEvent);\n                _this.updateTbState(opState, true);\n                var _rayDir3 = _this.unprojectOnTbSurface(_this.camera, _center.x, _center.y, _this.domElement, _this._tbRadius);\n                if (_rayDir3 !== undefined) {\n                  _this._startCursorPosition.copy(_rayDir3);\n                }\n                if (_this.enableGrid) {\n                  _this.disposeGrid();\n                }\n                _this.activateGizmos(true);\n              } else {\n                //continue with rotate operation\n                var _rayDir4 = _this.unprojectOnTbSurface(_this.camera, _center.x, _center.y, _this.domElement, _this._tbRadius);\n                if (_rayDir4 !== undefined) {\n                  _this._currentCursorPosition.copy(_rayDir4);\n                }\n                var distance = _this._startCursorPosition.distanceTo(_this._currentCursorPosition);\n                var angle = _this._startCursorPosition.angleTo(_this._currentCursorPosition);\n                var amount = Math.max(distance / _this._tbRadius, angle); //effective rotation angle\n\n                _this.applyTransformMatrix(_this.rotate(_this.calculateRotationAxis(_this._startCursorPosition, _this._currentCursorPosition), amount));\n                if (_this.enableAnimations) {\n                  _this._timePrev = _this._timeCurrent;\n                  _this._timeCurrent = performance.now();\n                  _this._anglePrev = _this._angleCurrent;\n                  _this._angleCurrent = amount;\n                  _this._cursorPosPrev.copy(_this._cursorPosCurr);\n                  _this._cursorPosCurr.copy(_this._currentCursorPosition);\n                  _this._wPrev = _this._wCurr;\n                  _this._wCurr = _this.calculateAngularSpeed(_this._anglePrev, _this._angleCurrent, _this._timePrev, _this._timeCurrent);\n                }\n              }\n            }\n            break;\n          case STATE.SCALE:\n            if (_this.enableZoom) {\n              if (restart) {\n                //switch to zoom operation\n                _this.dispatchEvent(_endEvent);\n                _this.dispatchEvent(_startEvent);\n                _this.updateTbState(opState, true);\n                _this._startCursorPosition.setY(_this.getCursorNDC(_center.x, _center.y, _this.domElement).y * 0.5);\n                _this._currentCursorPosition.copy(_this._startCursorPosition);\n                if (_this.enableGrid) {\n                  _this.disposeGrid();\n                }\n                _this.activateGizmos(false);\n              } else {\n                //continue with zoom operation\n                var screenNotches = 8; //how many wheel notches corresponds to a full screen pan\n\n                _this._currentCursorPosition.setY(_this.getCursorNDC(_center.x, _center.y, _this.domElement).y * 0.5);\n                var movement = _this._currentCursorPosition.y - _this._startCursorPosition.y;\n                var size = 1;\n                if (movement < 0) {\n                  size = 1 / Math.pow(_this.scaleFactor, -movement * screenNotches);\n                } else if (movement > 0) {\n                  size = Math.pow(_this.scaleFactor, movement * screenNotches);\n                }\n                _this.applyTransformMatrix(_this.applyScale(size, _this._gizmos.position));\n              }\n            }\n            break;\n          case STATE.FOV:\n            if (_this.enableZoom && ((_this$camera5 = _this.camera) === null || _this$camera5 === void 0 ? void 0 : _this$camera5.type) === 'PerspectiveCamera') {\n              if (restart) {\n                //switch to fov operation\n                _this.dispatchEvent(_endEvent);\n                _this.dispatchEvent(_startEvent);\n                _this.updateTbState(opState, true);\n                _this._startCursorPosition.setY(_this.getCursorNDC(_center.x, _center.y, _this.domElement).y * 0.5);\n                _this._currentCursorPosition.copy(_this._startCursorPosition);\n                if (_this.enableGrid) {\n                  _this.disposeGrid();\n                }\n                _this.activateGizmos(false);\n              } else {\n                //continue with fov operation\n                var _screenNotches = 8; //how many wheel notches corresponds to a full screen pan\n\n                _this._currentCursorPosition.setY(_this.getCursorNDC(_center.x, _center.y, _this.domElement).y * 0.5);\n                var _movement2 = _this._currentCursorPosition.y - _this._startCursorPosition.y;\n                var _size = 1;\n                if (_movement2 < 0) {\n                  _size = 1 / Math.pow(_this.scaleFactor, -_movement2 * _screenNotches);\n                } else if (_movement2 > 0) {\n                  _size = Math.pow(_this.scaleFactor, _movement2 * _screenNotches);\n                }\n                _this._v3_1.setFromMatrixPosition(_this._cameraMatrixState);\n                var x = _this._v3_1.distanceTo(_this._gizmos.position);\n                var xNew = x / _size; //distance between camera and gizmos if scale(size, scalepoint) would be performed\n                //check min and max distance\n\n                xNew = MathUtils.clamp(xNew, _this.minDistance, _this.maxDistance);\n                var y = x * Math.tan(MathUtils.DEG2RAD * _this._fovState * 0.5); //calculate new fov\n\n                var newFov = MathUtils.RAD2DEG * (Math.atan(y / xNew) * 2); //check min and max fov\n\n                newFov = MathUtils.clamp(newFov, _this.minFov, _this.maxFov);\n                var newDistance = y / Math.tan(MathUtils.DEG2RAD * (newFov / 2));\n                _size = x / newDistance;\n                _this._v3_2.setFromMatrixPosition(_this._gizmoMatrixState);\n                _this.setFov(newFov);\n                _this.applyTransformMatrix(_this.applyScale(_size, _this._v3_2, false)); //adjusting distance\n\n                var direction = _this._gizmos.position.clone().sub(_this.camera.position).normalize().multiplyScalar(newDistance / x);\n                _this._m4_1.makeTranslation(direction.x, direction.y, direction.z);\n              }\n            }\n            break;\n        }\n        _this.dispatchEvent(_changeEvent);\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onSinglePanEnd\", function () {\n      if (_this._state == STATE.ROTATE) {\n        if (!_this.enableRotate) {\n          return;\n        }\n        if (_this.enableAnimations) {\n          //perform rotation animation\n          var deltaTime = performance.now() - _this._timeCurrent;\n          if (deltaTime < 120) {\n            var w = Math.abs((_this._wPrev + _this._wCurr) / 2);\n            var self = _assertThisInitialized(_this);\n            _this._animationId = window.requestAnimationFrame(function (t) {\n              self.updateTbState(STATE.ANIMATION_ROTATE, true);\n              var rotationAxis = self.calculateRotationAxis(self._cursorPosPrev, self._cursorPosCurr);\n              self.onRotationAnim(t, rotationAxis, Math.min(w, self.wMax));\n            });\n          } else {\n            //cursor has been standing still for over 120 ms since last movement\n            _this.updateTbState(STATE.IDLE, false);\n            _this.activateGizmos(false);\n            _this.dispatchEvent(_changeEvent);\n          }\n        } else {\n          _this.updateTbState(STATE.IDLE, false);\n          _this.activateGizmos(false);\n          _this.dispatchEvent(_changeEvent);\n        }\n      } else if (_this._state == STATE.PAN || _this._state == STATE.IDLE) {\n        _this.updateTbState(STATE.IDLE, false);\n        if (_this.enableGrid) {\n          _this.disposeGrid();\n        }\n        _this.activateGizmos(false);\n        _this.dispatchEvent(_changeEvent);\n      }\n      _this.dispatchEvent(_endEvent);\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onDoubleTap\", function (event) {\n      if (_this.enabled && _this.enablePan && _this.scene && _this.camera && _this.domElement) {\n        _this.dispatchEvent(_startEvent);\n        _this.setCenter(event.clientX, event.clientY);\n        var hitP = _this.unprojectOnObj(_this.getCursorNDC(_center.x, _center.y, _this.domElement), _this.camera);\n        if (hitP && _this.enableAnimations) {\n          var self = _assertThisInitialized(_this);\n          if (_this._animationId != -1) {\n            window.cancelAnimationFrame(_this._animationId);\n          }\n          _this._timeStart = -1;\n          _this._animationId = window.requestAnimationFrame(function (t) {\n            self.updateTbState(STATE.ANIMATION_FOCUS, true);\n            self.onFocusAnim(t, hitP, self._cameraMatrixState, self._gizmoMatrixState);\n          });\n        } else if (hitP && !_this.enableAnimations) {\n          _this.updateTbState(STATE.FOCUS, true);\n          _this.focus(hitP, _this.scaleFactor);\n          _this.updateTbState(STATE.IDLE, false);\n          _this.dispatchEvent(_changeEvent);\n        }\n      }\n      _this.dispatchEvent(_endEvent);\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onDoublePanStart\", function () {\n      if (_this.enabled && _this.enablePan && _this.camera && _this.domElement) {\n        _this.dispatchEvent(_startEvent);\n        _this.updateTbState(STATE.PAN, true);\n        _this.setCenter((_this._touchCurrent[0].clientX + _this._touchCurrent[1].clientX) / 2, (_this._touchCurrent[0].clientY + _this._touchCurrent[1].clientY) / 2);\n        var rayDir = _this.unprojectOnTbPlane(_this.camera, _center.x, _center.y, _this.domElement, true);\n        if (rayDir !== undefined) {\n          _this._startCursorPosition.copy(rayDir);\n        }\n        _this._currentCursorPosition.copy(_this._startCursorPosition);\n        _this.activateGizmos(false);\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onDoublePanMove\", function () {\n      if (_this.enabled && _this.enablePan && _this.camera && _this.domElement) {\n        _this.setCenter((_this._touchCurrent[0].clientX + _this._touchCurrent[1].clientX) / 2, (_this._touchCurrent[0].clientY + _this._touchCurrent[1].clientY) / 2);\n        if (_this._state != STATE.PAN) {\n          _this.updateTbState(STATE.PAN, true);\n          _this._startCursorPosition.copy(_this._currentCursorPosition);\n        }\n        var rayDir = _this.unprojectOnTbPlane(_this.camera, _center.x, _center.y, _this.domElement, true);\n        if (rayDir !== undefined) _this._currentCursorPosition.copy(rayDir);\n        _this.applyTransformMatrix(_this.pan(_this._startCursorPosition, _this._currentCursorPosition, true));\n        _this.dispatchEvent(_changeEvent);\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onDoublePanEnd\", function () {\n      _this.updateTbState(STATE.IDLE, false);\n      _this.dispatchEvent(_endEvent);\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onRotateStart\", function () {\n      if (_this.enabled && _this.enableRotate) {\n        var _this$camera6;\n        _this.dispatchEvent(_startEvent);\n        _this.updateTbState(STATE.ZROTATE, true); //this._startFingerRotation = event.rotation;\n\n        _this._startFingerRotation = _this.getAngle(_this._touchCurrent[1], _this._touchCurrent[0]) + _this.getAngle(_this._touchStart[1], _this._touchStart[0]);\n        _this._currentFingerRotation = _this._startFingerRotation;\n        (_this$camera6 = _this.camera) === null || _this$camera6 === void 0 ? void 0 : _this$camera6.getWorldDirection(_this._rotationAxis); //rotation axis\n\n        if (!_this.enablePan && !_this.enableZoom) {\n          _this.activateGizmos(true);\n        }\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onRotateMove\", function () {\n      if (_this.enabled && _this.enableRotate && _this.camera && _this.domElement) {\n        _this.setCenter((_this._touchCurrent[0].clientX + _this._touchCurrent[1].clientX) / 2, (_this._touchCurrent[0].clientY + _this._touchCurrent[1].clientY) / 2);\n        var rotationPoint;\n        if (_this._state != STATE.ZROTATE) {\n          _this.updateTbState(STATE.ZROTATE, true);\n          _this._startFingerRotation = _this._currentFingerRotation;\n        } //this._currentFingerRotation = event.rotation;\n\n        _this._currentFingerRotation = _this.getAngle(_this._touchCurrent[1], _this._touchCurrent[0]) + _this.getAngle(_this._touchStart[1], _this._touchStart[0]);\n        if (!_this.enablePan) {\n          rotationPoint = new Vector3().setFromMatrixPosition(_this._gizmoMatrixState);\n        } else if (_this.camera) {\n          var _this$unprojectOnTbPl3;\n          _this._v3_2.setFromMatrixPosition(_this._gizmoMatrixState);\n          rotationPoint = (_this$unprojectOnTbPl3 = _this.unprojectOnTbPlane(_this.camera, _center.x, _center.y, _this.domElement)) === null || _this$unprojectOnTbPl3 === void 0 ? void 0 : _this$unprojectOnTbPl3.applyQuaternion(_this.camera.quaternion).multiplyScalar(1 / _this.camera.zoom).add(_this._v3_2);\n        }\n        var amount = MathUtils.DEG2RAD * (_this._startFingerRotation - _this._currentFingerRotation);\n        if (rotationPoint !== undefined) {\n          _this.applyTransformMatrix(_this.zRotate(rotationPoint, amount));\n        }\n        _this.dispatchEvent(_changeEvent);\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onRotateEnd\", function () {\n      _this.updateTbState(STATE.IDLE, false);\n      _this.activateGizmos(false);\n      _this.dispatchEvent(_endEvent);\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onPinchStart\", function () {\n      if (_this.enabled && _this.enableZoom) {\n        _this.dispatchEvent(_startEvent);\n        _this.updateTbState(STATE.SCALE, true);\n        _this._startFingerDistance = _this.calculatePointersDistance(_this._touchCurrent[0], _this._touchCurrent[1]);\n        _this._currentFingerDistance = _this._startFingerDistance;\n        _this.activateGizmos(false);\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onPinchMove\", function () {\n      if (_this.enabled && _this.enableZoom && _this.domElement) {\n        _this.setCenter((_this._touchCurrent[0].clientX + _this._touchCurrent[1].clientX) / 2, (_this._touchCurrent[0].clientY + _this._touchCurrent[1].clientY) / 2);\n        var minDistance = 12; //minimum distance between fingers (in css pixels)\n\n        if (_this._state != STATE.SCALE) {\n          _this._startFingerDistance = _this._currentFingerDistance;\n          _this.updateTbState(STATE.SCALE, true);\n        }\n        _this._currentFingerDistance = Math.max(_this.calculatePointersDistance(_this._touchCurrent[0], _this._touchCurrent[1]), minDistance * _this._devPxRatio);\n        var amount = _this._currentFingerDistance / _this._startFingerDistance;\n        var scalePoint;\n        if (!_this.enablePan) {\n          scalePoint = _this._gizmos.position;\n        } else {\n          var _this$camera7, _this$camera8;\n          if (((_this$camera7 = _this.camera) === null || _this$camera7 === void 0 ? void 0 : _this$camera7.type) === 'OrthographicCamera') {\n            var _this$unprojectOnTbPl4;\n            scalePoint = (_this$unprojectOnTbPl4 = _this.unprojectOnTbPlane(_this.camera, _center.x, _center.y, _this.domElement)) === null || _this$unprojectOnTbPl4 === void 0 ? void 0 : _this$unprojectOnTbPl4.applyQuaternion(_this.camera.quaternion).multiplyScalar(1 / _this.camera.zoom).add(_this._gizmos.position);\n          } else if (((_this$camera8 = _this.camera) === null || _this$camera8 === void 0 ? void 0 : _this$camera8.type) === 'PerspectiveCamera') {\n            var _this$unprojectOnTbPl5;\n            scalePoint = (_this$unprojectOnTbPl5 = _this.unprojectOnTbPlane(_this.camera, _center.x, _center.y, _this.domElement)) === null || _this$unprojectOnTbPl5 === void 0 ? void 0 : _this$unprojectOnTbPl5.applyQuaternion(_this.camera.quaternion).add(_this._gizmos.position);\n          }\n        }\n        if (scalePoint !== undefined) {\n          _this.applyTransformMatrix(_this.applyScale(amount, scalePoint));\n        }\n        _this.dispatchEvent(_changeEvent);\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onPinchEnd\", function () {\n      _this.updateTbState(STATE.IDLE, false);\n      _this.dispatchEvent(_endEvent);\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onTriplePanStart\", function () {\n      if (_this.enabled && _this.enableZoom && _this.domElement) {\n        _this.dispatchEvent(_startEvent);\n        _this.updateTbState(STATE.SCALE, true); //const center = event.center;\n\n        var clientX = 0;\n        var clientY = 0;\n        var nFingers = _this._touchCurrent.length;\n        for (var i = 0; i < nFingers; i++) {\n          clientX += _this._touchCurrent[i].clientX;\n          clientY += _this._touchCurrent[i].clientY;\n        }\n        _this.setCenter(clientX / nFingers, clientY / nFingers);\n        _this._startCursorPosition.setY(_this.getCursorNDC(_center.x, _center.y, _this.domElement).y * 0.5);\n        _this._currentCursorPosition.copy(_this._startCursorPosition);\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onTriplePanMove\", function () {\n      if (_this.enabled && _this.enableZoom && _this.camera && _this.domElement) {\n        //\t  fov / 2\n        //\t\t|\\\n        //\t\t| \\\n        //\t\t|  \\\n        //\tx\t|\t\\\n        //\t\t| \t \\\n        //\t\t| \t  \\\n        //\t\t| _ _ _\\\n        //\t\t\ty\n        //const center = event.center;\n        var clientX = 0;\n        var clientY = 0;\n        var nFingers = _this._touchCurrent.length;\n        for (var i = 0; i < nFingers; i++) {\n          clientX += _this._touchCurrent[i].clientX;\n          clientY += _this._touchCurrent[i].clientY;\n        }\n        _this.setCenter(clientX / nFingers, clientY / nFingers);\n        var screenNotches = 8; //how many wheel notches corresponds to a full screen pan\n\n        _this._currentCursorPosition.setY(_this.getCursorNDC(_center.x, _center.y, _this.domElement).y * 0.5);\n        var movement = _this._currentCursorPosition.y - _this._startCursorPosition.y;\n        var size = 1;\n        if (movement < 0) {\n          size = 1 / Math.pow(_this.scaleFactor, -movement * screenNotches);\n        } else if (movement > 0) {\n          size = Math.pow(_this.scaleFactor, movement * screenNotches);\n        }\n        _this._v3_1.setFromMatrixPosition(_this._cameraMatrixState);\n        var x = _this._v3_1.distanceTo(_this._gizmos.position);\n        var xNew = x / size; //distance between camera and gizmos if scale(size, scalepoint) would be performed\n        //check min and max distance\n\n        xNew = MathUtils.clamp(xNew, _this.minDistance, _this.maxDistance);\n        var y = x * Math.tan(MathUtils.DEG2RAD * _this._fovState * 0.5); //calculate new fov\n\n        var newFov = MathUtils.RAD2DEG * (Math.atan(y / xNew) * 2); //check min and max fov\n\n        newFov = MathUtils.clamp(newFov, _this.minFov, _this.maxFov);\n        var newDistance = y / Math.tan(MathUtils.DEG2RAD * (newFov / 2));\n        size = x / newDistance;\n        _this._v3_2.setFromMatrixPosition(_this._gizmoMatrixState);\n        _this.setFov(newFov);\n        _this.applyTransformMatrix(_this.applyScale(size, _this._v3_2, false)); //adjusting distance\n\n        var direction = _this._gizmos.position.clone().sub(_this.camera.position).normalize().multiplyScalar(newDistance / x);\n        _this._m4_1.makeTranslation(direction.x, direction.y, direction.z);\n        _this.dispatchEvent(_changeEvent);\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onTriplePanEnd\", function () {\n      _this.updateTbState(STATE.IDLE, false);\n      _this.dispatchEvent(_endEvent); //this.dispatchEvent( _changeEvent );\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"setCenter\", function (clientX, clientY) {\n      _center.x = clientX;\n      _center.y = clientY;\n    });\n    _defineProperty(_assertThisInitialized(_this), \"initializeMouseActions\", function () {\n      _this.setMouseAction('PAN', 0, 'CTRL');\n      _this.setMouseAction('PAN', 2);\n      _this.setMouseAction('ROTATE', 0);\n      _this.setMouseAction('ZOOM', 'WHEEL');\n      _this.setMouseAction('ZOOM', 1);\n      _this.setMouseAction('FOV', 'WHEEL', 'SHIFT');\n      _this.setMouseAction('FOV', 1, 'SHIFT');\n    });\n    _defineProperty(_assertThisInitialized(_this), \"setMouseAction\", function (operation, mouse) {\n      var key = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n      var operationInput = ['PAN', 'ROTATE', 'ZOOM', 'FOV'];\n      var mouseInput = [0, 1, 2, 'WHEEL'];\n      var keyInput = ['CTRL', 'SHIFT', null];\n      var state;\n      if (!operationInput.includes(operation) || !mouseInput.includes(mouse) || !keyInput.includes(key)) {\n        //invalid parameters\n        return false;\n      }\n      if (mouse == 'WHEEL') {\n        if (operation != 'ZOOM' && operation != 'FOV') {\n          //cannot associate 2D operation to 1D input\n          return false;\n        }\n      }\n      switch (operation) {\n        case 'PAN':\n          state = STATE.PAN;\n          break;\n        case 'ROTATE':\n          state = STATE.ROTATE;\n          break;\n        case 'ZOOM':\n          state = STATE.SCALE;\n          break;\n        case 'FOV':\n          state = STATE.FOV;\n          break;\n      }\n      var action = {\n        operation: operation,\n        mouse: mouse,\n        key: key,\n        state: state\n      };\n      for (var i = 0; i < _this.mouseActions.length; i++) {\n        if (_this.mouseActions[i].mouse == action.mouse && _this.mouseActions[i].key == action.key) {\n          _this.mouseActions.splice(i, 1, action);\n          return true;\n        }\n      }\n      _this.mouseActions.push(action);\n      return true;\n    });\n    _defineProperty(_assertThisInitialized(_this), \"getOpFromAction\", function (mouse, key) {\n      var action;\n      for (var i = 0; i < _this.mouseActions.length; i++) {\n        action = _this.mouseActions[i];\n        if (action.mouse == mouse && action.key == key) {\n          return action.operation;\n        }\n      }\n      if (key) {\n        for (var _i = 0; _i < _this.mouseActions.length; _i++) {\n          action = _this.mouseActions[_i];\n          if (action.mouse == mouse && action.key == null) {\n            return action.operation;\n          }\n        }\n      }\n      return null;\n    });\n    _defineProperty(_assertThisInitialized(_this), \"getOpStateFromAction\", function (mouse, key) {\n      var action;\n      for (var i = 0; i < _this.mouseActions.length; i++) {\n        action = _this.mouseActions[i];\n        if (action.mouse == mouse && action.key == key) {\n          return action.state;\n        }\n      }\n      if (key) {\n        for (var _i2 = 0; _i2 < _this.mouseActions.length; _i2++) {\n          action = _this.mouseActions[_i2];\n          if (action.mouse == mouse && action.key == null) {\n            return action.state;\n          }\n        }\n      }\n      return null;\n    });\n    _defineProperty(_assertThisInitialized(_this), \"getAngle\", function (p1, p2) {\n      return Math.atan2(p2.clientY - p1.clientY, p2.clientX - p1.clientX) * 180 / Math.PI;\n    });\n    _defineProperty(_assertThisInitialized(_this), \"updateTouchEvent\", function (event) {\n      for (var i = 0; i < _this._touchCurrent.length; i++) {\n        if (_this._touchCurrent[i].pointerId == event.pointerId) {\n          _this._touchCurrent.splice(i, 1, event);\n          break;\n        }\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"calculateAngularSpeed\", function (p0, p1, t0, t1) {\n      var s = p1 - p0;\n      var t = (t1 - t0) / 1000;\n      if (t == 0) {\n        return 0;\n      }\n      return s / t;\n    });\n    _defineProperty(_assertThisInitialized(_this), \"calculatePointersDistance\", function (p0, p1) {\n      return Math.sqrt(Math.pow(p1.clientX - p0.clientX, 2) + Math.pow(p1.clientY - p0.clientY, 2));\n    });\n    _defineProperty(_assertThisInitialized(_this), \"calculateRotationAxis\", function (vec1, vec2) {\n      _this._rotationMatrix.extractRotation(_this._cameraMatrixState);\n      _this._quat.setFromRotationMatrix(_this._rotationMatrix);\n      _this._rotationAxis.crossVectors(vec1, vec2).applyQuaternion(_this._quat);\n      return _this._rotationAxis.normalize().clone();\n    });\n    _defineProperty(_assertThisInitialized(_this), \"calculateTbRadius\", function (camera) {\n      var factor = 0.67;\n      var distance = camera.position.distanceTo(_this._gizmos.position);\n      if (camera.type == 'PerspectiveCamera') {\n        var halfFovV = MathUtils.DEG2RAD * camera.fov * 0.5; //vertical fov/2 in radians\n\n        var halfFovH = Math.atan(camera.aspect * Math.tan(halfFovV)); //horizontal fov/2 in radians\n\n        return Math.tan(Math.min(halfFovV, halfFovH)) * distance * factor;\n      } else if (camera.type == 'OrthographicCamera') {\n        return Math.min(camera.top, camera.right) * factor;\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"focus\", function (point, size) {\n      var amount = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n      if (_this.camera) {\n        var focusPoint = point.clone(); //move center of camera (along with gizmos) towards point of interest\n\n        focusPoint.sub(_this._gizmos.position).multiplyScalar(amount);\n        _this._translationMatrix.makeTranslation(focusPoint.x, focusPoint.y, focusPoint.z);\n        var gizmoStateTemp = _this._gizmoMatrixState.clone();\n        _this._gizmoMatrixState.premultiply(_this._translationMatrix);\n        _this._gizmoMatrixState.decompose(_this._gizmos.position, _this._gizmos.quaternion, _this._gizmos.scale);\n        var cameraStateTemp = _this._cameraMatrixState.clone();\n        _this._cameraMatrixState.premultiply(_this._translationMatrix);\n        _this._cameraMatrixState.decompose(_this.camera.position, _this.camera.quaternion, _this.camera.scale); //apply zoom\n\n        if (_this.enableZoom) {\n          _this.applyTransformMatrix(_this.applyScale(size, _this._gizmos.position));\n        }\n        _this._gizmoMatrixState.copy(gizmoStateTemp);\n        _this._cameraMatrixState.copy(cameraStateTemp);\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"drawGrid\", function () {\n      if (_this.scene) {\n        var _this$camera9, _this$camera10;\n        var color = 0x888888;\n        var multiplier = 3;\n        var size, divisions, maxLength, tick;\n        if (((_this$camera9 = _this.camera) === null || _this$camera9 === void 0 ? void 0 : _this$camera9.type) === 'OrthographicCamera') {\n          var width = _this.camera.right - _this.camera.left;\n          var height = _this.camera.bottom - _this.camera.top;\n          maxLength = Math.max(width, height);\n          tick = maxLength / 20;\n          size = maxLength / _this.camera.zoom * multiplier;\n          divisions = size / tick * _this.camera.zoom;\n        } else if (((_this$camera10 = _this.camera) === null || _this$camera10 === void 0 ? void 0 : _this$camera10.type) === 'PerspectiveCamera') {\n          var distance = _this.camera.position.distanceTo(_this._gizmos.position);\n          var halfFovV = MathUtils.DEG2RAD * _this.camera.fov * 0.5;\n          var halfFovH = Math.atan(_this.camera.aspect * Math.tan(halfFovV));\n          maxLength = Math.tan(Math.max(halfFovV, halfFovH)) * distance * 2;\n          tick = maxLength / 20;\n          size = maxLength * multiplier;\n          divisions = size / tick;\n        }\n        if (_this._grid == null && _this.camera) {\n          _this._grid = new GridHelper(size, divisions, color, color);\n          _this._grid.position.copy(_this._gizmos.position);\n          _this._gridPosition.copy(_this._grid.position);\n          _this._grid.quaternion.copy(_this.camera.quaternion);\n          _this._grid.rotateX(Math.PI * 0.5);\n          _this.scene.add(_this._grid);\n        }\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"connect\", function (domElement) {\n      // https://github.com/mrdoob/three.js/issues/20575\n      if (domElement === document) {\n        console.error('THREE.ArcballControls: \"document\" should not be used as the target \"domElement\". Please use \"renderer.domElement\" instead.');\n      }\n      _this.domElement = domElement; // disables touch scroll\n      // touch-action needs to be defined for pointer events to work on mobile\n      // https://stackoverflow.com/a/48254578\n\n      _this.domElement.style.touchAction = 'none';\n      _this.domElement.addEventListener('contextmenu', _this.onContextMenu);\n      _this.domElement.addEventListener('pointerdown', _this.onPointerDown);\n      _this.domElement.addEventListener('pointercancel', _this.onPointerCancel);\n      _this.domElement.addEventListener('wheel', _this.onWheel);\n    });\n    _defineProperty(_assertThisInitialized(_this), \"dispose\", function () {\n      var _this$domElement, _this$domElement2, _this$domElement3, _this$domElement4, _this$scene;\n      if (_this._animationId != -1) {\n        window.cancelAnimationFrame(_this._animationId);\n      }\n      (_this$domElement = _this.domElement) === null || _this$domElement === void 0 ? void 0 : _this$domElement.removeEventListener('pointerdown', _this.onPointerDown);\n      (_this$domElement2 = _this.domElement) === null || _this$domElement2 === void 0 ? void 0 : _this$domElement2.removeEventListener('pointercancel', _this.onPointerCancel);\n      (_this$domElement3 = _this.domElement) === null || _this$domElement3 === void 0 ? void 0 : _this$domElement3.removeEventListener('wheel', _this.onWheel);\n      (_this$domElement4 = _this.domElement) === null || _this$domElement4 === void 0 ? void 0 : _this$domElement4.removeEventListener('contextmenu', _this.onContextMenu);\n      window.removeEventListener('pointermove', _this.onPointerMove);\n      window.removeEventListener('pointerup', _this.onPointerUp);\n      window.removeEventListener('resize', _this.onWindowResize);\n      (_this$scene = _this.scene) === null || _this$scene === void 0 ? void 0 : _this$scene.remove(_this._gizmos);\n      _this.disposeGrid();\n    });\n    _defineProperty(_assertThisInitialized(_this), \"disposeGrid\", function () {\n      if (_this._grid && _this.scene) {\n        _this.scene.remove(_this._grid);\n        _this._grid = null;\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"easeOutCubic\", function (t) {\n      return 1 - Math.pow(1 - t, 3);\n    });\n    _defineProperty(_assertThisInitialized(_this), \"activateGizmos\", function (isActive) {\n      var _iterator = _createForOfIteratorHelper(_this._gizmos.children),\n        _step;\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var gizmo = _step.value;\n          gizmo.material.setValues({\n            opacity: isActive ? 1 : 0.6\n          });\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"getCursorNDC\", function (cursorX, cursorY, canvas) {\n      var canvasRect = canvas.getBoundingClientRect();\n      _this._v2_1.setX((cursorX - canvasRect.left) / canvasRect.width * 2 - 1);\n      _this._v2_1.setY((canvasRect.bottom - cursorY) / canvasRect.height * 2 - 1);\n      return _this._v2_1.clone();\n    });\n    _defineProperty(_assertThisInitialized(_this), \"getCursorPosition\", function (cursorX, cursorY, canvas) {\n      var _this$camera11;\n      _this._v2_1.copy(_this.getCursorNDC(cursorX, cursorY, canvas));\n      if (((_this$camera11 = _this.camera) === null || _this$camera11 === void 0 ? void 0 : _this$camera11.type) === 'OrthographicCamera') {\n        _this._v2_1.x *= (_this.camera.right - _this.camera.left) * 0.5;\n        _this._v2_1.y *= (_this.camera.top - _this.camera.bottom) * 0.5;\n      }\n      return _this._v2_1.clone();\n    });\n    _defineProperty(_assertThisInitialized(_this), \"setCamera\", function (camera) {\n      if (camera) {\n        camera.lookAt(_this.target);\n        camera.updateMatrix(); //setting state\n\n        if ((camera === null || camera === void 0 ? void 0 : camera.type) == 'PerspectiveCamera') {\n          _this._fov0 = camera.fov;\n          _this._fovState = camera.fov;\n        }\n        _this._cameraMatrixState0.copy(camera.matrix);\n        _this._cameraMatrixState.copy(_this._cameraMatrixState0);\n        _this._cameraProjectionState.copy(camera.projectionMatrix);\n        _this._zoom0 = camera.zoom;\n        _this._zoomState = _this._zoom0;\n        _this._initialNear = camera.near;\n        _this._nearPos0 = camera.position.distanceTo(_this.target) - camera.near;\n        _this._nearPos = _this._initialNear;\n        _this._initialFar = camera.far;\n        _this._farPos0 = camera.position.distanceTo(_this.target) - camera.far;\n        _this._farPos = _this._initialFar;\n        _this._up0.copy(camera.up);\n        _this._upState.copy(camera.up);\n        _this.camera = camera;\n        _this.camera.updateProjectionMatrix(); //making gizmos\n\n        var tbRadius = _this.calculateTbRadius(camera);\n        if (tbRadius !== undefined) {\n          _this._tbRadius = tbRadius;\n        }\n        _this.makeGizmos(_this.target, _this._tbRadius);\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"makeGizmos\", function (tbCenter, tbRadius) {\n      // @ts-expect-error\n      var curve = new EllipseCurve(0, 0, tbRadius, tbRadius);\n      var points = curve.getPoints(_this._curvePts); //geometry\n\n      var curveGeometry = new BufferGeometry().setFromPoints(points); //material\n\n      var curveMaterialX = new LineBasicMaterial({\n        color: 0xff8080,\n        fog: false,\n        transparent: true,\n        opacity: 0.6\n      });\n      var curveMaterialY = new LineBasicMaterial({\n        color: 0x80ff80,\n        fog: false,\n        transparent: true,\n        opacity: 0.6\n      });\n      var curveMaterialZ = new LineBasicMaterial({\n        color: 0x8080ff,\n        fog: false,\n        transparent: true,\n        opacity: 0.6\n      }); //line\n\n      var gizmoX = new Line(curveGeometry, curveMaterialX);\n      var gizmoY = new Line(curveGeometry, curveMaterialY);\n      var gizmoZ = new Line(curveGeometry, curveMaterialZ);\n      var rotation = Math.PI * 0.5;\n      gizmoX.rotation.x = rotation;\n      gizmoY.rotation.y = rotation; //setting state\n\n      _this._gizmoMatrixState0.identity().setPosition(tbCenter);\n      _this._gizmoMatrixState.copy(_this._gizmoMatrixState0);\n      if (_this.camera && _this.camera.zoom != 1) {\n        //adapt gizmos size to camera zoom\n        var size = 1 / _this.camera.zoom;\n        _this._scaleMatrix.makeScale(size, size, size);\n        _this._translationMatrix.makeTranslation(-tbCenter.x, -tbCenter.y, -tbCenter.z);\n        _this._gizmoMatrixState.premultiply(_this._translationMatrix).premultiply(_this._scaleMatrix);\n        _this._translationMatrix.makeTranslation(tbCenter.x, tbCenter.y, tbCenter.z);\n        _this._gizmoMatrixState.premultiply(_this._translationMatrix);\n      }\n      _this._gizmoMatrixState.decompose(_this._gizmos.position, _this._gizmos.quaternion, _this._gizmos.scale);\n      _this._gizmos.clear();\n      _this._gizmos.add(gizmoX);\n      _this._gizmos.add(gizmoY);\n      _this._gizmos.add(gizmoZ);\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onFocusAnim\", function (time, point, cameraMatrix, gizmoMatrix) {\n      if (_this._timeStart == -1) {\n        //animation start\n        _this._timeStart = time;\n      }\n      if (_this._state == STATE.ANIMATION_FOCUS) {\n        var deltaTime = time - _this._timeStart;\n        var animTime = deltaTime / _this.focusAnimationTime;\n        _this._gizmoMatrixState.copy(gizmoMatrix);\n        if (animTime >= 1) {\n          //animation end\n          _this._gizmoMatrixState.decompose(_this._gizmos.position, _this._gizmos.quaternion, _this._gizmos.scale);\n          _this.focus(point, _this.scaleFactor);\n          _this._timeStart = -1;\n          _this.updateTbState(STATE.IDLE, false);\n          _this.activateGizmos(false);\n          _this.dispatchEvent(_changeEvent);\n        } else {\n          var amount = _this.easeOutCubic(animTime);\n          var size = 1 - amount + _this.scaleFactor * amount;\n          _this._gizmoMatrixState.decompose(_this._gizmos.position, _this._gizmos.quaternion, _this._gizmos.scale);\n          _this.focus(point, size, amount);\n          _this.dispatchEvent(_changeEvent);\n          var self = _assertThisInitialized(_this);\n          _this._animationId = window.requestAnimationFrame(function (t) {\n            self.onFocusAnim(t, point, cameraMatrix, gizmoMatrix.clone());\n          });\n        }\n      } else {\n        //interrupt animation\n        _this._animationId = -1;\n        _this._timeStart = -1;\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onRotationAnim\", function (time, rotationAxis, w0) {\n      if (_this._timeStart == -1) {\n        //animation start\n        _this._anglePrev = 0;\n        _this._angleCurrent = 0;\n        _this._timeStart = time;\n      }\n      if (_this._state == STATE.ANIMATION_ROTATE) {\n        //w = w0 + alpha * t\n        var deltaTime = (time - _this._timeStart) / 1000;\n        var w = w0 + -_this.dampingFactor * deltaTime;\n        if (w > 0) {\n          //tetha = 0.5 * alpha * t^2 + w0 * t + tetha0\n          _this._angleCurrent = 0.5 * -_this.dampingFactor * Math.pow(deltaTime, 2) + w0 * deltaTime + 0;\n          _this.applyTransformMatrix(_this.rotate(rotationAxis, _this._angleCurrent));\n          _this.dispatchEvent(_changeEvent);\n          var self = _assertThisInitialized(_this);\n          _this._animationId = window.requestAnimationFrame(function (t) {\n            self.onRotationAnim(t, rotationAxis, w0);\n          });\n        } else {\n          _this._animationId = -1;\n          _this._timeStart = -1;\n          _this.updateTbState(STATE.IDLE, false);\n          _this.activateGizmos(false);\n          _this.dispatchEvent(_changeEvent);\n        }\n      } else {\n        //interrupt animation\n        _this._animationId = -1;\n        _this._timeStart = -1;\n        if (_this._state != STATE.ROTATE) {\n          _this.activateGizmos(false);\n          _this.dispatchEvent(_changeEvent);\n        }\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"pan\", function (p0, p1) {\n      var adjust = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n      if (_this.camera) {\n        var movement = p0.clone().sub(p1);\n        if (_this.camera.type === 'OrthographicCamera') {\n          //adjust movement amount\n          movement.multiplyScalar(1 / _this.camera.zoom);\n        }\n        if (_this.camera.type === 'PerspectiveCamera' && adjust) {\n          //adjust movement amount\n          _this._v3_1.setFromMatrixPosition(_this._cameraMatrixState0); //camera's initial position\n\n          _this._v3_2.setFromMatrixPosition(_this._gizmoMatrixState0); //gizmo's initial position\n\n          var distanceFactor = _this._v3_1.distanceTo(_this._v3_2) / _this.camera.position.distanceTo(_this._gizmos.position);\n          movement.multiplyScalar(1 / distanceFactor);\n        }\n        _this._v3_1.set(movement.x, movement.y, 0).applyQuaternion(_this.camera.quaternion);\n        _this._m4_1.makeTranslation(_this._v3_1.x, _this._v3_1.y, _this._v3_1.z);\n        _this.setTransformationMatrices(_this._m4_1, _this._m4_1);\n      }\n      return _transformation;\n    });\n    _defineProperty(_assertThisInitialized(_this), \"reset\", function () {\n      if (_this.camera) {\n        _this.camera.zoom = _this._zoom0;\n        if (_this.camera.type === 'PerspectiveCamera') {\n          _this.camera.fov = _this._fov0;\n        }\n        _this.camera.near = _this._nearPos;\n        _this.camera.far = _this._farPos;\n        _this._cameraMatrixState.copy(_this._cameraMatrixState0);\n        _this._cameraMatrixState.decompose(_this.camera.position, _this.camera.quaternion, _this.camera.scale);\n        _this.camera.up.copy(_this._up0);\n        _this.camera.updateMatrix();\n        _this.camera.updateProjectionMatrix();\n        _this._gizmoMatrixState.copy(_this._gizmoMatrixState0);\n        _this._gizmoMatrixState0.decompose(_this._gizmos.position, _this._gizmos.quaternion, _this._gizmos.scale);\n        _this._gizmos.updateMatrix();\n        var tbRadius = _this.calculateTbRadius(_this.camera);\n        if (tbRadius !== undefined) {\n          _this._tbRadius = tbRadius;\n        }\n        _this.makeGizmos(_this._gizmos.position, _this._tbRadius);\n        _this.camera.lookAt(_this._gizmos.position);\n        _this.updateTbState(STATE.IDLE, false);\n        _this.dispatchEvent(_changeEvent);\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"rotate\", function (axis, angle) {\n      var point = _this._gizmos.position; //rotation center\n\n      _this._translationMatrix.makeTranslation(-point.x, -point.y, -point.z);\n      _this._rotationMatrix.makeRotationAxis(axis, -angle); //rotate camera\n\n      _this._m4_1.makeTranslation(point.x, point.y, point.z);\n      _this._m4_1.multiply(_this._rotationMatrix);\n      _this._m4_1.multiply(_this._translationMatrix);\n      _this.setTransformationMatrices(_this._m4_1);\n      return _transformation;\n    });\n    _defineProperty(_assertThisInitialized(_this), \"copyState\", function () {\n      if (_this.camera) {\n        var _this$camera12;\n        var state = JSON.stringify(((_this$camera12 = _this.camera) === null || _this$camera12 === void 0 ? void 0 : _this$camera12.type) === 'OrthographicCamera' ? {\n          arcballState: {\n            cameraFar: _this.camera.far,\n            cameraMatrix: _this.camera.matrix,\n            cameraNear: _this.camera.near,\n            cameraUp: _this.camera.up,\n            cameraZoom: _this.camera.zoom,\n            gizmoMatrix: _this._gizmos.matrix\n          }\n        } : {\n          arcballState: {\n            cameraFar: _this.camera.far,\n            cameraFov: _this.camera.fov,\n            cameraMatrix: _this.camera.matrix,\n            cameraNear: _this.camera.near,\n            cameraUp: _this.camera.up,\n            cameraZoom: _this.camera.zoom,\n            gizmoMatrix: _this._gizmos.matrix\n          }\n        });\n        navigator.clipboard.writeText(state);\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"pasteState\", function () {\n      var self = _assertThisInitialized(_this);\n      navigator.clipboard.readText().then(function resolved(value) {\n        self.setStateFromJSON(value);\n      });\n    });\n    _defineProperty(_assertThisInitialized(_this), \"saveState\", function () {\n      if (!_this.camera) return;\n      _this._cameraMatrixState0.copy(_this.camera.matrix);\n      _this._gizmoMatrixState0.copy(_this._gizmos.matrix);\n      _this._nearPos = _this.camera.near;\n      _this._farPos = _this.camera.far;\n      _this._zoom0 = _this.camera.zoom;\n      _this._up0.copy(_this.camera.up);\n      if (_this.camera.type === 'PerspectiveCamera') {\n        _this._fov0 = _this.camera.fov;\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"applyScale\", function (size, point) {\n      var scaleGizmos = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n      if (!_this.camera) return;\n      var scalePoint = point.clone();\n      var sizeInverse = 1 / size;\n      if (_this.camera.type === 'OrthographicCamera') {\n        //camera zoom\n        _this.camera.zoom = _this._zoomState;\n        _this.camera.zoom *= size; //check min and max zoom\n\n        if (_this.camera.zoom > _this.maxZoom) {\n          _this.camera.zoom = _this.maxZoom;\n          sizeInverse = _this._zoomState / _this.maxZoom;\n        } else if (_this.camera.zoom < _this.minZoom) {\n          _this.camera.zoom = _this.minZoom;\n          sizeInverse = _this._zoomState / _this.minZoom;\n        }\n        _this.camera.updateProjectionMatrix();\n        _this._v3_1.setFromMatrixPosition(_this._gizmoMatrixState); //gizmos position\n        //scale gizmos so they appear in the same spot having the same dimension\n\n        _this._scaleMatrix.makeScale(sizeInverse, sizeInverse, sizeInverse);\n        _this._translationMatrix.makeTranslation(-_this._v3_1.x, -_this._v3_1.y, -_this._v3_1.z);\n        _this._m4_2.makeTranslation(_this._v3_1.x, _this._v3_1.y, _this._v3_1.z).multiply(_this._scaleMatrix);\n        _this._m4_2.multiply(_this._translationMatrix); //move camera and gizmos to obtain pinch effect\n\n        scalePoint.sub(_this._v3_1);\n        var amount = scalePoint.clone().multiplyScalar(sizeInverse);\n        scalePoint.sub(amount);\n        _this._m4_1.makeTranslation(scalePoint.x, scalePoint.y, scalePoint.z);\n        _this._m4_2.premultiply(_this._m4_1);\n        _this.setTransformationMatrices(_this._m4_1, _this._m4_2);\n        return _transformation;\n      }\n      if (_this.camera.type === 'PerspectiveCamera') {\n        _this._v3_1.setFromMatrixPosition(_this._cameraMatrixState);\n        _this._v3_2.setFromMatrixPosition(_this._gizmoMatrixState); //move camera\n\n        var distance = _this._v3_1.distanceTo(scalePoint);\n        var _amount = distance - distance * sizeInverse; //check min and max distance\n\n        var newDistance = distance - _amount;\n        if (newDistance < _this.minDistance) {\n          sizeInverse = _this.minDistance / distance;\n          _amount = distance - distance * sizeInverse;\n        } else if (newDistance > _this.maxDistance) {\n          sizeInverse = _this.maxDistance / distance;\n          _amount = distance - distance * sizeInverse;\n        }\n        var direction = scalePoint.clone().sub(_this._v3_1).normalize().multiplyScalar(_amount);\n        _this._m4_1.makeTranslation(direction.x, direction.y, direction.z);\n        if (scaleGizmos) {\n          //scale gizmos so they appear in the same spot having the same dimension\n          var pos = _this._v3_2;\n          distance = pos.distanceTo(scalePoint);\n          _amount = distance - distance * sizeInverse;\n          direction = scalePoint.clone().sub(_this._v3_2).normalize().multiplyScalar(_amount);\n          _this._translationMatrix.makeTranslation(pos.x, pos.y, pos.z);\n          _this._scaleMatrix.makeScale(sizeInverse, sizeInverse, sizeInverse);\n          _this._m4_2.makeTranslation(direction.x, direction.y, direction.z).multiply(_this._translationMatrix);\n          _this._m4_2.multiply(_this._scaleMatrix);\n          _this._translationMatrix.makeTranslation(-pos.x, -pos.y, -pos.z);\n          _this._m4_2.multiply(_this._translationMatrix);\n          _this.setTransformationMatrices(_this._m4_1, _this._m4_2);\n        } else {\n          _this.setTransformationMatrices(_this._m4_1);\n        }\n        return _transformation;\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"setFov\", function (value) {\n      var _this$camera13;\n      if (((_this$camera13 = _this.camera) === null || _this$camera13 === void 0 ? void 0 : _this$camera13.type) === 'PerspectiveCamera') {\n        _this.camera.fov = MathUtils.clamp(value, _this.minFov, _this.maxFov);\n        _this.camera.updateProjectionMatrix();\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"setTarget\", function (x, y, z) {\n      if (_this.camera) {\n        _this.target.set(x, y, z);\n        _this._gizmos.position.set(x, y, z); //for correct radius calculation\n\n        var tbRadius = _this.calculateTbRadius(_this.camera);\n        if (tbRadius !== undefined) {\n          _this._tbRadius = tbRadius;\n        }\n        _this.makeGizmos(_this.target, _this._tbRadius);\n        _this.camera.lookAt(_this.target);\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"zRotate\", function (point, angle) {\n      _this._rotationMatrix.makeRotationAxis(_this._rotationAxis, angle);\n      _this._translationMatrix.makeTranslation(-point.x, -point.y, -point.z);\n      _this._m4_1.makeTranslation(point.x, point.y, point.z);\n      _this._m4_1.multiply(_this._rotationMatrix);\n      _this._m4_1.multiply(_this._translationMatrix);\n      _this._v3_1.setFromMatrixPosition(_this._gizmoMatrixState).sub(point); //vector from rotation center to gizmos position\n\n      _this._v3_2.copy(_this._v3_1).applyAxisAngle(_this._rotationAxis, angle); //apply rotation\n\n      _this._v3_2.sub(_this._v3_1);\n      _this._m4_2.makeTranslation(_this._v3_2.x, _this._v3_2.y, _this._v3_2.z);\n      _this.setTransformationMatrices(_this._m4_1, _this._m4_2);\n      return _transformation;\n    });\n    _defineProperty(_assertThisInitialized(_this), \"unprojectOnObj\", function (cursor, camera) {\n      if (!_this.scene) return null;\n      var raycaster = new Raycaster();\n      raycaster.near = camera.near;\n      raycaster.far = camera.far;\n      raycaster.setFromCamera(cursor, camera);\n      var intersect = raycaster.intersectObjects(_this.scene.children, true);\n      for (var i = 0; i < intersect.length; i++) {\n        if (intersect[i].object.uuid != _this._gizmos.uuid && intersect[i].face) {\n          return intersect[i].point.clone();\n        }\n      }\n      return null;\n    });\n    _defineProperty(_assertThisInitialized(_this), \"unprojectOnTbSurface\", function (camera, cursorX, cursorY, canvas, tbRadius) {\n      if (camera.type == 'OrthographicCamera') {\n        _this._v2_1.copy(_this.getCursorPosition(cursorX, cursorY, canvas));\n        _this._v3_1.set(_this._v2_1.x, _this._v2_1.y, 0);\n        var x2 = Math.pow(_this._v2_1.x, 2);\n        var y2 = Math.pow(_this._v2_1.y, 2);\n        var r2 = Math.pow(_this._tbRadius, 2);\n        if (x2 + y2 <= r2 * 0.5) {\n          //intersection with sphere\n          _this._v3_1.setZ(Math.sqrt(r2 - (x2 + y2)));\n        } else {\n          //intersection with hyperboloid\n          _this._v3_1.setZ(r2 * 0.5 / Math.sqrt(x2 + y2));\n        }\n        return _this._v3_1;\n      }\n      if (camera.type == 'PerspectiveCamera') {\n        //unproject cursor on the near plane\n        _this._v2_1.copy(_this.getCursorNDC(cursorX, cursorY, canvas));\n        _this._v3_1.set(_this._v2_1.x, _this._v2_1.y, -1);\n        _this._v3_1.applyMatrix4(camera.projectionMatrixInverse);\n        var rayDir = _this._v3_1.clone().normalize(); //unprojected ray direction\n\n        var cameraGizmoDistance = camera.position.distanceTo(_this._gizmos.position);\n        var radius2 = Math.pow(tbRadius, 2); //\t  camera\n        //\t\t|\\\n        //\t\t| \\\n        //\t\t|  \\\n        //\th\t|\t\\\n        //\t\t| \t \\\n        //\t\t| \t  \\\n        //\t_ _ | _ _ _\\ _ _  near plane\n        //\t\t\tl\n\n        var h = _this._v3_1.z;\n        var l = Math.sqrt(Math.pow(_this._v3_1.x, 2) + Math.pow(_this._v3_1.y, 2));\n        if (l == 0) {\n          //ray aligned with camera\n          rayDir.set(_this._v3_1.x, _this._v3_1.y, tbRadius);\n          return rayDir;\n        }\n        var m = h / l;\n        var q = cameraGizmoDistance;\n        /*\n         * calculate intersection point between unprojected ray and trackball surface\n         *|y = m * x + q\n         *|x^2 + y^2 = r^2\n         *\n         * (m^2 + 1) * x^2 + (2 * m * q) * x + q^2 - r^2 = 0\n         */\n\n        var a = Math.pow(m, 2) + 1;\n        var b = 2 * m * q;\n        var c = Math.pow(q, 2) - radius2;\n        var delta = Math.pow(b, 2) - 4 * a * c;\n        if (delta >= 0) {\n          //intersection with sphere\n          _this._v2_1.setX((-b - Math.sqrt(delta)) / (2 * a));\n          _this._v2_1.setY(m * _this._v2_1.x + q);\n          var angle = MathUtils.RAD2DEG * _this._v2_1.angle();\n          if (angle >= 45) {\n            //if angle between intersection point and X' axis is >= 45°, return that point\n            //otherwise, calculate intersection point with hyperboloid\n            var _rayLength = Math.sqrt(Math.pow(_this._v2_1.x, 2) + Math.pow(cameraGizmoDistance - _this._v2_1.y, 2));\n            rayDir.multiplyScalar(_rayLength);\n            rayDir.z += cameraGizmoDistance;\n            return rayDir;\n          }\n        } //intersection with hyperboloid\n\n        /*\n         *|y = m * x + q\n         *|y = (1 / x) * (r^2 / 2)\n         *\n         * m * x^2 + q * x - r^2 / 2 = 0\n         */\n\n        a = m;\n        b = q;\n        c = -radius2 * 0.5;\n        delta = Math.pow(b, 2) - 4 * a * c;\n        _this._v2_1.setX((-b - Math.sqrt(delta)) / (2 * a));\n        _this._v2_1.setY(m * _this._v2_1.x + q);\n        var rayLength = Math.sqrt(Math.pow(_this._v2_1.x, 2) + Math.pow(cameraGizmoDistance - _this._v2_1.y, 2));\n        rayDir.multiplyScalar(rayLength);\n        rayDir.z += cameraGizmoDistance;\n        return rayDir;\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"unprojectOnTbPlane\", function (camera, cursorX, cursorY, canvas) {\n      var initialDistance = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n      if (camera.type == 'OrthographicCamera') {\n        _this._v2_1.copy(_this.getCursorPosition(cursorX, cursorY, canvas));\n        _this._v3_1.set(_this._v2_1.x, _this._v2_1.y, 0);\n        return _this._v3_1.clone();\n      }\n      if (camera.type == 'PerspectiveCamera') {\n        _this._v2_1.copy(_this.getCursorNDC(cursorX, cursorY, canvas)); //unproject cursor on the near plane\n\n        _this._v3_1.set(_this._v2_1.x, _this._v2_1.y, -1);\n        _this._v3_1.applyMatrix4(camera.projectionMatrixInverse);\n        var rayDir = _this._v3_1.clone().normalize(); //unprojected ray direction\n        //\t  camera\n        //\t\t|\\\n        //\t\t| \\\n        //\t\t|  \\\n        //\th\t|\t\\\n        //\t\t| \t \\\n        //\t\t| \t  \\\n        //\t_ _ | _ _ _\\ _ _  near plane\n        //\t\t\tl\n\n        var h = _this._v3_1.z;\n        var l = Math.sqrt(Math.pow(_this._v3_1.x, 2) + Math.pow(_this._v3_1.y, 2));\n        var cameraGizmoDistance;\n        if (initialDistance) {\n          cameraGizmoDistance = _this._v3_1.setFromMatrixPosition(_this._cameraMatrixState0).distanceTo(_this._v3_2.setFromMatrixPosition(_this._gizmoMatrixState0));\n        } else {\n          cameraGizmoDistance = camera.position.distanceTo(_this._gizmos.position);\n        }\n        /*\n         * calculate intersection point between unprojected ray and the plane\n         *|y = mx + q\n         *|y = 0\n         *\n         * x = -q/m\n         */\n\n        if (l == 0) {\n          //ray aligned with camera\n          rayDir.set(0, 0, 0);\n          return rayDir;\n        }\n        var m = h / l;\n        var q = cameraGizmoDistance;\n        var x = -q / m;\n        var rayLength = Math.sqrt(Math.pow(q, 2) + Math.pow(x, 2));\n        rayDir.multiplyScalar(rayLength);\n        rayDir.z = 0;\n        return rayDir;\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"updateMatrixState\", function () {\n      if (!_this.camera) return; //update camera and gizmos state\n\n      _this._cameraMatrixState.copy(_this.camera.matrix);\n      _this._gizmoMatrixState.copy(_this._gizmos.matrix);\n      if (_this.camera.type === 'OrthographicCamera') {\n        _this._cameraProjectionState.copy(_this.camera.projectionMatrix);\n        _this.camera.updateProjectionMatrix();\n        _this._zoomState = _this.camera.zoom;\n      }\n      if (_this.camera.type === 'PerspectiveCamera') {\n        _this._fovState = _this.camera.fov;\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"updateTbState\", function (newState, updateMatrices) {\n      _this._state = newState;\n      if (updateMatrices) {\n        _this.updateMatrixState();\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"update\", function () {\n      var EPS = 0.000001; // Update target and gizmos state\n\n      if (!_this.target.equals(_this._currentTarget) && _this.camera) {\n        _this._gizmos.position.set(_this.target.x, _this.target.y, _this.target.z); //for correct radius calculation\n\n        var tbRadius = _this.calculateTbRadius(_this.camera);\n        if (tbRadius !== undefined) {\n          _this._tbRadius = tbRadius;\n        }\n        _this.makeGizmos(_this.target, _this._tbRadius);\n        _this._currentTarget.copy(_this.target);\n      }\n      if (!_this.camera) return; //check min/max parameters\n\n      if (_this.camera.type === 'OrthographicCamera') {\n        //check zoom\n        if (_this.camera.zoom > _this.maxZoom || _this.camera.zoom < _this.minZoom) {\n          var newZoom = MathUtils.clamp(_this.camera.zoom, _this.minZoom, _this.maxZoom);\n          _this.applyTransformMatrix(_this.applyScale(newZoom / _this.camera.zoom, _this._gizmos.position, true));\n        }\n      }\n      if (_this.camera.type === 'PerspectiveCamera') {\n        //check distance\n        var distance = _this.camera.position.distanceTo(_this._gizmos.position);\n        if (distance > _this.maxDistance + EPS || distance < _this.minDistance - EPS) {\n          var newDistance = MathUtils.clamp(distance, _this.minDistance, _this.maxDistance);\n          _this.applyTransformMatrix(_this.applyScale(newDistance / distance, _this._gizmos.position));\n          _this.updateMatrixState();\n        } //check fov\n\n        if (_this.camera.fov < _this.minFov || _this.camera.fov > _this.maxFov) {\n          _this.camera.fov = MathUtils.clamp(_this.camera.fov, _this.minFov, _this.maxFov);\n          _this.camera.updateProjectionMatrix();\n        }\n        var oldRadius = _this._tbRadius;\n        var _tbRadius = _this.calculateTbRadius(_this.camera);\n        if (_tbRadius !== undefined) {\n          _this._tbRadius = _tbRadius;\n        }\n        if (oldRadius < _this._tbRadius - EPS || oldRadius > _this._tbRadius + EPS) {\n          var scale = (_this._gizmos.scale.x + _this._gizmos.scale.y + _this._gizmos.scale.z) / 3;\n          var newRadius = _this._tbRadius / scale; // @ts-expect-error\n\n          var curve = new EllipseCurve(0, 0, newRadius, newRadius);\n          var points = curve.getPoints(_this._curvePts);\n          var curveGeometry = new BufferGeometry().setFromPoints(points);\n          for (var gizmo in _this._gizmos.children) {\n            var child = _this._gizmos.children[gizmo];\n            child.geometry = curveGeometry;\n          }\n        }\n      }\n      _this.camera.lookAt(_this._gizmos.position);\n    });\n    _defineProperty(_assertThisInitialized(_this), \"setStateFromJSON\", function (json) {\n      var state = JSON.parse(json);\n      if (state.arcballState && _this.camera) {\n        _this._cameraMatrixState.fromArray(state.arcballState.cameraMatrix.elements);\n        _this._cameraMatrixState.decompose(_this.camera.position, _this.camera.quaternion, _this.camera.scale);\n        _this.camera.up.copy(state.arcballState.cameraUp);\n        _this.camera.near = state.arcballState.cameraNear;\n        _this.camera.far = state.arcballState.cameraFar;\n        _this.camera.zoom = state.arcballState.cameraZoom;\n        if (_this.camera.type === 'PerspectiveCamera') {\n          _this.camera.fov = state.arcballState.cameraFov;\n        }\n        _this._gizmoMatrixState.fromArray(state.arcballState.gizmoMatrix.elements);\n        _this._gizmoMatrixState.decompose(_this._gizmos.position, _this._gizmos.quaternion, _this._gizmos.scale);\n        _this.camera.updateMatrix();\n        _this.camera.updateProjectionMatrix();\n        _this._gizmos.updateMatrix();\n        var tbRadius = _this.calculateTbRadius(_this.camera);\n        if (tbRadius !== undefined) {\n          _this._tbRadius = tbRadius;\n        }\n        var gizmoTmp = new Matrix4().copy(_this._gizmoMatrixState0);\n        _this.makeGizmos(_this._gizmos.position, _this._tbRadius);\n        _this._gizmoMatrixState0.copy(gizmoTmp);\n        _this.camera.lookAt(_this._gizmos.position);\n        _this.updateTbState(STATE.IDLE, false);\n        _this.dispatchEvent(_changeEvent);\n      }\n    });\n    _this.camera = null;\n    _this.domElement = _domElement;\n    _this.scene = scene;\n    _this.mouseActions = [];\n    _this._mouseOp = null; //global vectors and matrices that are used in some operations to avoid creating new objects every time (e.g. every time cursor moves)\n\n    _this._v2_1 = new Vector2();\n    _this._v3_1 = new Vector3();\n    _this._v3_2 = new Vector3();\n    _this._m4_1 = new Matrix4();\n    _this._m4_2 = new Matrix4();\n    _this._quat = new Quaternion(); //transformation matrices\n\n    _this._translationMatrix = new Matrix4(); //matrix for translation operation\n\n    _this._rotationMatrix = new Matrix4(); //matrix for rotation operation\n\n    _this._scaleMatrix = new Matrix4(); //matrix for scaling operation\n\n    _this._rotationAxis = new Vector3(); //axis for rotate operation\n    //camera state\n\n    _this._cameraMatrixState = new Matrix4();\n    _this._cameraProjectionState = new Matrix4();\n    _this._fovState = 1;\n    _this._upState = new Vector3();\n    _this._zoomState = 1;\n    _this._nearPos = 0;\n    _this._farPos = 0;\n    _this._gizmoMatrixState = new Matrix4(); //initial values\n\n    _this._up0 = new Vector3();\n    _this._zoom0 = 1;\n    _this._fov0 = 0;\n    _this._initialNear = 0;\n    _this._nearPos0 = 0;\n    _this._initialFar = 0;\n    _this._farPos0 = 0;\n    _this._cameraMatrixState0 = new Matrix4();\n    _this._gizmoMatrixState0 = new Matrix4(); //pointers array\n\n    _this._button = -1;\n    _this._touchStart = [];\n    _this._touchCurrent = [];\n    _this._input = INPUT.NONE; //two fingers touch interaction\n\n    _this._switchSensibility = 32; //minimum movement to be performed to fire single pan start after the second finger has been released\n\n    _this._startFingerDistance = 0; //distance between two fingers\n\n    _this._currentFingerDistance = 0;\n    _this._startFingerRotation = 0; //amount of rotation performed with two fingers\n\n    _this._currentFingerRotation = 0; //double tap\n\n    _this._devPxRatio = 0;\n    _this._downValid = true;\n    _this._nclicks = 0;\n    _this._downEvents = [];\n    _this._clickStart = 0; //first click time\n\n    _this._maxDownTime = 250;\n    _this._maxInterval = 300;\n    _this._posThreshold = 24;\n    _this._movementThreshold = 24; //cursor positions\n\n    _this._currentCursorPosition = new Vector3();\n    _this._startCursorPosition = new Vector3(); //grid\n\n    _this._grid = null; //grid to be visualized during pan operation\n\n    _this._gridPosition = new Vector3(); //gizmos\n\n    _this._gizmos = new Group();\n    _this._curvePts = 128; //animations\n\n    _this._timeStart = -1; //initial time\n\n    _this._animationId = -1; //focus animation\n\n    _this.focusAnimationTime = 500; //duration of focus animation in ms\n    //rotate animation\n\n    _this._timePrev = 0; //time at which previous rotate operation has been detected\n\n    _this._timeCurrent = 0; //time at which current rotate operation has been detected\n\n    _this._anglePrev = 0; //angle of previous rotation\n\n    _this._angleCurrent = 0; //angle of current rotation\n\n    _this._cursorPosPrev = new Vector3(); //cursor position when previous rotate operation has been detected\n\n    _this._cursorPosCurr = new Vector3(); //cursor position when current rotate operation has been detected\n\n    _this._wPrev = 0; //angular velocity of the previous rotate operation\n\n    _this._wCurr = 0; //angular velocity of the current rotate operation\n    //parameters\n\n    _this.adjustNearFar = false;\n    _this.scaleFactor = 1.1; //zoom/distance multiplier\n\n    _this.dampingFactor = 25;\n    _this.wMax = 20; //maximum angular velocity allowed\n\n    _this.enableAnimations = true; //if animations should be performed\n\n    _this.enableGrid = false; //if grid should be showed during pan operation\n\n    _this.cursorZoom = false; //if wheel zoom should be cursor centered\n\n    _this.minFov = 5;\n    _this.maxFov = 90;\n    _this.enabled = true;\n    _this.enablePan = true;\n    _this.enableRotate = true;\n    _this.enableZoom = true;\n    _this.minDistance = 0;\n    _this.maxDistance = Infinity;\n    _this.minZoom = 0;\n    _this.maxZoom = Infinity; //trackball parameters\n\n    _this.target = new Vector3(0, 0, 0);\n    _this._currentTarget = new Vector3(0, 0, 0);\n    _this._tbRadius = 1; //FSA\n\n    _this._state = STATE.IDLE;\n    _this.setCamera(_camera);\n    if (_this.scene) {\n      _this.scene.add(_this._gizmos);\n    }\n    _this._devPxRatio = window.devicePixelRatio;\n    _this.initializeMouseActions();\n    if (_this.domElement) _this.connect(_this.domElement);\n    window.addEventListener('resize', _this.onWindowResize);\n    return _this;\n  } //listeners\n\n  /**\n   * Apply a transformation matrix, to the camera and gizmos\n   * @param {Object} transformation Object containing matrices to apply to camera and gizmos\n   */\n  _createClass(ArcballControls, [{\n    key: \"applyTransformMatrix\",\n    value: function applyTransformMatrix(transformation) {\n      if (transformation !== null && transformation !== void 0 && transformation.camera && this.camera) {\n        this._m4_1.copy(this._cameraMatrixState).premultiply(transformation.camera);\n        this._m4_1.decompose(this.camera.position, this.camera.quaternion, this.camera.scale);\n        this.camera.updateMatrix(); //update camera up vector\n\n        if (this._state == STATE.ROTATE || this._state == STATE.ZROTATE || this._state == STATE.ANIMATION_ROTATE) {\n          this.camera.up.copy(this._upState).applyQuaternion(this.camera.quaternion);\n        }\n      }\n      if (transformation !== null && transformation !== void 0 && transformation.gizmos) {\n        this._m4_1.copy(this._gizmoMatrixState).premultiply(transformation.gizmos);\n        this._m4_1.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n        this._gizmos.updateMatrix();\n      }\n      if ((this._state == STATE.SCALE || this._state == STATE.FOCUS || this._state == STATE.ANIMATION_FOCUS) && this.camera) {\n        var tbRadius = this.calculateTbRadius(this.camera);\n        if (tbRadius !== undefined) {\n          this._tbRadius = tbRadius;\n        }\n        if (this.adjustNearFar) {\n          var cameraDistance = this.camera.position.distanceTo(this._gizmos.position);\n          var bb = new Box3();\n          bb.setFromObject(this._gizmos);\n          var sphere = new Sphere();\n          bb.getBoundingSphere(sphere);\n          var adjustedNearPosition = Math.max(this._nearPos0, sphere.radius + sphere.center.length());\n          var regularNearPosition = cameraDistance - this._initialNear;\n          var minNearPos = Math.min(adjustedNearPosition, regularNearPosition);\n          this.camera.near = cameraDistance - minNearPos;\n          var adjustedFarPosition = Math.min(this._farPos0, -sphere.radius + sphere.center.length());\n          var regularFarPosition = cameraDistance - this._initialFar;\n          var minFarPos = Math.min(adjustedFarPosition, regularFarPosition);\n          this.camera.far = cameraDistance - minFarPos;\n          this.camera.updateProjectionMatrix();\n        } else {\n          var update = false;\n          if (this.camera.near != this._initialNear) {\n            this.camera.near = this._initialNear;\n            update = true;\n          }\n          if (this.camera.far != this._initialFar) {\n            this.camera.far = this._initialFar;\n            update = true;\n          }\n          if (update) {\n            this.camera.updateProjectionMatrix();\n          }\n        }\n      }\n    }\n    /**\n     * Calculate the angular speed\n     * @param {Number} p0 Position at t0\n     * @param {Number} p1 Position at t1\n     * @param {Number} t0 Initial time in milliseconds\n     * @param {Number} t1 Ending time in milliseconds\n     */\n\n    /**\n     * Set gizmos visibility\n     * @param {Boolean} value Value of gizmos visibility\n     */\n  }, {\n    key: \"setGizmosVisible\",\n    value: function setGizmosVisible(value) {\n      this._gizmos.visible = value;\n      this.dispatchEvent(_changeEvent);\n    }\n    /**\n     * Creates the rotation gizmos matching trackball center and radius\n     * @param {Vector3} tbCenter The trackball center\n     * @param {number} tbRadius The trackball radius\n     */\n\n    /**\n     * Set values in transformation object\n     * @param {Matrix4} camera Transformation to be applied to the camera\n     * @param {Matrix4} gizmos Transformation to be applied to gizmos\n     */\n  }, {\n    key: \"setTransformationMatrices\",\n    value: function setTransformationMatrices() {\n      var camera = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n      var gizmos = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      if (camera) {\n        if (_transformation.camera) {\n          _transformation.camera.copy(camera);\n        } else {\n          _transformation.camera = camera.clone();\n        }\n      } else {\n        _transformation.camera = null;\n      }\n      if (gizmos) {\n        if (_transformation.gizmos) {\n          _transformation.gizmos.copy(gizmos);\n        } else {\n          _transformation.gizmos = gizmos.clone();\n        }\n      } else {\n        _transformation.gizmos = null;\n      }\n    }\n    /**\n     * Rotate camera around its direction axis passing by a given point by a given angle\n     * @param {Vector3} point The point where the rotation axis is passing trough\n     * @param {Number} angle Angle in radians\n     * @returns The computed transormation matix\n     */\n  }]);\n  return ArcballControls;\n}(EventDispatcher);\nexport { ArcballControls };","map":{"version":3,"names":["_defineProperty","Matrix4","EventDispatcher","EllipseCurve","BufferGeometry","MathUtils","Vector3","GridHelper","LineBasicMaterial","Line","Raycaster","Vector2","Quaternion","Group","Box3","Sphere","STATE","IDLE","Symbol","ROTATE","PAN","SCALE","FOV","FOCUS","ZROTATE","TOUCH_MULTI","ANIMATION_FOCUS","ANIMATION_ROTATE","INPUT","NONE","ONE_FINGER","ONE_FINGER_SWITCHED","TWO_FINGER","MULT_FINGER","CURSOR","_center","x","y","_transformation","camera","gizmos","_changeEvent","type","_startEvent","_endEvent","ArcballControls","_EventDispatcher","_inherits","_super","_createSuper","_camera","_this","_domElement","arguments","length","undefined","scene","_classCallCheck","call","_assertThisInitialized","scale","_gizmos","z","tbRadius","calculateTbRadius","_tbRadius","newRadius","curve","points","getPoints","_curvePts","curveGeometry","setFromPoints","gizmo","children","child","geometry","dispatchEvent","event","enabled","i","mouseActions","mouse","preventDefault","_touchStart","splice","_touchCurrent","_input","button","isPrimary","_downValid","_downEvents","push","pointerType","onSinglePanStart","window","addEventListener","onPointerMove","onPointerUp","onRotateStart","onPinchStart","onDoublePanStart","onTriplePanStart","modifier","ctrlKey","metaKey","shiftKey","_mouseOp","getOpFromAction","_button","updateTouchEvent","onSinglePanMove","movement","calculatePointersDistance","_devPxRatio","_switchSensibility","onRotateMove","onPinchMove","onDoublePanMove","onTriplePanMove","mouseOpState","getOpStateFromAction","_movementThreshold","nTouch","pointerId","removeEventListener","onSinglePanEnd","onDoublePanEnd","onPinchEnd","onRotateEnd","onTriplePanEnd","downTime","timeStamp","_maxDownTime","_nclicks","_clickStart","performance","now","clickInterval","_maxInterval","_posThreshold","onDoubleTap","shift","_this$camera3","enableZoom","domElement","mouseOp","notchDeltaY","sgn","deltaY","size","scaleFactor","updateTbState","Math","pow","cursorZoom","enablePan","_this$camera","_this$camera2","scalePoint","_this$unprojectOnTbPl","unprojectOnTbPlane","clientX","clientY","applyQuaternion","quaternion","multiplyScalar","zoom","add","position","_this$unprojectOnTbPl2","applyTransformMatrix","applyScale","_grid","disposeGrid","drawGrid","deltaX","_v3_1","setFromMatrixPosition","_cameraMatrixState","distanceTo","xNew","clamp","minDistance","maxDistance","tan","DEG2RAD","fov","newFov","RAD2DEG","atan","maxFov","minFov","newDistance","setFov","operation","_this$camera4","setCenter","_animationId","cancelAnimationFrame","_timeStart","activateGizmos","rayDir","_startCursorPosition","copy","enableGrid","enableRotate","unprojectOnTbSurface","enableAnimations","_timePrev","_timeCurrent","_angleCurrent","_anglePrev","_cursorPosPrev","_cursorPosCurr","_wCurr","_wPrev","setY","getCursorNDC","_currentCursorPosition","opState","_this$camera5","restart","_state","pan","distance","angle","angleTo","amount","max","rotate","calculateRotationAxis","calculateAngularSpeed","screenNotches","_fovState","_v3_2","_gizmoMatrixState","direction","clone","sub","normalize","_m4_1","makeTranslation","deltaTime","w","abs","self","requestAnimationFrame","t","rotationAxis","onRotationAnim","min","wMax","hitP","unprojectOnObj","onFocusAnim","focus","_this$camera6","_startFingerRotation","getAngle","_currentFingerRotation","getWorldDirection","_rotationAxis","rotationPoint","_this$unprojectOnTbPl3","zRotate","_startFingerDistance","_currentFingerDistance","_this$camera7","_this$camera8","_this$unprojectOnTbPl4","_this$unprojectOnTbPl5","nFingers","setMouseAction","key","operationInput","mouseInput","keyInput","state","includes","action","p1","p2","atan2","PI","p0","t0","t1","s","sqrt","vec1","vec2","_rotationMatrix","extractRotation","_quat","setFromRotationMatrix","crossVectors","factor","halfFovV","halfFovH","aspect","top","right","point","focusPoint","_translationMatrix","gizmoStateTemp","premultiply","decompose","cameraStateTemp","_this$camera9","_this$camera10","color","multiplier","divisions","maxLength","tick","width","left","height","bottom","_gridPosition","rotateX","document","console","error","style","touchAction","onContextMenu","onPointerDown","onPointerCancel","onWheel","_this$domElement","_this$domElement2","_this$domElement3","_this$domElement4","_this$scene","onWindowResize","remove","isActive","_iterator","_createForOfIteratorHelper","_step","n","done","value","material","setValues","opacity","err","e","f","cursorX","cursorY","canvas","canvasRect","getBoundingClientRect","_v2_1","setX","_this$camera11","lookAt","target","updateMatrix","_fov0","_cameraMatrixState0","matrix","_cameraProjectionState","projectionMatrix","_zoom0","_zoomState","_initialNear","near","_nearPos0","_nearPos","_initialFar","far","_farPos0","_farPos","_up0","up","_upState","updateProjectionMatrix","makeGizmos","tbCenter","curveMaterialX","fog","transparent","curveMaterialY","curveMaterialZ","gizmoX","gizmoY","gizmoZ","rotation","_gizmoMatrixState0","identity","setPosition","_scaleMatrix","makeScale","clear","time","cameraMatrix","gizmoMatrix","animTime","focusAnimationTime","easeOutCubic","w0","dampingFactor","adjust","distanceFactor","set","setTransformationMatrices","axis","makeRotationAxis","multiply","_this$camera12","JSON","stringify","arcballState","cameraFar","cameraNear","cameraUp","cameraZoom","cameraFov","navigator","clipboard","writeText","readText","then","resolved","setStateFromJSON","scaleGizmos","sizeInverse","maxZoom","minZoom","_m4_2","pos","_this$camera13","applyAxisAngle","cursor","raycaster","setFromCamera","intersect","intersectObjects","object","uuid","face","getCursorPosition","x2","y2","r2","setZ","applyMatrix4","projectionMatrixInverse","cameraGizmoDistance","radius2","h","l","m","q","a","b","c","delta","rayLength","initialDistance","newState","updateMatrices","updateMatrixState","EPS","equals","_currentTarget","newZoom","oldRadius","json","parse","fromArray","elements","gizmoTmp","adjustNearFar","Infinity","setCamera","devicePixelRatio","initializeMouseActions","connect","_createClass","transformation","cameraDistance","bb","setFromObject","sphere","getBoundingSphere","adjustedNearPosition","radius","center","regularNearPosition","minNearPos","adjustedFarPosition","regularFarPosition","minFarPos","update","setGizmosVisible","visible"],"sources":["/home/samuel/experiment/3d/farm/frontend/node_modules/three-stdlib/controls/ArcballControls.js"],"sourcesContent":["import _defineProperty from '@babel/runtime/helpers/esm/defineProperty';\nimport { Matrix4, EventDispatcher, EllipseCurve, BufferGeometry, MathUtils, Vector3, GridHelper, LineBasicMaterial, Line, Raycaster, Vector2, Quaternion, Group, Box3, Sphere } from 'three';\n\n//trackball state\nconst STATE = {\n  IDLE: Symbol(),\n  ROTATE: Symbol(),\n  PAN: Symbol(),\n  SCALE: Symbol(),\n  FOV: Symbol(),\n  FOCUS: Symbol(),\n  ZROTATE: Symbol(),\n  TOUCH_MULTI: Symbol(),\n  ANIMATION_FOCUS: Symbol(),\n  ANIMATION_ROTATE: Symbol()\n};\nconst INPUT = {\n  NONE: Symbol(),\n  ONE_FINGER: Symbol(),\n  ONE_FINGER_SWITCHED: Symbol(),\n  TWO_FINGER: Symbol(),\n  MULT_FINGER: Symbol(),\n  CURSOR: Symbol()\n}; //cursor center coordinates\n\nconst _center = {\n  x: 0,\n  y: 0\n}; //transformation matrices for gizmos and camera\n\nconst _transformation = {\n  camera: new Matrix4(),\n  gizmos: new Matrix4()\n}; //events\n\nconst _changeEvent = {\n  type: 'change'\n};\nconst _startEvent = {\n  type: 'start'\n};\nconst _endEvent = {\n  type: 'end'\n};\n/**\n *\n * @param {CamOrthographicCamera | PerspectiveCameraera} camera Virtual camera used in the scene\n * @param {HTMLElement=null} domElement Renderer's dom element\n * @param {Scene=null} scene The scene to be rendered\n */\n\nclass ArcballControls extends EventDispatcher {\n  constructor(_camera, _domElement = null, scene = null) {\n    super();\n\n    _defineProperty(this, \"camera\", void 0);\n\n    _defineProperty(this, \"domElement\", void 0);\n\n    _defineProperty(this, \"scene\", void 0);\n\n    _defineProperty(this, \"mouseActions\", void 0);\n\n    _defineProperty(this, \"_mouseOp\", void 0);\n\n    _defineProperty(this, \"_v2_1\", void 0);\n\n    _defineProperty(this, \"_v3_1\", void 0);\n\n    _defineProperty(this, \"_v3_2\", void 0);\n\n    _defineProperty(this, \"_m4_1\", void 0);\n\n    _defineProperty(this, \"_m4_2\", void 0);\n\n    _defineProperty(this, \"_quat\", void 0);\n\n    _defineProperty(this, \"_translationMatrix\", void 0);\n\n    _defineProperty(this, \"_rotationMatrix\", void 0);\n\n    _defineProperty(this, \"_scaleMatrix\", void 0);\n\n    _defineProperty(this, \"_rotationAxis\", void 0);\n\n    _defineProperty(this, \"_cameraMatrixState\", void 0);\n\n    _defineProperty(this, \"_cameraProjectionState\", void 0);\n\n    _defineProperty(this, \"_fovState\", void 0);\n\n    _defineProperty(this, \"_upState\", void 0);\n\n    _defineProperty(this, \"_zoomState\", void 0);\n\n    _defineProperty(this, \"_nearPos\", void 0);\n\n    _defineProperty(this, \"_farPos\", void 0);\n\n    _defineProperty(this, \"_gizmoMatrixState\", void 0);\n\n    _defineProperty(this, \"_up0\", void 0);\n\n    _defineProperty(this, \"_zoom0\", void 0);\n\n    _defineProperty(this, \"_fov0\", void 0);\n\n    _defineProperty(this, \"_initialNear\", void 0);\n\n    _defineProperty(this, \"_nearPos0\", void 0);\n\n    _defineProperty(this, \"_initialFar\", void 0);\n\n    _defineProperty(this, \"_farPos0\", void 0);\n\n    _defineProperty(this, \"_cameraMatrixState0\", void 0);\n\n    _defineProperty(this, \"_gizmoMatrixState0\", void 0);\n\n    _defineProperty(this, \"_button\", void 0);\n\n    _defineProperty(this, \"_touchStart\", void 0);\n\n    _defineProperty(this, \"_touchCurrent\", void 0);\n\n    _defineProperty(this, \"_input\", void 0);\n\n    _defineProperty(this, \"_switchSensibility\", void 0);\n\n    _defineProperty(this, \"_startFingerDistance\", void 0);\n\n    _defineProperty(this, \"_currentFingerDistance\", void 0);\n\n    _defineProperty(this, \"_startFingerRotation\", void 0);\n\n    _defineProperty(this, \"_currentFingerRotation\", void 0);\n\n    _defineProperty(this, \"_devPxRatio\", void 0);\n\n    _defineProperty(this, \"_downValid\", void 0);\n\n    _defineProperty(this, \"_nclicks\", void 0);\n\n    _defineProperty(this, \"_downEvents\", void 0);\n\n    _defineProperty(this, \"_clickStart\", void 0);\n\n    _defineProperty(this, \"_maxDownTime\", void 0);\n\n    _defineProperty(this, \"_maxInterval\", void 0);\n\n    _defineProperty(this, \"_posThreshold\", void 0);\n\n    _defineProperty(this, \"_movementThreshold\", void 0);\n\n    _defineProperty(this, \"_currentCursorPosition\", void 0);\n\n    _defineProperty(this, \"_startCursorPosition\", void 0);\n\n    _defineProperty(this, \"_grid\", void 0);\n\n    _defineProperty(this, \"_gridPosition\", void 0);\n\n    _defineProperty(this, \"_gizmos\", void 0);\n\n    _defineProperty(this, \"_curvePts\", void 0);\n\n    _defineProperty(this, \"_timeStart\", void 0);\n\n    _defineProperty(this, \"_animationId\", void 0);\n\n    _defineProperty(this, \"focusAnimationTime\", void 0);\n\n    _defineProperty(this, \"_timePrev\", void 0);\n\n    _defineProperty(this, \"_timeCurrent\", void 0);\n\n    _defineProperty(this, \"_anglePrev\", void 0);\n\n    _defineProperty(this, \"_angleCurrent\", void 0);\n\n    _defineProperty(this, \"_cursorPosPrev\", void 0);\n\n    _defineProperty(this, \"_cursorPosCurr\", void 0);\n\n    _defineProperty(this, \"_wPrev\", void 0);\n\n    _defineProperty(this, \"_wCurr\", void 0);\n\n    _defineProperty(this, \"adjustNearFar\", void 0);\n\n    _defineProperty(this, \"scaleFactor\", void 0);\n\n    _defineProperty(this, \"dampingFactor\", void 0);\n\n    _defineProperty(this, \"wMax\", void 0);\n\n    _defineProperty(this, \"enableAnimations\", void 0);\n\n    _defineProperty(this, \"enableGrid\", void 0);\n\n    _defineProperty(this, \"cursorZoom\", void 0);\n\n    _defineProperty(this, \"minFov\", void 0);\n\n    _defineProperty(this, \"maxFov\", void 0);\n\n    _defineProperty(this, \"enabled\", void 0);\n\n    _defineProperty(this, \"enablePan\", void 0);\n\n    _defineProperty(this, \"enableRotate\", void 0);\n\n    _defineProperty(this, \"enableZoom\", void 0);\n\n    _defineProperty(this, \"minDistance\", void 0);\n\n    _defineProperty(this, \"maxDistance\", void 0);\n\n    _defineProperty(this, \"minZoom\", void 0);\n\n    _defineProperty(this, \"maxZoom\", void 0);\n\n    _defineProperty(this, \"target\", void 0);\n\n    _defineProperty(this, \"_currentTarget\", void 0);\n\n    _defineProperty(this, \"_tbRadius\", void 0);\n\n    _defineProperty(this, \"_state\", void 0);\n\n    _defineProperty(this, \"onWindowResize\", () => {\n      const scale = (this._gizmos.scale.x + this._gizmos.scale.y + this._gizmos.scale.z) / 3;\n\n      if (this.camera) {\n        const tbRadius = this.calculateTbRadius(this.camera);\n\n        if (tbRadius !== undefined) {\n          this._tbRadius = tbRadius;\n        }\n      }\n\n      const newRadius = this._tbRadius / scale; // @ts-expect-error\n\n      const curve = new EllipseCurve(0, 0, newRadius, newRadius);\n      const points = curve.getPoints(this._curvePts);\n      const curveGeometry = new BufferGeometry().setFromPoints(points);\n\n      for (const gizmo in this._gizmos.children) {\n        const child = this._gizmos.children[gizmo];\n        child.geometry = curveGeometry;\n      }\n\n      this.dispatchEvent(_changeEvent);\n    });\n\n    _defineProperty(this, \"onContextMenu\", event => {\n      if (!this.enabled) {\n        return;\n      }\n\n      for (let i = 0; i < this.mouseActions.length; i++) {\n        if (this.mouseActions[i].mouse == 2) {\n          //prevent only if button 2 is actually used\n          event.preventDefault();\n          break;\n        }\n      }\n    });\n\n    _defineProperty(this, \"onPointerCancel\", () => {\n      this._touchStart.splice(0, this._touchStart.length);\n\n      this._touchCurrent.splice(0, this._touchCurrent.length);\n\n      this._input = INPUT.NONE;\n    });\n\n    _defineProperty(this, \"onPointerDown\", event => {\n      if (event.button == 0 && event.isPrimary) {\n        this._downValid = true;\n\n        this._downEvents.push(event);\n      } else {\n        this._downValid = false;\n      }\n\n      if (event.pointerType == 'touch' && this._input != INPUT.CURSOR) {\n        this._touchStart.push(event);\n\n        this._touchCurrent.push(event);\n\n        switch (this._input) {\n          case INPUT.NONE:\n            //singleStart\n            this._input = INPUT.ONE_FINGER;\n            this.onSinglePanStart(event, 'ROTATE');\n            window.addEventListener('pointermove', this.onPointerMove);\n            window.addEventListener('pointerup', this.onPointerUp);\n            break;\n\n          case INPUT.ONE_FINGER:\n          case INPUT.ONE_FINGER_SWITCHED:\n            //doubleStart\n            this._input = INPUT.TWO_FINGER;\n            this.onRotateStart();\n            this.onPinchStart();\n            this.onDoublePanStart();\n            break;\n\n          case INPUT.TWO_FINGER:\n            //multipleStart\n            this._input = INPUT.MULT_FINGER;\n            this.onTriplePanStart();\n            break;\n        }\n      } else if (event.pointerType != 'touch' && this._input == INPUT.NONE) {\n        let modifier = null;\n\n        if (event.ctrlKey || event.metaKey) {\n          modifier = 'CTRL';\n        } else if (event.shiftKey) {\n          modifier = 'SHIFT';\n        }\n\n        this._mouseOp = this.getOpFromAction(event.button, modifier);\n\n        if (this._mouseOp) {\n          window.addEventListener('pointermove', this.onPointerMove);\n          window.addEventListener('pointerup', this.onPointerUp); //singleStart\n\n          this._input = INPUT.CURSOR;\n          this._button = event.button;\n          this.onSinglePanStart(event, this._mouseOp);\n        }\n      }\n    });\n\n    _defineProperty(this, \"onPointerMove\", event => {\n      if (event.pointerType == 'touch' && this._input != INPUT.CURSOR) {\n        switch (this._input) {\n          case INPUT.ONE_FINGER:\n            //singleMove\n            this.updateTouchEvent(event);\n            this.onSinglePanMove(event, STATE.ROTATE);\n            break;\n\n          case INPUT.ONE_FINGER_SWITCHED:\n            const movement = this.calculatePointersDistance(this._touchCurrent[0], event) * this._devPxRatio;\n\n            if (movement >= this._switchSensibility) {\n              //singleMove\n              this._input = INPUT.ONE_FINGER;\n              this.updateTouchEvent(event);\n              this.onSinglePanStart(event, 'ROTATE');\n              break;\n            }\n\n            break;\n\n          case INPUT.TWO_FINGER:\n            //rotate/pan/pinchMove\n            this.updateTouchEvent(event);\n            this.onRotateMove();\n            this.onPinchMove();\n            this.onDoublePanMove();\n            break;\n\n          case INPUT.MULT_FINGER:\n            //multMove\n            this.updateTouchEvent(event);\n            this.onTriplePanMove();\n            break;\n        }\n      } else if (event.pointerType != 'touch' && this._input == INPUT.CURSOR) {\n        let modifier = null;\n\n        if (event.ctrlKey || event.metaKey) {\n          modifier = 'CTRL';\n        } else if (event.shiftKey) {\n          modifier = 'SHIFT';\n        }\n\n        const mouseOpState = this.getOpStateFromAction(this._button, modifier);\n\n        if (mouseOpState) {\n          this.onSinglePanMove(event, mouseOpState);\n        }\n      } //checkDistance\n\n\n      if (this._downValid) {\n        const movement = this.calculatePointersDistance(this._downEvents[this._downEvents.length - 1], event) * this._devPxRatio;\n\n        if (movement > this._movementThreshold) {\n          this._downValid = false;\n        }\n      }\n    });\n\n    _defineProperty(this, \"onPointerUp\", event => {\n      if (event.pointerType == 'touch' && this._input != INPUT.CURSOR) {\n        const nTouch = this._touchCurrent.length;\n\n        for (let i = 0; i < nTouch; i++) {\n          if (this._touchCurrent[i].pointerId == event.pointerId) {\n            this._touchCurrent.splice(i, 1);\n\n            this._touchStart.splice(i, 1);\n\n            break;\n          }\n        }\n\n        switch (this._input) {\n          case INPUT.ONE_FINGER:\n          case INPUT.ONE_FINGER_SWITCHED:\n            //singleEnd\n            window.removeEventListener('pointermove', this.onPointerMove);\n            window.removeEventListener('pointerup', this.onPointerUp);\n            this._input = INPUT.NONE;\n            this.onSinglePanEnd();\n            break;\n\n          case INPUT.TWO_FINGER:\n            //doubleEnd\n            this.onDoublePanEnd();\n            this.onPinchEnd();\n            this.onRotateEnd(); //switching to singleStart\n\n            this._input = INPUT.ONE_FINGER_SWITCHED;\n            break;\n\n          case INPUT.MULT_FINGER:\n            if (this._touchCurrent.length == 0) {\n              window.removeEventListener('pointermove', this.onPointerMove);\n              window.removeEventListener('pointerup', this.onPointerUp); //multCancel\n\n              this._input = INPUT.NONE;\n              this.onTriplePanEnd();\n            }\n\n            break;\n        }\n      } else if (event.pointerType != 'touch' && this._input == INPUT.CURSOR) {\n        window.removeEventListener('pointermove', this.onPointerMove);\n        window.removeEventListener('pointerup', this.onPointerUp);\n        this._input = INPUT.NONE;\n        this.onSinglePanEnd();\n        this._button = -1;\n      }\n\n      if (event.isPrimary) {\n        if (this._downValid) {\n          const downTime = event.timeStamp - this._downEvents[this._downEvents.length - 1].timeStamp;\n\n          if (downTime <= this._maxDownTime) {\n            if (this._nclicks == 0) {\n              //first valid click detected\n              this._nclicks = 1;\n              this._clickStart = performance.now();\n            } else {\n              const clickInterval = event.timeStamp - this._clickStart;\n\n              const movement = this.calculatePointersDistance(this._downEvents[1], this._downEvents[0]) * this._devPxRatio;\n\n              if (clickInterval <= this._maxInterval && movement <= this._posThreshold) {\n                //second valid click detected\n                //fire double tap and reset values\n                this._nclicks = 0;\n\n                this._downEvents.splice(0, this._downEvents.length);\n\n                this.onDoubleTap(event);\n              } else {\n                //new 'first click'\n                this._nclicks = 1;\n\n                this._downEvents.shift();\n\n                this._clickStart = performance.now();\n              }\n            }\n          } else {\n            this._downValid = false;\n            this._nclicks = 0;\n\n            this._downEvents.splice(0, this._downEvents.length);\n          }\n        } else {\n          this._nclicks = 0;\n\n          this._downEvents.splice(0, this._downEvents.length);\n        }\n      }\n    });\n\n    _defineProperty(this, \"onWheel\", event => {\n      var _this$camera3;\n\n      if (this.enabled && this.enableZoom && this.domElement) {\n        let modifier = null;\n\n        if (event.ctrlKey || event.metaKey) {\n          modifier = 'CTRL';\n        } else if (event.shiftKey) {\n          modifier = 'SHIFT';\n        }\n\n        const mouseOp = this.getOpFromAction('WHEEL', modifier);\n\n        if (mouseOp) {\n          event.preventDefault();\n          this.dispatchEvent(_startEvent);\n          const notchDeltaY = 125; //distance of one notch of mouse wheel\n\n          let sgn = event.deltaY / notchDeltaY;\n          let size = 1;\n\n          if (sgn > 0) {\n            size = 1 / this.scaleFactor;\n          } else if (sgn < 0) {\n            size = this.scaleFactor;\n          }\n\n          switch (mouseOp) {\n            case 'ZOOM':\n              this.updateTbState(STATE.SCALE, true);\n\n              if (sgn > 0) {\n                size = 1 / Math.pow(this.scaleFactor, sgn);\n              } else if (sgn < 0) {\n                size = Math.pow(this.scaleFactor, -sgn);\n              }\n\n              if (this.cursorZoom && this.enablePan) {\n                var _this$camera, _this$camera2;\n\n                let scalePoint;\n\n                if (((_this$camera = this.camera) === null || _this$camera === void 0 ? void 0 : _this$camera.type) === 'OrthographicCamera') {\n                  var _this$unprojectOnTbPl;\n\n                  scalePoint = (_this$unprojectOnTbPl = this.unprojectOnTbPlane(this.camera, event.clientX, event.clientY, this.domElement)) === null || _this$unprojectOnTbPl === void 0 ? void 0 : _this$unprojectOnTbPl.applyQuaternion(this.camera.quaternion).multiplyScalar(1 / this.camera.zoom).add(this._gizmos.position);\n                }\n\n                if (((_this$camera2 = this.camera) === null || _this$camera2 === void 0 ? void 0 : _this$camera2.type) === 'PerspectiveCamera') {\n                  var _this$unprojectOnTbPl2;\n\n                  scalePoint = (_this$unprojectOnTbPl2 = this.unprojectOnTbPlane(this.camera, event.clientX, event.clientY, this.domElement)) === null || _this$unprojectOnTbPl2 === void 0 ? void 0 : _this$unprojectOnTbPl2.applyQuaternion(this.camera.quaternion).add(this._gizmos.position);\n                }\n\n                if (scalePoint !== undefined) this.applyTransformMatrix(this.applyScale(size, scalePoint));\n              } else {\n                this.applyTransformMatrix(this.applyScale(size, this._gizmos.position));\n              }\n\n              if (this._grid) {\n                this.disposeGrid();\n                this.drawGrid();\n              }\n\n              this.updateTbState(STATE.IDLE, false);\n              this.dispatchEvent(_changeEvent);\n              this.dispatchEvent(_endEvent);\n              break;\n\n            case 'FOV':\n              if (((_this$camera3 = this.camera) === null || _this$camera3 === void 0 ? void 0 : _this$camera3.type) === 'PerspectiveCamera') {\n                this.updateTbState(STATE.FOV, true); //Vertigo effect\n                //\t  fov / 2\n                //\t\t|\\\n                //\t\t| \\\n                //\t\t|  \\\n                //\tx\t|\t\\\n                //\t\t| \t \\\n                //\t\t| \t  \\\n                //\t\t| _ _ _\\\n                //\t\t\ty\n                //check for iOs shift shortcut\n\n                if (event.deltaX != 0) {\n                  sgn = event.deltaX / notchDeltaY;\n                  size = 1;\n\n                  if (sgn > 0) {\n                    size = 1 / Math.pow(this.scaleFactor, sgn);\n                  } else if (sgn < 0) {\n                    size = Math.pow(this.scaleFactor, -sgn);\n                  }\n                }\n\n                this._v3_1.setFromMatrixPosition(this._cameraMatrixState);\n\n                const x = this._v3_1.distanceTo(this._gizmos.position);\n\n                let xNew = x / size; //distance between camera and gizmos if scale(size, scalepoint) would be performed\n                //check min and max distance\n\n                xNew = MathUtils.clamp(xNew, this.minDistance, this.maxDistance);\n                const y = x * Math.tan(MathUtils.DEG2RAD * this.camera.fov * 0.5); //calculate new fov\n\n                let newFov = MathUtils.RAD2DEG * (Math.atan(y / xNew) * 2); //check min and max fov\n\n                if (newFov > this.maxFov) {\n                  newFov = this.maxFov;\n                } else if (newFov < this.minFov) {\n                  newFov = this.minFov;\n                }\n\n                const newDistance = y / Math.tan(MathUtils.DEG2RAD * (newFov / 2));\n                size = x / newDistance;\n                this.setFov(newFov);\n                this.applyTransformMatrix(this.applyScale(size, this._gizmos.position, false));\n              }\n\n              if (this._grid) {\n                this.disposeGrid();\n                this.drawGrid();\n              }\n\n              this.updateTbState(STATE.IDLE, false);\n              this.dispatchEvent(_changeEvent);\n              this.dispatchEvent(_endEvent);\n              break;\n          }\n        }\n      }\n    });\n\n    _defineProperty(this, \"onSinglePanStart\", (event, operation) => {\n      var _this$camera4;\n\n      if (this.enabled && this.domElement) {\n        this.dispatchEvent(_startEvent);\n        this.setCenter(event.clientX, event.clientY);\n\n        switch (operation) {\n          case 'PAN':\n            if (!this.enablePan) return;\n\n            if (this._animationId != -1) {\n              cancelAnimationFrame(this._animationId);\n              this._animationId = -1;\n              this._timeStart = -1;\n              this.activateGizmos(false);\n              this.dispatchEvent(_changeEvent);\n            }\n\n            if (this.camera) {\n              this.updateTbState(STATE.PAN, true);\n              const rayDir = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement);\n\n              if (rayDir !== undefined) {\n                this._startCursorPosition.copy(rayDir);\n              }\n\n              if (this.enableGrid) {\n                this.drawGrid();\n                this.dispatchEvent(_changeEvent);\n              }\n            }\n\n            break;\n\n          case 'ROTATE':\n            if (!this.enableRotate) return;\n\n            if (this._animationId != -1) {\n              cancelAnimationFrame(this._animationId);\n              this._animationId = -1;\n              this._timeStart = -1;\n            }\n\n            if (this.camera) {\n              this.updateTbState(STATE.ROTATE, true);\n              const rayDir = this.unprojectOnTbSurface(this.camera, _center.x, _center.y, this.domElement, this._tbRadius);\n\n              if (rayDir !== undefined) {\n                this._startCursorPosition.copy(rayDir);\n              }\n\n              this.activateGizmos(true);\n\n              if (this.enableAnimations) {\n                this._timePrev = this._timeCurrent = performance.now();\n                this._angleCurrent = this._anglePrev = 0;\n\n                this._cursorPosPrev.copy(this._startCursorPosition);\n\n                this._cursorPosCurr.copy(this._cursorPosPrev);\n\n                this._wCurr = 0;\n                this._wPrev = this._wCurr;\n              }\n            }\n\n            this.dispatchEvent(_changeEvent);\n            break;\n\n          case 'FOV':\n            if (!this.enableZoom) return;\n\n            if (((_this$camera4 = this.camera) === null || _this$camera4 === void 0 ? void 0 : _this$camera4.type) === 'PerspectiveCamera') {\n              if (this._animationId != -1) {\n                cancelAnimationFrame(this._animationId);\n                this._animationId = -1;\n                this._timeStart = -1;\n                this.activateGizmos(false);\n                this.dispatchEvent(_changeEvent);\n              }\n\n              this.updateTbState(STATE.FOV, true);\n\n              this._startCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n\n              this._currentCursorPosition.copy(this._startCursorPosition);\n            }\n\n            break;\n\n          case 'ZOOM':\n            if (!this.enableZoom) return;\n\n            if (this._animationId != -1) {\n              cancelAnimationFrame(this._animationId);\n              this._animationId = -1;\n              this._timeStart = -1;\n              this.activateGizmos(false);\n              this.dispatchEvent(_changeEvent);\n            }\n\n            this.updateTbState(STATE.SCALE, true);\n\n            this._startCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n\n            this._currentCursorPosition.copy(this._startCursorPosition);\n\n            break;\n        }\n      }\n    });\n\n    _defineProperty(this, \"onSinglePanMove\", (event, opState) => {\n      var _this$camera5;\n\n      if (this.enabled && this.domElement) {\n        const restart = opState != this._state;\n        this.setCenter(event.clientX, event.clientY);\n\n        switch (opState) {\n          case STATE.PAN:\n            if (this.enablePan && this.camera) {\n              if (restart) {\n                //switch to pan operation\n                this.dispatchEvent(_endEvent);\n                this.dispatchEvent(_startEvent);\n                this.updateTbState(opState, true);\n                const rayDir = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement);\n\n                if (rayDir !== undefined) {\n                  this._startCursorPosition.copy(rayDir);\n                }\n\n                if (this.enableGrid) {\n                  this.drawGrid();\n                }\n\n                this.activateGizmos(false);\n              } else {\n                //continue with pan operation\n                const rayDir = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement);\n\n                if (rayDir !== undefined) {\n                  this._currentCursorPosition.copy(rayDir);\n                }\n\n                this.applyTransformMatrix(this.pan(this._startCursorPosition, this._currentCursorPosition));\n              }\n            }\n\n            break;\n\n          case STATE.ROTATE:\n            if (this.enableRotate && this.camera) {\n              if (restart) {\n                //switch to rotate operation\n                this.dispatchEvent(_endEvent);\n                this.dispatchEvent(_startEvent);\n                this.updateTbState(opState, true);\n                const rayDir = this.unprojectOnTbSurface(this.camera, _center.x, _center.y, this.domElement, this._tbRadius);\n\n                if (rayDir !== undefined) {\n                  this._startCursorPosition.copy(rayDir);\n                }\n\n                if (this.enableGrid) {\n                  this.disposeGrid();\n                }\n\n                this.activateGizmos(true);\n              } else {\n                //continue with rotate operation\n                const rayDir = this.unprojectOnTbSurface(this.camera, _center.x, _center.y, this.domElement, this._tbRadius);\n\n                if (rayDir !== undefined) {\n                  this._currentCursorPosition.copy(rayDir);\n                }\n\n                const distance = this._startCursorPosition.distanceTo(this._currentCursorPosition);\n\n                const angle = this._startCursorPosition.angleTo(this._currentCursorPosition);\n\n                const amount = Math.max(distance / this._tbRadius, angle); //effective rotation angle\n\n                this.applyTransformMatrix(this.rotate(this.calculateRotationAxis(this._startCursorPosition, this._currentCursorPosition), amount));\n\n                if (this.enableAnimations) {\n                  this._timePrev = this._timeCurrent;\n                  this._timeCurrent = performance.now();\n                  this._anglePrev = this._angleCurrent;\n                  this._angleCurrent = amount;\n\n                  this._cursorPosPrev.copy(this._cursorPosCurr);\n\n                  this._cursorPosCurr.copy(this._currentCursorPosition);\n\n                  this._wPrev = this._wCurr;\n                  this._wCurr = this.calculateAngularSpeed(this._anglePrev, this._angleCurrent, this._timePrev, this._timeCurrent);\n                }\n              }\n            }\n\n            break;\n\n          case STATE.SCALE:\n            if (this.enableZoom) {\n              if (restart) {\n                //switch to zoom operation\n                this.dispatchEvent(_endEvent);\n                this.dispatchEvent(_startEvent);\n                this.updateTbState(opState, true);\n\n                this._startCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n\n                this._currentCursorPosition.copy(this._startCursorPosition);\n\n                if (this.enableGrid) {\n                  this.disposeGrid();\n                }\n\n                this.activateGizmos(false);\n              } else {\n                //continue with zoom operation\n                const screenNotches = 8; //how many wheel notches corresponds to a full screen pan\n\n                this._currentCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n\n                const movement = this._currentCursorPosition.y - this._startCursorPosition.y;\n                let size = 1;\n\n                if (movement < 0) {\n                  size = 1 / Math.pow(this.scaleFactor, -movement * screenNotches);\n                } else if (movement > 0) {\n                  size = Math.pow(this.scaleFactor, movement * screenNotches);\n                }\n\n                this.applyTransformMatrix(this.applyScale(size, this._gizmos.position));\n              }\n            }\n\n            break;\n\n          case STATE.FOV:\n            if (this.enableZoom && ((_this$camera5 = this.camera) === null || _this$camera5 === void 0 ? void 0 : _this$camera5.type) === 'PerspectiveCamera') {\n              if (restart) {\n                //switch to fov operation\n                this.dispatchEvent(_endEvent);\n                this.dispatchEvent(_startEvent);\n                this.updateTbState(opState, true);\n\n                this._startCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n\n                this._currentCursorPosition.copy(this._startCursorPosition);\n\n                if (this.enableGrid) {\n                  this.disposeGrid();\n                }\n\n                this.activateGizmos(false);\n              } else {\n                //continue with fov operation\n                const screenNotches = 8; //how many wheel notches corresponds to a full screen pan\n\n                this._currentCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n\n                const movement = this._currentCursorPosition.y - this._startCursorPosition.y;\n                let size = 1;\n\n                if (movement < 0) {\n                  size = 1 / Math.pow(this.scaleFactor, -movement * screenNotches);\n                } else if (movement > 0) {\n                  size = Math.pow(this.scaleFactor, movement * screenNotches);\n                }\n\n                this._v3_1.setFromMatrixPosition(this._cameraMatrixState);\n\n                const x = this._v3_1.distanceTo(this._gizmos.position);\n\n                let xNew = x / size; //distance between camera and gizmos if scale(size, scalepoint) would be performed\n                //check min and max distance\n\n                xNew = MathUtils.clamp(xNew, this.minDistance, this.maxDistance);\n                const y = x * Math.tan(MathUtils.DEG2RAD * this._fovState * 0.5); //calculate new fov\n\n                let newFov = MathUtils.RAD2DEG * (Math.atan(y / xNew) * 2); //check min and max fov\n\n                newFov = MathUtils.clamp(newFov, this.minFov, this.maxFov);\n                const newDistance = y / Math.tan(MathUtils.DEG2RAD * (newFov / 2));\n                size = x / newDistance;\n\n                this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);\n\n                this.setFov(newFov);\n                this.applyTransformMatrix(this.applyScale(size, this._v3_2, false)); //adjusting distance\n\n                const direction = this._gizmos.position.clone().sub(this.camera.position).normalize().multiplyScalar(newDistance / x);\n\n                this._m4_1.makeTranslation(direction.x, direction.y, direction.z);\n              }\n            }\n\n            break;\n        }\n\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n\n    _defineProperty(this, \"onSinglePanEnd\", () => {\n      if (this._state == STATE.ROTATE) {\n        if (!this.enableRotate) {\n          return;\n        }\n\n        if (this.enableAnimations) {\n          //perform rotation animation\n          const deltaTime = performance.now() - this._timeCurrent;\n\n          if (deltaTime < 120) {\n            const w = Math.abs((this._wPrev + this._wCurr) / 2);\n            const self = this;\n            this._animationId = window.requestAnimationFrame(function (t) {\n              self.updateTbState(STATE.ANIMATION_ROTATE, true);\n              const rotationAxis = self.calculateRotationAxis(self._cursorPosPrev, self._cursorPosCurr);\n              self.onRotationAnim(t, rotationAxis, Math.min(w, self.wMax));\n            });\n          } else {\n            //cursor has been standing still for over 120 ms since last movement\n            this.updateTbState(STATE.IDLE, false);\n            this.activateGizmos(false);\n            this.dispatchEvent(_changeEvent);\n          }\n        } else {\n          this.updateTbState(STATE.IDLE, false);\n          this.activateGizmos(false);\n          this.dispatchEvent(_changeEvent);\n        }\n      } else if (this._state == STATE.PAN || this._state == STATE.IDLE) {\n        this.updateTbState(STATE.IDLE, false);\n\n        if (this.enableGrid) {\n          this.disposeGrid();\n        }\n\n        this.activateGizmos(false);\n        this.dispatchEvent(_changeEvent);\n      }\n\n      this.dispatchEvent(_endEvent);\n    });\n\n    _defineProperty(this, \"onDoubleTap\", event => {\n      if (this.enabled && this.enablePan && this.scene && this.camera && this.domElement) {\n        this.dispatchEvent(_startEvent);\n        this.setCenter(event.clientX, event.clientY);\n        const hitP = this.unprojectOnObj(this.getCursorNDC(_center.x, _center.y, this.domElement), this.camera);\n\n        if (hitP && this.enableAnimations) {\n          const self = this;\n\n          if (this._animationId != -1) {\n            window.cancelAnimationFrame(this._animationId);\n          }\n\n          this._timeStart = -1;\n          this._animationId = window.requestAnimationFrame(function (t) {\n            self.updateTbState(STATE.ANIMATION_FOCUS, true);\n            self.onFocusAnim(t, hitP, self._cameraMatrixState, self._gizmoMatrixState);\n          });\n        } else if (hitP && !this.enableAnimations) {\n          this.updateTbState(STATE.FOCUS, true);\n          this.focus(hitP, this.scaleFactor);\n          this.updateTbState(STATE.IDLE, false);\n          this.dispatchEvent(_changeEvent);\n        }\n      }\n\n      this.dispatchEvent(_endEvent);\n    });\n\n    _defineProperty(this, \"onDoublePanStart\", () => {\n      if (this.enabled && this.enablePan && this.camera && this.domElement) {\n        this.dispatchEvent(_startEvent);\n        this.updateTbState(STATE.PAN, true);\n        this.setCenter((this._touchCurrent[0].clientX + this._touchCurrent[1].clientX) / 2, (this._touchCurrent[0].clientY + this._touchCurrent[1].clientY) / 2);\n        const rayDir = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement, true);\n\n        if (rayDir !== undefined) {\n          this._startCursorPosition.copy(rayDir);\n        }\n\n        this._currentCursorPosition.copy(this._startCursorPosition);\n\n        this.activateGizmos(false);\n      }\n    });\n\n    _defineProperty(this, \"onDoublePanMove\", () => {\n      if (this.enabled && this.enablePan && this.camera && this.domElement) {\n        this.setCenter((this._touchCurrent[0].clientX + this._touchCurrent[1].clientX) / 2, (this._touchCurrent[0].clientY + this._touchCurrent[1].clientY) / 2);\n\n        if (this._state != STATE.PAN) {\n          this.updateTbState(STATE.PAN, true);\n\n          this._startCursorPosition.copy(this._currentCursorPosition);\n        }\n\n        const rayDir = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement, true);\n        if (rayDir !== undefined) this._currentCursorPosition.copy(rayDir);\n        this.applyTransformMatrix(this.pan(this._startCursorPosition, this._currentCursorPosition, true));\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n\n    _defineProperty(this, \"onDoublePanEnd\", () => {\n      this.updateTbState(STATE.IDLE, false);\n      this.dispatchEvent(_endEvent);\n    });\n\n    _defineProperty(this, \"onRotateStart\", () => {\n      if (this.enabled && this.enableRotate) {\n        var _this$camera6;\n\n        this.dispatchEvent(_startEvent);\n        this.updateTbState(STATE.ZROTATE, true); //this._startFingerRotation = event.rotation;\n\n        this._startFingerRotation = this.getAngle(this._touchCurrent[1], this._touchCurrent[0]) + this.getAngle(this._touchStart[1], this._touchStart[0]);\n        this._currentFingerRotation = this._startFingerRotation;\n        (_this$camera6 = this.camera) === null || _this$camera6 === void 0 ? void 0 : _this$camera6.getWorldDirection(this._rotationAxis); //rotation axis\n\n        if (!this.enablePan && !this.enableZoom) {\n          this.activateGizmos(true);\n        }\n      }\n    });\n\n    _defineProperty(this, \"onRotateMove\", () => {\n      if (this.enabled && this.enableRotate && this.camera && this.domElement) {\n        this.setCenter((this._touchCurrent[0].clientX + this._touchCurrent[1].clientX) / 2, (this._touchCurrent[0].clientY + this._touchCurrent[1].clientY) / 2);\n        let rotationPoint;\n\n        if (this._state != STATE.ZROTATE) {\n          this.updateTbState(STATE.ZROTATE, true);\n          this._startFingerRotation = this._currentFingerRotation;\n        } //this._currentFingerRotation = event.rotation;\n\n\n        this._currentFingerRotation = this.getAngle(this._touchCurrent[1], this._touchCurrent[0]) + this.getAngle(this._touchStart[1], this._touchStart[0]);\n\n        if (!this.enablePan) {\n          rotationPoint = new Vector3().setFromMatrixPosition(this._gizmoMatrixState);\n        } else if (this.camera) {\n          var _this$unprojectOnTbPl3;\n\n          this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);\n\n          rotationPoint = (_this$unprojectOnTbPl3 = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement)) === null || _this$unprojectOnTbPl3 === void 0 ? void 0 : _this$unprojectOnTbPl3.applyQuaternion(this.camera.quaternion).multiplyScalar(1 / this.camera.zoom).add(this._v3_2);\n        }\n\n        const amount = MathUtils.DEG2RAD * (this._startFingerRotation - this._currentFingerRotation);\n\n        if (rotationPoint !== undefined) {\n          this.applyTransformMatrix(this.zRotate(rotationPoint, amount));\n        }\n\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n\n    _defineProperty(this, \"onRotateEnd\", () => {\n      this.updateTbState(STATE.IDLE, false);\n      this.activateGizmos(false);\n      this.dispatchEvent(_endEvent);\n    });\n\n    _defineProperty(this, \"onPinchStart\", () => {\n      if (this.enabled && this.enableZoom) {\n        this.dispatchEvent(_startEvent);\n        this.updateTbState(STATE.SCALE, true);\n        this._startFingerDistance = this.calculatePointersDistance(this._touchCurrent[0], this._touchCurrent[1]);\n        this._currentFingerDistance = this._startFingerDistance;\n        this.activateGizmos(false);\n      }\n    });\n\n    _defineProperty(this, \"onPinchMove\", () => {\n      if (this.enabled && this.enableZoom && this.domElement) {\n        this.setCenter((this._touchCurrent[0].clientX + this._touchCurrent[1].clientX) / 2, (this._touchCurrent[0].clientY + this._touchCurrent[1].clientY) / 2);\n        const minDistance = 12; //minimum distance between fingers (in css pixels)\n\n        if (this._state != STATE.SCALE) {\n          this._startFingerDistance = this._currentFingerDistance;\n          this.updateTbState(STATE.SCALE, true);\n        }\n\n        this._currentFingerDistance = Math.max(this.calculatePointersDistance(this._touchCurrent[0], this._touchCurrent[1]), minDistance * this._devPxRatio);\n        const amount = this._currentFingerDistance / this._startFingerDistance;\n        let scalePoint;\n\n        if (!this.enablePan) {\n          scalePoint = this._gizmos.position;\n        } else {\n          var _this$camera7, _this$camera8;\n\n          if (((_this$camera7 = this.camera) === null || _this$camera7 === void 0 ? void 0 : _this$camera7.type) === 'OrthographicCamera') {\n            var _this$unprojectOnTbPl4;\n\n            scalePoint = (_this$unprojectOnTbPl4 = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement)) === null || _this$unprojectOnTbPl4 === void 0 ? void 0 : _this$unprojectOnTbPl4.applyQuaternion(this.camera.quaternion).multiplyScalar(1 / this.camera.zoom).add(this._gizmos.position);\n          } else if (((_this$camera8 = this.camera) === null || _this$camera8 === void 0 ? void 0 : _this$camera8.type) === 'PerspectiveCamera') {\n            var _this$unprojectOnTbPl5;\n\n            scalePoint = (_this$unprojectOnTbPl5 = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement)) === null || _this$unprojectOnTbPl5 === void 0 ? void 0 : _this$unprojectOnTbPl5.applyQuaternion(this.camera.quaternion).add(this._gizmos.position);\n          }\n        }\n\n        if (scalePoint !== undefined) {\n          this.applyTransformMatrix(this.applyScale(amount, scalePoint));\n        }\n\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n\n    _defineProperty(this, \"onPinchEnd\", () => {\n      this.updateTbState(STATE.IDLE, false);\n      this.dispatchEvent(_endEvent);\n    });\n\n    _defineProperty(this, \"onTriplePanStart\", () => {\n      if (this.enabled && this.enableZoom && this.domElement) {\n        this.dispatchEvent(_startEvent);\n        this.updateTbState(STATE.SCALE, true); //const center = event.center;\n\n        let clientX = 0;\n        let clientY = 0;\n        const nFingers = this._touchCurrent.length;\n\n        for (let i = 0; i < nFingers; i++) {\n          clientX += this._touchCurrent[i].clientX;\n          clientY += this._touchCurrent[i].clientY;\n        }\n\n        this.setCenter(clientX / nFingers, clientY / nFingers);\n\n        this._startCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n\n        this._currentCursorPosition.copy(this._startCursorPosition);\n      }\n    });\n\n    _defineProperty(this, \"onTriplePanMove\", () => {\n      if (this.enabled && this.enableZoom && this.camera && this.domElement) {\n        //\t  fov / 2\n        //\t\t|\\\n        //\t\t| \\\n        //\t\t|  \\\n        //\tx\t|\t\\\n        //\t\t| \t \\\n        //\t\t| \t  \\\n        //\t\t| _ _ _\\\n        //\t\t\ty\n        //const center = event.center;\n        let clientX = 0;\n        let clientY = 0;\n        const nFingers = this._touchCurrent.length;\n\n        for (let i = 0; i < nFingers; i++) {\n          clientX += this._touchCurrent[i].clientX;\n          clientY += this._touchCurrent[i].clientY;\n        }\n\n        this.setCenter(clientX / nFingers, clientY / nFingers);\n        const screenNotches = 8; //how many wheel notches corresponds to a full screen pan\n\n        this._currentCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n\n        const movement = this._currentCursorPosition.y - this._startCursorPosition.y;\n        let size = 1;\n\n        if (movement < 0) {\n          size = 1 / Math.pow(this.scaleFactor, -movement * screenNotches);\n        } else if (movement > 0) {\n          size = Math.pow(this.scaleFactor, movement * screenNotches);\n        }\n\n        this._v3_1.setFromMatrixPosition(this._cameraMatrixState);\n\n        const x = this._v3_1.distanceTo(this._gizmos.position);\n\n        let xNew = x / size; //distance between camera and gizmos if scale(size, scalepoint) would be performed\n        //check min and max distance\n\n        xNew = MathUtils.clamp(xNew, this.minDistance, this.maxDistance);\n        const y = x * Math.tan(MathUtils.DEG2RAD * this._fovState * 0.5); //calculate new fov\n\n        let newFov = MathUtils.RAD2DEG * (Math.atan(y / xNew) * 2); //check min and max fov\n\n        newFov = MathUtils.clamp(newFov, this.minFov, this.maxFov);\n        const newDistance = y / Math.tan(MathUtils.DEG2RAD * (newFov / 2));\n        size = x / newDistance;\n\n        this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);\n\n        this.setFov(newFov);\n        this.applyTransformMatrix(this.applyScale(size, this._v3_2, false)); //adjusting distance\n\n        const direction = this._gizmos.position.clone().sub(this.camera.position).normalize().multiplyScalar(newDistance / x);\n\n        this._m4_1.makeTranslation(direction.x, direction.y, direction.z);\n\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n\n    _defineProperty(this, \"onTriplePanEnd\", () => {\n      this.updateTbState(STATE.IDLE, false);\n      this.dispatchEvent(_endEvent); //this.dispatchEvent( _changeEvent );\n    });\n\n    _defineProperty(this, \"setCenter\", (clientX, clientY) => {\n      _center.x = clientX;\n      _center.y = clientY;\n    });\n\n    _defineProperty(this, \"initializeMouseActions\", () => {\n      this.setMouseAction('PAN', 0, 'CTRL');\n      this.setMouseAction('PAN', 2);\n      this.setMouseAction('ROTATE', 0);\n      this.setMouseAction('ZOOM', 'WHEEL');\n      this.setMouseAction('ZOOM', 1);\n      this.setMouseAction('FOV', 'WHEEL', 'SHIFT');\n      this.setMouseAction('FOV', 1, 'SHIFT');\n    });\n\n    _defineProperty(this, \"setMouseAction\", (operation, mouse, key = null) => {\n      const operationInput = ['PAN', 'ROTATE', 'ZOOM', 'FOV'];\n      const mouseInput = [0, 1, 2, 'WHEEL'];\n      const keyInput = ['CTRL', 'SHIFT', null];\n      let state;\n\n      if (!operationInput.includes(operation) || !mouseInput.includes(mouse) || !keyInput.includes(key)) {\n        //invalid parameters\n        return false;\n      }\n\n      if (mouse == 'WHEEL') {\n        if (operation != 'ZOOM' && operation != 'FOV') {\n          //cannot associate 2D operation to 1D input\n          return false;\n        }\n      }\n\n      switch (operation) {\n        case 'PAN':\n          state = STATE.PAN;\n          break;\n\n        case 'ROTATE':\n          state = STATE.ROTATE;\n          break;\n\n        case 'ZOOM':\n          state = STATE.SCALE;\n          break;\n\n        case 'FOV':\n          state = STATE.FOV;\n          break;\n      }\n\n      const action = {\n        operation: operation,\n        mouse: mouse,\n        key: key,\n        state: state\n      };\n\n      for (let i = 0; i < this.mouseActions.length; i++) {\n        if (this.mouseActions[i].mouse == action.mouse && this.mouseActions[i].key == action.key) {\n          this.mouseActions.splice(i, 1, action);\n          return true;\n        }\n      }\n\n      this.mouseActions.push(action);\n      return true;\n    });\n\n    _defineProperty(this, \"getOpFromAction\", (mouse, key) => {\n      let action;\n\n      for (let i = 0; i < this.mouseActions.length; i++) {\n        action = this.mouseActions[i];\n\n        if (action.mouse == mouse && action.key == key) {\n          return action.operation;\n        }\n      }\n\n      if (key) {\n        for (let i = 0; i < this.mouseActions.length; i++) {\n          action = this.mouseActions[i];\n\n          if (action.mouse == mouse && action.key == null) {\n            return action.operation;\n          }\n        }\n      }\n\n      return null;\n    });\n\n    _defineProperty(this, \"getOpStateFromAction\", (mouse, key) => {\n      let action;\n\n      for (let i = 0; i < this.mouseActions.length; i++) {\n        action = this.mouseActions[i];\n\n        if (action.mouse == mouse && action.key == key) {\n          return action.state;\n        }\n      }\n\n      if (key) {\n        for (let i = 0; i < this.mouseActions.length; i++) {\n          action = this.mouseActions[i];\n\n          if (action.mouse == mouse && action.key == null) {\n            return action.state;\n          }\n        }\n      }\n\n      return null;\n    });\n\n    _defineProperty(this, \"getAngle\", (p1, p2) => {\n      return Math.atan2(p2.clientY - p1.clientY, p2.clientX - p1.clientX) * 180 / Math.PI;\n    });\n\n    _defineProperty(this, \"updateTouchEvent\", event => {\n      for (let i = 0; i < this._touchCurrent.length; i++) {\n        if (this._touchCurrent[i].pointerId == event.pointerId) {\n          this._touchCurrent.splice(i, 1, event);\n\n          break;\n        }\n      }\n    });\n\n    _defineProperty(this, \"calculateAngularSpeed\", (p0, p1, t0, t1) => {\n      const s = p1 - p0;\n      const t = (t1 - t0) / 1000;\n\n      if (t == 0) {\n        return 0;\n      }\n\n      return s / t;\n    });\n\n    _defineProperty(this, \"calculatePointersDistance\", (p0, p1) => {\n      return Math.sqrt(Math.pow(p1.clientX - p0.clientX, 2) + Math.pow(p1.clientY - p0.clientY, 2));\n    });\n\n    _defineProperty(this, \"calculateRotationAxis\", (vec1, vec2) => {\n      this._rotationMatrix.extractRotation(this._cameraMatrixState);\n\n      this._quat.setFromRotationMatrix(this._rotationMatrix);\n\n      this._rotationAxis.crossVectors(vec1, vec2).applyQuaternion(this._quat);\n\n      return this._rotationAxis.normalize().clone();\n    });\n\n    _defineProperty(this, \"calculateTbRadius\", camera => {\n      const factor = 0.67;\n      const distance = camera.position.distanceTo(this._gizmos.position);\n\n      if (camera.type == 'PerspectiveCamera') {\n        const halfFovV = MathUtils.DEG2RAD * camera.fov * 0.5; //vertical fov/2 in radians\n\n        const halfFovH = Math.atan(camera.aspect * Math.tan(halfFovV)); //horizontal fov/2 in radians\n\n        return Math.tan(Math.min(halfFovV, halfFovH)) * distance * factor;\n      } else if (camera.type == 'OrthographicCamera') {\n        return Math.min(camera.top, camera.right) * factor;\n      }\n    });\n\n    _defineProperty(this, \"focus\", (point, size, amount = 1) => {\n      if (this.camera) {\n        const focusPoint = point.clone(); //move center of camera (along with gizmos) towards point of interest\n\n        focusPoint.sub(this._gizmos.position).multiplyScalar(amount);\n\n        this._translationMatrix.makeTranslation(focusPoint.x, focusPoint.y, focusPoint.z);\n\n        const gizmoStateTemp = this._gizmoMatrixState.clone();\n\n        this._gizmoMatrixState.premultiply(this._translationMatrix);\n\n        this._gizmoMatrixState.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n\n        const cameraStateTemp = this._cameraMatrixState.clone();\n\n        this._cameraMatrixState.premultiply(this._translationMatrix);\n\n        this._cameraMatrixState.decompose(this.camera.position, this.camera.quaternion, this.camera.scale); //apply zoom\n\n\n        if (this.enableZoom) {\n          this.applyTransformMatrix(this.applyScale(size, this._gizmos.position));\n        }\n\n        this._gizmoMatrixState.copy(gizmoStateTemp);\n\n        this._cameraMatrixState.copy(cameraStateTemp);\n      }\n    });\n\n    _defineProperty(this, \"drawGrid\", () => {\n      if (this.scene) {\n        var _this$camera9, _this$camera10;\n\n        const color = 0x888888;\n        const multiplier = 3;\n        let size, divisions, maxLength, tick;\n\n        if (((_this$camera9 = this.camera) === null || _this$camera9 === void 0 ? void 0 : _this$camera9.type) === 'OrthographicCamera') {\n          const width = this.camera.right - this.camera.left;\n          const height = this.camera.bottom - this.camera.top;\n          maxLength = Math.max(width, height);\n          tick = maxLength / 20;\n          size = maxLength / this.camera.zoom * multiplier;\n          divisions = size / tick * this.camera.zoom;\n        } else if (((_this$camera10 = this.camera) === null || _this$camera10 === void 0 ? void 0 : _this$camera10.type) === 'PerspectiveCamera') {\n          const distance = this.camera.position.distanceTo(this._gizmos.position);\n          const halfFovV = MathUtils.DEG2RAD * this.camera.fov * 0.5;\n          const halfFovH = Math.atan(this.camera.aspect * Math.tan(halfFovV));\n          maxLength = Math.tan(Math.max(halfFovV, halfFovH)) * distance * 2;\n          tick = maxLength / 20;\n          size = maxLength * multiplier;\n          divisions = size / tick;\n        }\n\n        if (this._grid == null && this.camera) {\n          this._grid = new GridHelper(size, divisions, color, color);\n\n          this._grid.position.copy(this._gizmos.position);\n\n          this._gridPosition.copy(this._grid.position);\n\n          this._grid.quaternion.copy(this.camera.quaternion);\n\n          this._grid.rotateX(Math.PI * 0.5);\n\n          this.scene.add(this._grid);\n        }\n      }\n    });\n\n    _defineProperty(this, \"connect\", domElement => {\n      // https://github.com/mrdoob/three.js/issues/20575\n      if (domElement === document) {\n        console.error('THREE.ArcballControls: \"document\" should not be used as the target \"domElement\". Please use \"renderer.domElement\" instead.');\n      }\n\n      this.domElement = domElement; // disables touch scroll\n      // touch-action needs to be defined for pointer events to work on mobile\n      // https://stackoverflow.com/a/48254578\n\n      this.domElement.style.touchAction = 'none';\n      this.domElement.addEventListener('contextmenu', this.onContextMenu);\n      this.domElement.addEventListener('pointerdown', this.onPointerDown);\n      this.domElement.addEventListener('pointercancel', this.onPointerCancel);\n      this.domElement.addEventListener('wheel', this.onWheel);\n    });\n\n    _defineProperty(this, \"dispose\", () => {\n      var _this$domElement, _this$domElement2, _this$domElement3, _this$domElement4, _this$scene;\n\n      if (this._animationId != -1) {\n        window.cancelAnimationFrame(this._animationId);\n      }\n\n      (_this$domElement = this.domElement) === null || _this$domElement === void 0 ? void 0 : _this$domElement.removeEventListener('pointerdown', this.onPointerDown);\n      (_this$domElement2 = this.domElement) === null || _this$domElement2 === void 0 ? void 0 : _this$domElement2.removeEventListener('pointercancel', this.onPointerCancel);\n      (_this$domElement3 = this.domElement) === null || _this$domElement3 === void 0 ? void 0 : _this$domElement3.removeEventListener('wheel', this.onWheel);\n      (_this$domElement4 = this.domElement) === null || _this$domElement4 === void 0 ? void 0 : _this$domElement4.removeEventListener('contextmenu', this.onContextMenu);\n      window.removeEventListener('pointermove', this.onPointerMove);\n      window.removeEventListener('pointerup', this.onPointerUp);\n      window.removeEventListener('resize', this.onWindowResize);\n      (_this$scene = this.scene) === null || _this$scene === void 0 ? void 0 : _this$scene.remove(this._gizmos);\n      this.disposeGrid();\n    });\n\n    _defineProperty(this, \"disposeGrid\", () => {\n      if (this._grid && this.scene) {\n        this.scene.remove(this._grid);\n        this._grid = null;\n      }\n    });\n\n    _defineProperty(this, \"easeOutCubic\", t => {\n      return 1 - Math.pow(1 - t, 3);\n    });\n\n    _defineProperty(this, \"activateGizmos\", isActive => {\n      for (const gizmo of this._gizmos.children) {\n        gizmo.material.setValues({\n          opacity: isActive ? 1 : 0.6\n        });\n      }\n    });\n\n    _defineProperty(this, \"getCursorNDC\", (cursorX, cursorY, canvas) => {\n      const canvasRect = canvas.getBoundingClientRect();\n\n      this._v2_1.setX((cursorX - canvasRect.left) / canvasRect.width * 2 - 1);\n\n      this._v2_1.setY((canvasRect.bottom - cursorY) / canvasRect.height * 2 - 1);\n\n      return this._v2_1.clone();\n    });\n\n    _defineProperty(this, \"getCursorPosition\", (cursorX, cursorY, canvas) => {\n      var _this$camera11;\n\n      this._v2_1.copy(this.getCursorNDC(cursorX, cursorY, canvas));\n\n      if (((_this$camera11 = this.camera) === null || _this$camera11 === void 0 ? void 0 : _this$camera11.type) === 'OrthographicCamera') {\n        this._v2_1.x *= (this.camera.right - this.camera.left) * 0.5;\n        this._v2_1.y *= (this.camera.top - this.camera.bottom) * 0.5;\n      }\n\n      return this._v2_1.clone();\n    });\n\n    _defineProperty(this, \"setCamera\", camera => {\n      if (camera) {\n        camera.lookAt(this.target);\n        camera.updateMatrix(); //setting state\n\n        if ((camera === null || camera === void 0 ? void 0 : camera.type) == 'PerspectiveCamera') {\n          this._fov0 = camera.fov;\n          this._fovState = camera.fov;\n        }\n\n        this._cameraMatrixState0.copy(camera.matrix);\n\n        this._cameraMatrixState.copy(this._cameraMatrixState0);\n\n        this._cameraProjectionState.copy(camera.projectionMatrix);\n\n        this._zoom0 = camera.zoom;\n        this._zoomState = this._zoom0;\n        this._initialNear = camera.near;\n        this._nearPos0 = camera.position.distanceTo(this.target) - camera.near;\n        this._nearPos = this._initialNear;\n        this._initialFar = camera.far;\n        this._farPos0 = camera.position.distanceTo(this.target) - camera.far;\n        this._farPos = this._initialFar;\n\n        this._up0.copy(camera.up);\n\n        this._upState.copy(camera.up);\n\n        this.camera = camera;\n        this.camera.updateProjectionMatrix(); //making gizmos\n\n        const tbRadius = this.calculateTbRadius(camera);\n\n        if (tbRadius !== undefined) {\n          this._tbRadius = tbRadius;\n        }\n\n        this.makeGizmos(this.target, this._tbRadius);\n      }\n    });\n\n    _defineProperty(this, \"makeGizmos\", (tbCenter, tbRadius) => {\n      // @ts-expect-error\n      const curve = new EllipseCurve(0, 0, tbRadius, tbRadius);\n      const points = curve.getPoints(this._curvePts); //geometry\n\n      const curveGeometry = new BufferGeometry().setFromPoints(points); //material\n\n      const curveMaterialX = new LineBasicMaterial({\n        color: 0xff8080,\n        fog: false,\n        transparent: true,\n        opacity: 0.6\n      });\n      const curveMaterialY = new LineBasicMaterial({\n        color: 0x80ff80,\n        fog: false,\n        transparent: true,\n        opacity: 0.6\n      });\n      const curveMaterialZ = new LineBasicMaterial({\n        color: 0x8080ff,\n        fog: false,\n        transparent: true,\n        opacity: 0.6\n      }); //line\n\n      const gizmoX = new Line(curveGeometry, curveMaterialX);\n      const gizmoY = new Line(curveGeometry, curveMaterialY);\n      const gizmoZ = new Line(curveGeometry, curveMaterialZ);\n      const rotation = Math.PI * 0.5;\n      gizmoX.rotation.x = rotation;\n      gizmoY.rotation.y = rotation; //setting state\n\n      this._gizmoMatrixState0.identity().setPosition(tbCenter);\n\n      this._gizmoMatrixState.copy(this._gizmoMatrixState0);\n\n      if (this.camera && this.camera.zoom != 1) {\n        //adapt gizmos size to camera zoom\n        const size = 1 / this.camera.zoom;\n\n        this._scaleMatrix.makeScale(size, size, size);\n\n        this._translationMatrix.makeTranslation(-tbCenter.x, -tbCenter.y, -tbCenter.z);\n\n        this._gizmoMatrixState.premultiply(this._translationMatrix).premultiply(this._scaleMatrix);\n\n        this._translationMatrix.makeTranslation(tbCenter.x, tbCenter.y, tbCenter.z);\n\n        this._gizmoMatrixState.premultiply(this._translationMatrix);\n      }\n\n      this._gizmoMatrixState.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n\n      this._gizmos.clear();\n\n      this._gizmos.add(gizmoX);\n\n      this._gizmos.add(gizmoY);\n\n      this._gizmos.add(gizmoZ);\n    });\n\n    _defineProperty(this, \"onFocusAnim\", (time, point, cameraMatrix, gizmoMatrix) => {\n      if (this._timeStart == -1) {\n        //animation start\n        this._timeStart = time;\n      }\n\n      if (this._state == STATE.ANIMATION_FOCUS) {\n        const deltaTime = time - this._timeStart;\n        const animTime = deltaTime / this.focusAnimationTime;\n\n        this._gizmoMatrixState.copy(gizmoMatrix);\n\n        if (animTime >= 1) {\n          //animation end\n          this._gizmoMatrixState.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n\n          this.focus(point, this.scaleFactor);\n          this._timeStart = -1;\n          this.updateTbState(STATE.IDLE, false);\n          this.activateGizmos(false);\n          this.dispatchEvent(_changeEvent);\n        } else {\n          const amount = this.easeOutCubic(animTime);\n          const size = 1 - amount + this.scaleFactor * amount;\n\n          this._gizmoMatrixState.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n\n          this.focus(point, size, amount);\n          this.dispatchEvent(_changeEvent);\n          const self = this;\n          this._animationId = window.requestAnimationFrame(function (t) {\n            self.onFocusAnim(t, point, cameraMatrix, gizmoMatrix.clone());\n          });\n        }\n      } else {\n        //interrupt animation\n        this._animationId = -1;\n        this._timeStart = -1;\n      }\n    });\n\n    _defineProperty(this, \"onRotationAnim\", (time, rotationAxis, w0) => {\n      if (this._timeStart == -1) {\n        //animation start\n        this._anglePrev = 0;\n        this._angleCurrent = 0;\n        this._timeStart = time;\n      }\n\n      if (this._state == STATE.ANIMATION_ROTATE) {\n        //w = w0 + alpha * t\n        const deltaTime = (time - this._timeStart) / 1000;\n        const w = w0 + -this.dampingFactor * deltaTime;\n\n        if (w > 0) {\n          //tetha = 0.5 * alpha * t^2 + w0 * t + tetha0\n          this._angleCurrent = 0.5 * -this.dampingFactor * Math.pow(deltaTime, 2) + w0 * deltaTime + 0;\n          this.applyTransformMatrix(this.rotate(rotationAxis, this._angleCurrent));\n          this.dispatchEvent(_changeEvent);\n          const self = this;\n          this._animationId = window.requestAnimationFrame(function (t) {\n            self.onRotationAnim(t, rotationAxis, w0);\n          });\n        } else {\n          this._animationId = -1;\n          this._timeStart = -1;\n          this.updateTbState(STATE.IDLE, false);\n          this.activateGizmos(false);\n          this.dispatchEvent(_changeEvent);\n        }\n      } else {\n        //interrupt animation\n        this._animationId = -1;\n        this._timeStart = -1;\n\n        if (this._state != STATE.ROTATE) {\n          this.activateGizmos(false);\n          this.dispatchEvent(_changeEvent);\n        }\n      }\n    });\n\n    _defineProperty(this, \"pan\", (p0, p1, adjust = false) => {\n      if (this.camera) {\n        const movement = p0.clone().sub(p1);\n\n        if (this.camera.type === 'OrthographicCamera') {\n          //adjust movement amount\n          movement.multiplyScalar(1 / this.camera.zoom);\n        }\n\n        if (this.camera.type === 'PerspectiveCamera' && adjust) {\n          //adjust movement amount\n          this._v3_1.setFromMatrixPosition(this._cameraMatrixState0); //camera's initial position\n\n\n          this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0); //gizmo's initial position\n\n\n          const distanceFactor = this._v3_1.distanceTo(this._v3_2) / this.camera.position.distanceTo(this._gizmos.position);\n          movement.multiplyScalar(1 / distanceFactor);\n        }\n\n        this._v3_1.set(movement.x, movement.y, 0).applyQuaternion(this.camera.quaternion);\n\n        this._m4_1.makeTranslation(this._v3_1.x, this._v3_1.y, this._v3_1.z);\n\n        this.setTransformationMatrices(this._m4_1, this._m4_1);\n      }\n\n      return _transformation;\n    });\n\n    _defineProperty(this, \"reset\", () => {\n      if (this.camera) {\n        this.camera.zoom = this._zoom0;\n\n        if (this.camera.type === 'PerspectiveCamera') {\n          this.camera.fov = this._fov0;\n        }\n\n        this.camera.near = this._nearPos;\n        this.camera.far = this._farPos;\n\n        this._cameraMatrixState.copy(this._cameraMatrixState0);\n\n        this._cameraMatrixState.decompose(this.camera.position, this.camera.quaternion, this.camera.scale);\n\n        this.camera.up.copy(this._up0);\n        this.camera.updateMatrix();\n        this.camera.updateProjectionMatrix();\n\n        this._gizmoMatrixState.copy(this._gizmoMatrixState0);\n\n        this._gizmoMatrixState0.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n\n        this._gizmos.updateMatrix();\n\n        const tbRadius = this.calculateTbRadius(this.camera);\n\n        if (tbRadius !== undefined) {\n          this._tbRadius = tbRadius;\n        }\n\n        this.makeGizmos(this._gizmos.position, this._tbRadius);\n        this.camera.lookAt(this._gizmos.position);\n        this.updateTbState(STATE.IDLE, false);\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n\n    _defineProperty(this, \"rotate\", (axis, angle) => {\n      const point = this._gizmos.position; //rotation center\n\n      this._translationMatrix.makeTranslation(-point.x, -point.y, -point.z);\n\n      this._rotationMatrix.makeRotationAxis(axis, -angle); //rotate camera\n\n\n      this._m4_1.makeTranslation(point.x, point.y, point.z);\n\n      this._m4_1.multiply(this._rotationMatrix);\n\n      this._m4_1.multiply(this._translationMatrix);\n\n      this.setTransformationMatrices(this._m4_1);\n      return _transformation;\n    });\n\n    _defineProperty(this, \"copyState\", () => {\n      if (this.camera) {\n        var _this$camera12;\n\n        const state = JSON.stringify(((_this$camera12 = this.camera) === null || _this$camera12 === void 0 ? void 0 : _this$camera12.type) === 'OrthographicCamera' ? {\n          arcballState: {\n            cameraFar: this.camera.far,\n            cameraMatrix: this.camera.matrix,\n            cameraNear: this.camera.near,\n            cameraUp: this.camera.up,\n            cameraZoom: this.camera.zoom,\n            gizmoMatrix: this._gizmos.matrix\n          }\n        } : {\n          arcballState: {\n            cameraFar: this.camera.far,\n            cameraFov: this.camera.fov,\n            cameraMatrix: this.camera.matrix,\n            cameraNear: this.camera.near,\n            cameraUp: this.camera.up,\n            cameraZoom: this.camera.zoom,\n            gizmoMatrix: this._gizmos.matrix\n          }\n        });\n        navigator.clipboard.writeText(state);\n      }\n    });\n\n    _defineProperty(this, \"pasteState\", () => {\n      const self = this;\n      navigator.clipboard.readText().then(function resolved(value) {\n        self.setStateFromJSON(value);\n      });\n    });\n\n    _defineProperty(this, \"saveState\", () => {\n      if (!this.camera) return;\n\n      this._cameraMatrixState0.copy(this.camera.matrix);\n\n      this._gizmoMatrixState0.copy(this._gizmos.matrix);\n\n      this._nearPos = this.camera.near;\n      this._farPos = this.camera.far;\n      this._zoom0 = this.camera.zoom;\n\n      this._up0.copy(this.camera.up);\n\n      if (this.camera.type === 'PerspectiveCamera') {\n        this._fov0 = this.camera.fov;\n      }\n    });\n\n    _defineProperty(this, \"applyScale\", (size, point, scaleGizmos = true) => {\n      if (!this.camera) return;\n      const scalePoint = point.clone();\n      let sizeInverse = 1 / size;\n\n      if (this.camera.type === 'OrthographicCamera') {\n        //camera zoom\n        this.camera.zoom = this._zoomState;\n        this.camera.zoom *= size; //check min and max zoom\n\n        if (this.camera.zoom > this.maxZoom) {\n          this.camera.zoom = this.maxZoom;\n          sizeInverse = this._zoomState / this.maxZoom;\n        } else if (this.camera.zoom < this.minZoom) {\n          this.camera.zoom = this.minZoom;\n          sizeInverse = this._zoomState / this.minZoom;\n        }\n\n        this.camera.updateProjectionMatrix();\n\n        this._v3_1.setFromMatrixPosition(this._gizmoMatrixState); //gizmos position\n        //scale gizmos so they appear in the same spot having the same dimension\n\n\n        this._scaleMatrix.makeScale(sizeInverse, sizeInverse, sizeInverse);\n\n        this._translationMatrix.makeTranslation(-this._v3_1.x, -this._v3_1.y, -this._v3_1.z);\n\n        this._m4_2.makeTranslation(this._v3_1.x, this._v3_1.y, this._v3_1.z).multiply(this._scaleMatrix);\n\n        this._m4_2.multiply(this._translationMatrix); //move camera and gizmos to obtain pinch effect\n\n\n        scalePoint.sub(this._v3_1);\n        const amount = scalePoint.clone().multiplyScalar(sizeInverse);\n        scalePoint.sub(amount);\n\n        this._m4_1.makeTranslation(scalePoint.x, scalePoint.y, scalePoint.z);\n\n        this._m4_2.premultiply(this._m4_1);\n\n        this.setTransformationMatrices(this._m4_1, this._m4_2);\n        return _transformation;\n      }\n\n      if (this.camera.type === 'PerspectiveCamera') {\n        this._v3_1.setFromMatrixPosition(this._cameraMatrixState);\n\n        this._v3_2.setFromMatrixPosition(this._gizmoMatrixState); //move camera\n\n\n        let distance = this._v3_1.distanceTo(scalePoint);\n\n        let amount = distance - distance * sizeInverse; //check min and max distance\n\n        const newDistance = distance - amount;\n\n        if (newDistance < this.minDistance) {\n          sizeInverse = this.minDistance / distance;\n          amount = distance - distance * sizeInverse;\n        } else if (newDistance > this.maxDistance) {\n          sizeInverse = this.maxDistance / distance;\n          amount = distance - distance * sizeInverse;\n        }\n\n        let direction = scalePoint.clone().sub(this._v3_1).normalize().multiplyScalar(amount);\n\n        this._m4_1.makeTranslation(direction.x, direction.y, direction.z);\n\n        if (scaleGizmos) {\n          //scale gizmos so they appear in the same spot having the same dimension\n          const pos = this._v3_2;\n          distance = pos.distanceTo(scalePoint);\n          amount = distance - distance * sizeInverse;\n          direction = scalePoint.clone().sub(this._v3_2).normalize().multiplyScalar(amount);\n\n          this._translationMatrix.makeTranslation(pos.x, pos.y, pos.z);\n\n          this._scaleMatrix.makeScale(sizeInverse, sizeInverse, sizeInverse);\n\n          this._m4_2.makeTranslation(direction.x, direction.y, direction.z).multiply(this._translationMatrix);\n\n          this._m4_2.multiply(this._scaleMatrix);\n\n          this._translationMatrix.makeTranslation(-pos.x, -pos.y, -pos.z);\n\n          this._m4_2.multiply(this._translationMatrix);\n\n          this.setTransformationMatrices(this._m4_1, this._m4_2);\n        } else {\n          this.setTransformationMatrices(this._m4_1);\n        }\n\n        return _transformation;\n      }\n    });\n\n    _defineProperty(this, \"setFov\", value => {\n      var _this$camera13;\n\n      if (((_this$camera13 = this.camera) === null || _this$camera13 === void 0 ? void 0 : _this$camera13.type) === 'PerspectiveCamera') {\n        this.camera.fov = MathUtils.clamp(value, this.minFov, this.maxFov);\n        this.camera.updateProjectionMatrix();\n      }\n    });\n\n    _defineProperty(this, \"setTarget\", (x, y, z) => {\n      if (this.camera) {\n        this.target.set(x, y, z);\n\n        this._gizmos.position.set(x, y, z); //for correct radius calculation\n\n\n        const tbRadius = this.calculateTbRadius(this.camera);\n\n        if (tbRadius !== undefined) {\n          this._tbRadius = tbRadius;\n        }\n\n        this.makeGizmos(this.target, this._tbRadius);\n        this.camera.lookAt(this.target);\n      }\n    });\n\n    _defineProperty(this, \"zRotate\", (point, angle) => {\n      this._rotationMatrix.makeRotationAxis(this._rotationAxis, angle);\n\n      this._translationMatrix.makeTranslation(-point.x, -point.y, -point.z);\n\n      this._m4_1.makeTranslation(point.x, point.y, point.z);\n\n      this._m4_1.multiply(this._rotationMatrix);\n\n      this._m4_1.multiply(this._translationMatrix);\n\n      this._v3_1.setFromMatrixPosition(this._gizmoMatrixState).sub(point); //vector from rotation center to gizmos position\n\n\n      this._v3_2.copy(this._v3_1).applyAxisAngle(this._rotationAxis, angle); //apply rotation\n\n\n      this._v3_2.sub(this._v3_1);\n\n      this._m4_2.makeTranslation(this._v3_2.x, this._v3_2.y, this._v3_2.z);\n\n      this.setTransformationMatrices(this._m4_1, this._m4_2);\n      return _transformation;\n    });\n\n    _defineProperty(this, \"unprojectOnObj\", (cursor, camera) => {\n      if (!this.scene) return null;\n      const raycaster = new Raycaster();\n      raycaster.near = camera.near;\n      raycaster.far = camera.far;\n      raycaster.setFromCamera(cursor, camera);\n      const intersect = raycaster.intersectObjects(this.scene.children, true);\n\n      for (let i = 0; i < intersect.length; i++) {\n        if (intersect[i].object.uuid != this._gizmos.uuid && intersect[i].face) {\n          return intersect[i].point.clone();\n        }\n      }\n\n      return null;\n    });\n\n    _defineProperty(this, \"unprojectOnTbSurface\", (camera, cursorX, cursorY, canvas, tbRadius) => {\n      if (camera.type == 'OrthographicCamera') {\n        this._v2_1.copy(this.getCursorPosition(cursorX, cursorY, canvas));\n\n        this._v3_1.set(this._v2_1.x, this._v2_1.y, 0);\n\n        const x2 = Math.pow(this._v2_1.x, 2);\n        const y2 = Math.pow(this._v2_1.y, 2);\n        const r2 = Math.pow(this._tbRadius, 2);\n\n        if (x2 + y2 <= r2 * 0.5) {\n          //intersection with sphere\n          this._v3_1.setZ(Math.sqrt(r2 - (x2 + y2)));\n        } else {\n          //intersection with hyperboloid\n          this._v3_1.setZ(r2 * 0.5 / Math.sqrt(x2 + y2));\n        }\n\n        return this._v3_1;\n      }\n\n      if (camera.type == 'PerspectiveCamera') {\n        //unproject cursor on the near plane\n        this._v2_1.copy(this.getCursorNDC(cursorX, cursorY, canvas));\n\n        this._v3_1.set(this._v2_1.x, this._v2_1.y, -1);\n\n        this._v3_1.applyMatrix4(camera.projectionMatrixInverse);\n\n        const rayDir = this._v3_1.clone().normalize(); //unprojected ray direction\n\n\n        const cameraGizmoDistance = camera.position.distanceTo(this._gizmos.position);\n        const radius2 = Math.pow(tbRadius, 2); //\t  camera\n        //\t\t|\\\n        //\t\t| \\\n        //\t\t|  \\\n        //\th\t|\t\\\n        //\t\t| \t \\\n        //\t\t| \t  \\\n        //\t_ _ | _ _ _\\ _ _  near plane\n        //\t\t\tl\n\n        const h = this._v3_1.z;\n        const l = Math.sqrt(Math.pow(this._v3_1.x, 2) + Math.pow(this._v3_1.y, 2));\n\n        if (l == 0) {\n          //ray aligned with camera\n          rayDir.set(this._v3_1.x, this._v3_1.y, tbRadius);\n          return rayDir;\n        }\n\n        const m = h / l;\n        const q = cameraGizmoDistance;\n        /*\n         * calculate intersection point between unprojected ray and trackball surface\n         *|y = m * x + q\n         *|x^2 + y^2 = r^2\n         *\n         * (m^2 + 1) * x^2 + (2 * m * q) * x + q^2 - r^2 = 0\n         */\n\n        let a = Math.pow(m, 2) + 1;\n        let b = 2 * m * q;\n        let c = Math.pow(q, 2) - radius2;\n        let delta = Math.pow(b, 2) - 4 * a * c;\n\n        if (delta >= 0) {\n          //intersection with sphere\n          this._v2_1.setX((-b - Math.sqrt(delta)) / (2 * a));\n\n          this._v2_1.setY(m * this._v2_1.x + q);\n\n          const angle = MathUtils.RAD2DEG * this._v2_1.angle();\n\n          if (angle >= 45) {\n            //if angle between intersection point and X' axis is >= 45°, return that point\n            //otherwise, calculate intersection point with hyperboloid\n            const rayLength = Math.sqrt(Math.pow(this._v2_1.x, 2) + Math.pow(cameraGizmoDistance - this._v2_1.y, 2));\n            rayDir.multiplyScalar(rayLength);\n            rayDir.z += cameraGizmoDistance;\n            return rayDir;\n          }\n        } //intersection with hyperboloid\n\n        /*\n         *|y = m * x + q\n         *|y = (1 / x) * (r^2 / 2)\n         *\n         * m * x^2 + q * x - r^2 / 2 = 0\n         */\n\n\n        a = m;\n        b = q;\n        c = -radius2 * 0.5;\n        delta = Math.pow(b, 2) - 4 * a * c;\n\n        this._v2_1.setX((-b - Math.sqrt(delta)) / (2 * a));\n\n        this._v2_1.setY(m * this._v2_1.x + q);\n\n        const rayLength = Math.sqrt(Math.pow(this._v2_1.x, 2) + Math.pow(cameraGizmoDistance - this._v2_1.y, 2));\n        rayDir.multiplyScalar(rayLength);\n        rayDir.z += cameraGizmoDistance;\n        return rayDir;\n      }\n    });\n\n    _defineProperty(this, \"unprojectOnTbPlane\", (camera, cursorX, cursorY, canvas, initialDistance = false) => {\n      if (camera.type == 'OrthographicCamera') {\n        this._v2_1.copy(this.getCursorPosition(cursorX, cursorY, canvas));\n\n        this._v3_1.set(this._v2_1.x, this._v2_1.y, 0);\n\n        return this._v3_1.clone();\n      }\n\n      if (camera.type == 'PerspectiveCamera') {\n        this._v2_1.copy(this.getCursorNDC(cursorX, cursorY, canvas)); //unproject cursor on the near plane\n\n\n        this._v3_1.set(this._v2_1.x, this._v2_1.y, -1);\n\n        this._v3_1.applyMatrix4(camera.projectionMatrixInverse);\n\n        const rayDir = this._v3_1.clone().normalize(); //unprojected ray direction\n        //\t  camera\n        //\t\t|\\\n        //\t\t| \\\n        //\t\t|  \\\n        //\th\t|\t\\\n        //\t\t| \t \\\n        //\t\t| \t  \\\n        //\t_ _ | _ _ _\\ _ _  near plane\n        //\t\t\tl\n\n\n        const h = this._v3_1.z;\n        const l = Math.sqrt(Math.pow(this._v3_1.x, 2) + Math.pow(this._v3_1.y, 2));\n        let cameraGizmoDistance;\n\n        if (initialDistance) {\n          cameraGizmoDistance = this._v3_1.setFromMatrixPosition(this._cameraMatrixState0).distanceTo(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0));\n        } else {\n          cameraGizmoDistance = camera.position.distanceTo(this._gizmos.position);\n        }\n        /*\n         * calculate intersection point between unprojected ray and the plane\n         *|y = mx + q\n         *|y = 0\n         *\n         * x = -q/m\n         */\n\n\n        if (l == 0) {\n          //ray aligned with camera\n          rayDir.set(0, 0, 0);\n          return rayDir;\n        }\n\n        const m = h / l;\n        const q = cameraGizmoDistance;\n        const x = -q / m;\n        const rayLength = Math.sqrt(Math.pow(q, 2) + Math.pow(x, 2));\n        rayDir.multiplyScalar(rayLength);\n        rayDir.z = 0;\n        return rayDir;\n      }\n    });\n\n    _defineProperty(this, \"updateMatrixState\", () => {\n      if (!this.camera) return; //update camera and gizmos state\n\n      this._cameraMatrixState.copy(this.camera.matrix);\n\n      this._gizmoMatrixState.copy(this._gizmos.matrix);\n\n      if (this.camera.type === 'OrthographicCamera') {\n        this._cameraProjectionState.copy(this.camera.projectionMatrix);\n\n        this.camera.updateProjectionMatrix();\n        this._zoomState = this.camera.zoom;\n      }\n\n      if (this.camera.type === 'PerspectiveCamera') {\n        this._fovState = this.camera.fov;\n      }\n    });\n\n    _defineProperty(this, \"updateTbState\", (newState, updateMatrices) => {\n      this._state = newState;\n\n      if (updateMatrices) {\n        this.updateMatrixState();\n      }\n    });\n\n    _defineProperty(this, \"update\", () => {\n      const EPS = 0.000001; // Update target and gizmos state\n\n      if (!this.target.equals(this._currentTarget) && this.camera) {\n        this._gizmos.position.set(this.target.x, this.target.y, this.target.z); //for correct radius calculation\n\n\n        const tbRadius = this.calculateTbRadius(this.camera);\n\n        if (tbRadius !== undefined) {\n          this._tbRadius = tbRadius;\n        }\n\n        this.makeGizmos(this.target, this._tbRadius);\n\n        this._currentTarget.copy(this.target);\n      }\n\n      if (!this.camera) return; //check min/max parameters\n\n      if (this.camera.type === 'OrthographicCamera') {\n        //check zoom\n        if (this.camera.zoom > this.maxZoom || this.camera.zoom < this.minZoom) {\n          const newZoom = MathUtils.clamp(this.camera.zoom, this.minZoom, this.maxZoom);\n          this.applyTransformMatrix(this.applyScale(newZoom / this.camera.zoom, this._gizmos.position, true));\n        }\n      }\n\n      if (this.camera.type === 'PerspectiveCamera') {\n        //check distance\n        const distance = this.camera.position.distanceTo(this._gizmos.position);\n\n        if (distance > this.maxDistance + EPS || distance < this.minDistance - EPS) {\n          const newDistance = MathUtils.clamp(distance, this.minDistance, this.maxDistance);\n          this.applyTransformMatrix(this.applyScale(newDistance / distance, this._gizmos.position));\n          this.updateMatrixState();\n        } //check fov\n\n\n        if (this.camera.fov < this.minFov || this.camera.fov > this.maxFov) {\n          this.camera.fov = MathUtils.clamp(this.camera.fov, this.minFov, this.maxFov);\n          this.camera.updateProjectionMatrix();\n        }\n\n        const oldRadius = this._tbRadius;\n        const tbRadius = this.calculateTbRadius(this.camera);\n\n        if (tbRadius !== undefined) {\n          this._tbRadius = tbRadius;\n        }\n\n        if (oldRadius < this._tbRadius - EPS || oldRadius > this._tbRadius + EPS) {\n          const scale = (this._gizmos.scale.x + this._gizmos.scale.y + this._gizmos.scale.z) / 3;\n          const newRadius = this._tbRadius / scale; // @ts-expect-error\n\n          const curve = new EllipseCurve(0, 0, newRadius, newRadius);\n          const points = curve.getPoints(this._curvePts);\n          const curveGeometry = new BufferGeometry().setFromPoints(points);\n\n          for (const gizmo in this._gizmos.children) {\n            const child = this._gizmos.children[gizmo];\n            child.geometry = curveGeometry;\n          }\n        }\n      }\n\n      this.camera.lookAt(this._gizmos.position);\n    });\n\n    _defineProperty(this, \"setStateFromJSON\", json => {\n      const state = JSON.parse(json);\n\n      if (state.arcballState && this.camera) {\n        this._cameraMatrixState.fromArray(state.arcballState.cameraMatrix.elements);\n\n        this._cameraMatrixState.decompose(this.camera.position, this.camera.quaternion, this.camera.scale);\n\n        this.camera.up.copy(state.arcballState.cameraUp);\n        this.camera.near = state.arcballState.cameraNear;\n        this.camera.far = state.arcballState.cameraFar;\n        this.camera.zoom = state.arcballState.cameraZoom;\n\n        if (this.camera.type === 'PerspectiveCamera') {\n          this.camera.fov = state.arcballState.cameraFov;\n        }\n\n        this._gizmoMatrixState.fromArray(state.arcballState.gizmoMatrix.elements);\n\n        this._gizmoMatrixState.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n\n        this.camera.updateMatrix();\n        this.camera.updateProjectionMatrix();\n\n        this._gizmos.updateMatrix();\n\n        const tbRadius = this.calculateTbRadius(this.camera);\n\n        if (tbRadius !== undefined) {\n          this._tbRadius = tbRadius;\n        }\n\n        const gizmoTmp = new Matrix4().copy(this._gizmoMatrixState0);\n        this.makeGizmos(this._gizmos.position, this._tbRadius);\n\n        this._gizmoMatrixState0.copy(gizmoTmp);\n\n        this.camera.lookAt(this._gizmos.position);\n        this.updateTbState(STATE.IDLE, false);\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n\n    this.camera = null;\n    this.domElement = _domElement;\n    this.scene = scene;\n    this.mouseActions = [];\n    this._mouseOp = null; //global vectors and matrices that are used in some operations to avoid creating new objects every time (e.g. every time cursor moves)\n\n    this._v2_1 = new Vector2();\n    this._v3_1 = new Vector3();\n    this._v3_2 = new Vector3();\n    this._m4_1 = new Matrix4();\n    this._m4_2 = new Matrix4();\n    this._quat = new Quaternion(); //transformation matrices\n\n    this._translationMatrix = new Matrix4(); //matrix for translation operation\n\n    this._rotationMatrix = new Matrix4(); //matrix for rotation operation\n\n    this._scaleMatrix = new Matrix4(); //matrix for scaling operation\n\n    this._rotationAxis = new Vector3(); //axis for rotate operation\n    //camera state\n\n    this._cameraMatrixState = new Matrix4();\n    this._cameraProjectionState = new Matrix4();\n    this._fovState = 1;\n    this._upState = new Vector3();\n    this._zoomState = 1;\n    this._nearPos = 0;\n    this._farPos = 0;\n    this._gizmoMatrixState = new Matrix4(); //initial values\n\n    this._up0 = new Vector3();\n    this._zoom0 = 1;\n    this._fov0 = 0;\n    this._initialNear = 0;\n    this._nearPos0 = 0;\n    this._initialFar = 0;\n    this._farPos0 = 0;\n    this._cameraMatrixState0 = new Matrix4();\n    this._gizmoMatrixState0 = new Matrix4(); //pointers array\n\n    this._button = -1;\n    this._touchStart = [];\n    this._touchCurrent = [];\n    this._input = INPUT.NONE; //two fingers touch interaction\n\n    this._switchSensibility = 32; //minimum movement to be performed to fire single pan start after the second finger has been released\n\n    this._startFingerDistance = 0; //distance between two fingers\n\n    this._currentFingerDistance = 0;\n    this._startFingerRotation = 0; //amount of rotation performed with two fingers\n\n    this._currentFingerRotation = 0; //double tap\n\n    this._devPxRatio = 0;\n    this._downValid = true;\n    this._nclicks = 0;\n    this._downEvents = [];\n    this._clickStart = 0; //first click time\n\n    this._maxDownTime = 250;\n    this._maxInterval = 300;\n    this._posThreshold = 24;\n    this._movementThreshold = 24; //cursor positions\n\n    this._currentCursorPosition = new Vector3();\n    this._startCursorPosition = new Vector3(); //grid\n\n    this._grid = null; //grid to be visualized during pan operation\n\n    this._gridPosition = new Vector3(); //gizmos\n\n    this._gizmos = new Group();\n    this._curvePts = 128; //animations\n\n    this._timeStart = -1; //initial time\n\n    this._animationId = -1; //focus animation\n\n    this.focusAnimationTime = 500; //duration of focus animation in ms\n    //rotate animation\n\n    this._timePrev = 0; //time at which previous rotate operation has been detected\n\n    this._timeCurrent = 0; //time at which current rotate operation has been detected\n\n    this._anglePrev = 0; //angle of previous rotation\n\n    this._angleCurrent = 0; //angle of current rotation\n\n    this._cursorPosPrev = new Vector3(); //cursor position when previous rotate operation has been detected\n\n    this._cursorPosCurr = new Vector3(); //cursor position when current rotate operation has been detected\n\n    this._wPrev = 0; //angular velocity of the previous rotate operation\n\n    this._wCurr = 0; //angular velocity of the current rotate operation\n    //parameters\n\n    this.adjustNearFar = false;\n    this.scaleFactor = 1.1; //zoom/distance multiplier\n\n    this.dampingFactor = 25;\n    this.wMax = 20; //maximum angular velocity allowed\n\n    this.enableAnimations = true; //if animations should be performed\n\n    this.enableGrid = false; //if grid should be showed during pan operation\n\n    this.cursorZoom = false; //if wheel zoom should be cursor centered\n\n    this.minFov = 5;\n    this.maxFov = 90;\n    this.enabled = true;\n    this.enablePan = true;\n    this.enableRotate = true;\n    this.enableZoom = true;\n    this.minDistance = 0;\n    this.maxDistance = Infinity;\n    this.minZoom = 0;\n    this.maxZoom = Infinity; //trackball parameters\n\n    this.target = new Vector3(0, 0, 0);\n    this._currentTarget = new Vector3(0, 0, 0);\n    this._tbRadius = 1; //FSA\n\n    this._state = STATE.IDLE;\n    this.setCamera(_camera);\n\n    if (this.scene) {\n      this.scene.add(this._gizmos);\n    }\n\n    this._devPxRatio = window.devicePixelRatio;\n    this.initializeMouseActions();\n    if (this.domElement) this.connect(this.domElement);\n    window.addEventListener('resize', this.onWindowResize);\n  } //listeners\n\n\n  /**\n   * Apply a transformation matrix, to the camera and gizmos\n   * @param {Object} transformation Object containing matrices to apply to camera and gizmos\n   */\n  applyTransformMatrix(transformation) {\n    if (transformation !== null && transformation !== void 0 && transformation.camera && this.camera) {\n      this._m4_1.copy(this._cameraMatrixState).premultiply(transformation.camera);\n\n      this._m4_1.decompose(this.camera.position, this.camera.quaternion, this.camera.scale);\n\n      this.camera.updateMatrix(); //update camera up vector\n\n      if (this._state == STATE.ROTATE || this._state == STATE.ZROTATE || this._state == STATE.ANIMATION_ROTATE) {\n        this.camera.up.copy(this._upState).applyQuaternion(this.camera.quaternion);\n      }\n    }\n\n    if (transformation !== null && transformation !== void 0 && transformation.gizmos) {\n      this._m4_1.copy(this._gizmoMatrixState).premultiply(transformation.gizmos);\n\n      this._m4_1.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n\n      this._gizmos.updateMatrix();\n    }\n\n    if ((this._state == STATE.SCALE || this._state == STATE.FOCUS || this._state == STATE.ANIMATION_FOCUS) && this.camera) {\n      const tbRadius = this.calculateTbRadius(this.camera);\n\n      if (tbRadius !== undefined) {\n        this._tbRadius = tbRadius;\n      }\n\n      if (this.adjustNearFar) {\n        const cameraDistance = this.camera.position.distanceTo(this._gizmos.position);\n        const bb = new Box3();\n        bb.setFromObject(this._gizmos);\n        const sphere = new Sphere();\n        bb.getBoundingSphere(sphere);\n        const adjustedNearPosition = Math.max(this._nearPos0, sphere.radius + sphere.center.length());\n        const regularNearPosition = cameraDistance - this._initialNear;\n        const minNearPos = Math.min(adjustedNearPosition, regularNearPosition);\n        this.camera.near = cameraDistance - minNearPos;\n        const adjustedFarPosition = Math.min(this._farPos0, -sphere.radius + sphere.center.length());\n        const regularFarPosition = cameraDistance - this._initialFar;\n        const minFarPos = Math.min(adjustedFarPosition, regularFarPosition);\n        this.camera.far = cameraDistance - minFarPos;\n        this.camera.updateProjectionMatrix();\n      } else {\n        let update = false;\n\n        if (this.camera.near != this._initialNear) {\n          this.camera.near = this._initialNear;\n          update = true;\n        }\n\n        if (this.camera.far != this._initialFar) {\n          this.camera.far = this._initialFar;\n          update = true;\n        }\n\n        if (update) {\n          this.camera.updateProjectionMatrix();\n        }\n      }\n    }\n  }\n  /**\n   * Calculate the angular speed\n   * @param {Number} p0 Position at t0\n   * @param {Number} p1 Position at t1\n   * @param {Number} t0 Initial time in milliseconds\n   * @param {Number} t1 Ending time in milliseconds\n   */\n\n\n  /**\n   * Set gizmos visibility\n   * @param {Boolean} value Value of gizmos visibility\n   */\n  setGizmosVisible(value) {\n    this._gizmos.visible = value;\n    this.dispatchEvent(_changeEvent);\n  }\n  /**\n   * Creates the rotation gizmos matching trackball center and radius\n   * @param {Vector3} tbCenter The trackball center\n   * @param {number} tbRadius The trackball radius\n   */\n\n\n  /**\n   * Set values in transformation object\n   * @param {Matrix4} camera Transformation to be applied to the camera\n   * @param {Matrix4} gizmos Transformation to be applied to gizmos\n   */\n  setTransformationMatrices(camera = null, gizmos = null) {\n    if (camera) {\n      if (_transformation.camera) {\n        _transformation.camera.copy(camera);\n      } else {\n        _transformation.camera = camera.clone();\n      }\n    } else {\n      _transformation.camera = null;\n    }\n\n    if (gizmos) {\n      if (_transformation.gizmos) {\n        _transformation.gizmos.copy(gizmos);\n      } else {\n        _transformation.gizmos = gizmos.clone();\n      }\n    } else {\n      _transformation.gizmos = null;\n    }\n  }\n  /**\n   * Rotate camera around its direction axis passing by a given point by a given angle\n   * @param {Vector3} point The point where the rotation axis is passing trough\n   * @param {Number} angle Angle in radians\n   * @returns The computed transormation matix\n   */\n\n\n}\n\nexport { ArcballControls };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}